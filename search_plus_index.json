{"./":{"url":"./","title":"Introduction","keywords":"","body":"RxSwift Example ä¸»è¦æ˜¯RxSwiftçš„ä¸€äº›æ“ä½œç¬¦çš„ç¤ºä¾‹ éƒ¨åˆ†å†…å®¹æ‘˜è‡ªå®˜æ–¹æ–‡æ¡£ä»¥åŠç¿»è¯‘çš„ä¸­æ–‡æ–‡æ¡£ ç›¸å…³åœ°å€ RxSwiftExample Xcodeé¡¹ç›®: https://github.com/ToBeDefined/RxSwiftExample/ GitBookåœ°å€: http://rxswift.tbd.ink GitBookå¤‡ç”¨åœ°å€: https://swift.rx.tbd.ink ç›®å½• 1. Observable - å¯è¢«ç›‘å¬çš„åºåˆ— 2. Observer - è§‚å¯Ÿè€… 3. Observable & Observer æ—¢æ˜¯å¯è¢«ç›‘å¬çš„åºåˆ—ä¹Ÿæ˜¯è§‚å¯Ÿè€… 4. Disposable - å¯è¢«æ¸…é™¤çš„èµ„æº 5. Schedulers - è°ƒåº¦å™¨ 6. Error Handling - é”™è¯¯å¤„ç† 7. Operator - æ“ä½œç¬¦ 7.00 å‡†å¤‡æµ‹è¯•ä½¿ç”¨çš„æ–¹æ³• 7.01 Debug Operator 7.02 åˆ›å»º Observable 7.03 å˜æ¢ Observable 7.04 è¿‡æ»¤ Observable 7.05 è”åˆ Observable 7.06 é”™è¯¯å¤„ç†æ“ä½œç¬¦ 7.07 æ¡ä»¶å’Œ Bool æ“ä½œç¬¦ 7.08 æ•°å­¦å’Œèšåˆæ“ä½œç¬¦ 7.09 è¿æ¥ Observable æ“ä½œç¬¦ 7.10 Time Operator 7.11 Scheduler Operator 7.12 Materialize Operator 7.13 Using Operator 8. å…¶ä»–ç›¸å…³èµ„æ–™ "},"RxSwiftStudy/1.Observable-å¯è¢«ç›‘å¬çš„åºåˆ—.html":{"url":"RxSwiftStudy/1.Observable-å¯è¢«ç›‘å¬çš„åºåˆ—.html","title":"1. Observable - å¯è¢«ç›‘å¬çš„åºåˆ—","keywords":"","body":"å‡†å¤‡ typealias JSON = Any struct TError: Error { var errorCode: Int = 0 var errorString: String = \"\" var errorData: Any? func printLog() { print(errorCode) print(errorString) if let data = errorData as? Data { let str = String.init(data: data, encoding: String.Encoding.utf8) print(str ?? \"NULL Error Data\") } } } Observable - å¯è¢«ç›‘å¬çš„åºåˆ— https://beeth0ven.github.io/RxSwift-Chinese-Documentation/content/rxswift_core/observable.html public protocol ObservableConvertibleType { ... ... } public protocol ObservableType : ObservableConvertibleType { ... ... } public class Observable : ObservableType { ... ... } å¦‚ä½•åˆ›å»ºåºåˆ— ç°åœ¨æˆ‘ä»¬å·²ç»å¯ä»¥æŠŠç”Ÿæ´»ä¸­çš„è®¸å¤šäº‹ç‰©çœ‹ä½œæ˜¯ä¸€ä¸ªåºåˆ—äº†ã€‚é‚£ä¹ˆæˆ‘ä»¬è¦æ€ä¹ˆåˆ›å»ºè¿™äº›åºåˆ—å‘¢ï¼Ÿ å®é™…ä¸Šï¼Œæ¡†æ¶å·²ç»å¸®æˆ‘ä»¬åˆ›å»ºå¥½äº†è®¸å¤šå¸¸ç”¨çš„åºåˆ—ã€‚ä¾‹å¦‚ï¼šbuttonçš„ç‚¹å‡»ï¼ŒtextFieldçš„å½“å‰æ–‡æœ¬ï¼Œswitchçš„å¼€å…³çŠ¶æ€ï¼Œsliderçš„å½“å‰æ•°å€¼ç­‰ç­‰ã€‚ å¦å¤–ï¼Œæœ‰ä¸€äº›è‡ªå®šä¹‰çš„åºåˆ—æ˜¯éœ€è¦æˆ‘ä»¬è‡ªå·±åˆ›å»ºçš„ã€‚è¿™é‡Œä»‹ç»ä¸€ä¸‹åˆ›å»ºåºåˆ—æœ€åŸºæœ¬çš„æ–¹æ³•ï¼Œä¾‹å¦‚ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª [0, 1, ... 8, 9] çš„åºåˆ—ï¼š let numbers: Observable = Observable.create { observer -> Disposable in observer.onNext(0) observer.onNext(1) observer.onNext(2) observer.onNext(3) observer.onNext(4) observer.onNext(5) observer.onNext(6) observer.onNext(7) observer.onNext(8) observer.onNext(9) observer.onCompleted() return Disposables.create() } åˆ›å»ºåºåˆ—æœ€ç›´æ¥çš„æ–¹æ³•å°±æ˜¯è°ƒç”¨ Observable.createï¼Œç„¶ååœ¨æ„å»ºå‡½æ•°é‡Œé¢æè¿°å…ƒç´ çš„äº§ç”Ÿè¿‡ç¨‹ã€‚ observer.onNext(0) å°±ä»£è¡¨äº§ç”Ÿäº†ä¸€ä¸ªå…ƒç´ ï¼Œä»–çš„å€¼æ˜¯ 0ã€‚åé¢åˆäº§ç”Ÿäº† 9 ä¸ªå…ƒç´ åˆ†åˆ«æ˜¯ 1, 2, ... 8, 9 ã€‚æœ€åï¼Œç”¨ observer.onCompleted() è¡¨ç¤ºå…ƒç´ å·²ç»å…¨éƒ¨äº§ç”Ÿï¼Œæ²¡æœ‰æ›´å¤šå…ƒç´ äº†ã€‚ func getObservable(with url: String) -> Observable { return Observable.create { (observer) -> Disposable in guard let url = URL.init(string: url) else { let err = TError.init(errorCode: 10, errorString: \"url error\", errorData: nil) observer.onError(err) return Disposables.create() } let request = URLRequest.init(url: url) let task = URLSession.shared.dataTask(with: request, completionHandler: { (data, response, error) in if let err = error { observer.onError(err) return } guard let jsonData = data, let jsonObj = try? JSONSerialization.jsonObject(with: jsonData, options: .mutableLeaves) else { let err = TError.init(errorCode: 11, errorString: \"json error\", errorData: data) observer.onError(err) return } // æµ‹è¯•å¤šä¸ªäº‹ä»¶ // observer.onNext(1234) observer.onNext(jsonObj) observer.onCompleted() // onCompletedä¹‹åä¸å‘é€ observer.onNext(2222222) observer.onCompleted() }) task.resume() return Disposables.create { task.cancel() } } } åœ¨é—­åŒ…å›è°ƒä¸­ï¼Œå¦‚æœä»»åŠ¡å¤±è´¥ï¼Œå°±è°ƒç”¨ observer.onError(error!)ã€‚å¦‚æœè·å–åˆ°ç›®æ ‡å…ƒç´ ï¼Œå°±è°ƒç”¨ observer.onNext(jsonObject)ã€‚ç”±äºæˆ‘ä»¬çš„è¿™ä¸ªåºåˆ—åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œæ‰€ä»¥åœ¨æˆåŠŸè·å–åˆ°å…ƒç´ åï¼Œå°±ç›´æ¥è°ƒç”¨ observer.onCompleted() æ¥è¡¨ç¤ºä»»åŠ¡ç»“æŸã€‚æœ€å Disposables.create { task.cancel() } è¯´æ˜å¦‚æœæ•°æ®ç»‘å®šè¢«æ¸…é™¤ï¼ˆè®¢é˜…è¢«å–æ¶ˆï¼‰çš„è¯ï¼Œå°±å–æ¶ˆç½‘ç»œè¯·æ±‚ã€‚ è¿™æ ·ä¸€æ¥æˆ‘ä»¬å°±å°†ä¼ ç»Ÿçš„é—­åŒ…å›è°ƒè½¬æ¢æˆåºåˆ—äº†ã€‚ç„¶åå¯ä»¥ç”¨ subscribe æ–¹æ³•æ¥å“åº”è¿™ä¸ªè¯·æ±‚çš„ç»“æœï¼š func testObservable() { getObservable(with: githubStr).subscribe(onNext: { (jsonObj) in print(\"Get JSON success\") if jsonObj is Int { print(jsonObj) return } guard JSONSerialization.isValidJSONObject(jsonObj) else { return } if let jsonData = try? JSONSerialization.data(withJSONObject: jsonObj, options: .prettyPrinted) { let jsonStr = String.init(data: jsonData, encoding: String.Encoding.utf8) print(jsonStr ?? \"\") } }, onError: { (error) in if let error = error as? TError { error.printLog() } else { print(error.localizedDescription) } }, onCompleted: { print(\"completed\") }).disposed(by: disposeBag) } Event - äº‹ä»¶ public enum Event { case next(Element) case error(Swift.Error) case completed } next - åºåˆ—äº§ç”Ÿäº†ä¸€ä¸ªæ–°çš„å…ƒç´  error - åˆ›å»ºåºåˆ—æ—¶äº§ç”Ÿäº†ä¸€ä¸ªé”™è¯¯ï¼Œå¯¼è‡´åºåˆ—ç»ˆæ­¢ completed - åºåˆ—çš„æ‰€æœ‰å…ƒç´ éƒ½å·²ç»æˆåŠŸäº§ç”Ÿï¼Œæ•´ä¸ªåºåˆ—å·²ç»å®Œæˆ ä½ å¯ä»¥åˆç†çš„åˆ©ç”¨è¿™äº› Event æ¥å®ç°ä¸šåŠ¡é€»è¾‘ã€‚ Single https://beeth0ven.github.io/RxSwift-Chinese-Documentation/content/rxswift_core/observable/single.html public struct PrimitiveSequence { let source: Observable init(raw: Observable) { self.source = raw } } public enum SingleTrait { } public typealias Single = PrimitiveSequence Single æ˜¯ Observable çš„å¦å¤–ä¸€ä¸ªç‰ˆæœ¬ã€‚ä¸åƒ Observable å¯ä»¥å‘å‡ºå¤šä¸ªå…ƒç´ ï¼Œå®ƒè¦ä¹ˆåªèƒ½å‘å‡ºä¸€ä¸ªå…ƒç´ ï¼Œè¦ä¹ˆäº§ç”Ÿä¸€ä¸ª error äº‹ä»¶ã€‚ å‘å‡ºä¸€ä¸ªå…ƒç´ ï¼Œæˆ–ä¸€ä¸ª error äº‹ä»¶ ä¸ä¼šå…±äº«çŠ¶æ€å˜åŒ– ä¸€ä¸ªæ¯”è¾ƒå¸¸è§çš„ä¾‹å­å°±æ˜¯æ‰§è¡Œ HTTP è¯·æ±‚ï¼Œç„¶åè¿”å›ä¸€ä¸ªåº”ç­”æˆ–é”™è¯¯ã€‚ä¸è¿‡ä½ ä¹Ÿå¯ä»¥ç”¨ Single æ¥æè¿°ä»»ä½•åªæœ‰ä¸€ä¸ªå…ƒç´ çš„åºåˆ—ã€‚ å¦‚ä½•åˆ›å»º Single åˆ›å»º Single å’Œåˆ›å»º Observable éå¸¸ç›¸ä¼¼ï¼š func getRepo(_ repo: String) -> Single { return Single.create { (single) -> Disposable in guard let url = URL.init(string: \"https://api.github.com/repos/\\(repo)\") else { let err = TError.init(errorCode: 10, errorString: \"url error\", errorData: nil) single(.error(err)) return Disposables.create() } let task = URLSession.shared.dataTask(with: url, completionHandler: { (data, response, error) in if error != nil { let err = TError.init(errorCode: 20, errorString: \"request error\", errorData: data) single(.error(err)) return } guard let jsonData = data, let jsonObj = try? JSONSerialization.jsonObject(with: jsonData, options: .mutableLeaves), let result = jsonObj as? [String: Any] else { let err = TError.init(errorCode: 30, errorString: \"json error\", errorData: data) single(.error(err)) return } single(.success(result)) // åªä¼šè¿è¡Œç¬¬ä¸€ä¸ªsingle single(.success([\"1\":2])) }) task.resume() return Disposables.create { task.cancel() } } } ä¹‹åï¼Œä½ å¯ä»¥è¿™æ ·ä½¿ç”¨ Singleï¼š func testSingle() { getRepo(\"ReactiveX/RxSwift\") .subscribe(onSuccess: { (dict) in print(dict) }, onError: { (error) in guard let err = error as? TError else { print(error.localizedDescription) return } err.printLog() }) .disposed(by: disposeBag) }} è®¢é˜…æä¾›ä¸€ä¸ª SingleEvent çš„æšä¸¾ï¼š public enum SingleEvent { case success(Element) case error(Swift.Error) } success - äº§ç”Ÿä¸€ä¸ªå•ç‹¬çš„å…ƒç´  error - äº§ç”Ÿä¸€ä¸ªé”™è¯¯ ä½ åŒæ ·å¯ä»¥å¯¹ Observable è°ƒç”¨ .asSingle() æ–¹æ³•ï¼Œå°†å®ƒè½¬æ¢ä¸º Singleï¼Œäº‹ä»¶çš„å¯¹åº”å…³ç³»å¦‚ä¸‹ï¼š Event => SingleEvent 1 * next(Element) + completed => success(Element) n * next(Element) + completed or error(Swift.Error) => error(Swift.Error) eg: func testObservableAsSingle() { getObservable(with: githubStr) .asSingle() .subscribe(onSuccess: { (jsonObj) in // 1*onNext + 1*onCompleted print(\"Get JSON success\") if jsonObj is Int { print(jsonObj) return } guard JSONSerialization.isValidJSONObject(jsonObj) else { return } if let jsonData = try? JSONSerialization.data(withJSONObject: jsonObj, options: .prettyPrinted) { let jsonStr = String.init(data: jsonData, encoding: String.Encoding.utf8) print(jsonStr ?? \"\") } }, onError: { (error) in // n*onNext + 1*onCompleted || onError if let error = error as? TError { error.printLog() } else { print(error.localizedDescription) } }) .disposed(by: disposeBag) } Completable https://beeth0ven.github.io/RxSwift-Chinese-Documentation/content/rxswift_core/observable/completeable.html public struct PrimitiveSequence { let source: Observable init(raw: Observable) { self.source = raw } } public enum CompletableTrait { } public typealias Completable = PrimitiveSequence Completable æ˜¯ Observable çš„å¦å¤–ä¸€ä¸ªç‰ˆæœ¬ã€‚ä¸åƒ Observable å¯ä»¥å‘å‡ºå¤šä¸ªå…ƒç´ ï¼Œå®ƒè¦ä¹ˆåªèƒ½äº§ç”Ÿä¸€ä¸ª completed äº‹ä»¶ï¼Œè¦ä¹ˆäº§ç”Ÿä¸€ä¸ª error äº‹ä»¶ã€‚ å‘å‡ºé›¶ä¸ªå…ƒç´  å‘å‡ºä¸€ä¸ª completed äº‹ä»¶æˆ–è€…ä¸€ä¸ª error äº‹ä»¶ ä¸ä¼šå…±äº«çŠ¶æ€å˜åŒ– Completable é€‚ç”¨äºé‚£ç§ä½ åªå…³å¿ƒä»»åŠ¡æ˜¯å¦å®Œæˆï¼Œè€Œä¸éœ€è¦åœ¨æ„ä»»åŠ¡è¿”å›å€¼çš„æƒ…å†µã€‚å®ƒå’Œ Observable æœ‰ç‚¹ç›¸ä¼¼ã€‚ å¦‚ä½•åˆ›å»º Completable åˆ›å»º Completable å’Œåˆ›å»º Observable éå¸¸ç›¸ä¼¼ï¼š func getCompletable() -> Completable { return Completable.create { (completable) -> Disposable in guard let url = URL.init(string: \"http://www.baidu.com/\") else { completable(.error(TError.init(errorCode: 10, errorString: \"url error\", errorData: nil))) return Disposables.create() } let task = URLSession.shared.dataTask(with: url, completionHandler: { (data, response, error) in if let errInfo = error { completable(.error(errInfo)) } else { completable(.completed) } }) task.resume() return Disposables.create { task.cancel() } } } ä¹‹åï¼Œä½ å¯ä»¥è¿™æ ·ä½¿ç”¨ Completableï¼š func testCompletable() { getCompletable() .subscribe(onCompleted: { print(\"Completable onCompleted\") }, onError: { (error) in if let err = error as? TError { err.printLog() return } print(error.localizedDescription) }) .disposed(by: disposeBag) } Maybe https://beeth0ven.github.io/RxSwift-Chinese-Documentation/content/rxswift_core/observable/maybe.html public struct PrimitiveSequence { let source: Observable init(raw: Observable) { self.source = raw } } public enum MaybeTrait { } public typealias Maybe = PrimitiveSequence Maybe æ˜¯ Observable çš„å¦å¤–ä¸€ä¸ªç‰ˆæœ¬ã€‚å®ƒä»‹äº Single å’Œ Completable ä¹‹é—´ï¼Œå®ƒè¦ä¹ˆåªèƒ½å‘å‡ºä¸€ä¸ªå…ƒç´ ï¼Œè¦ä¹ˆäº§ç”Ÿä¸€ä¸ª completed äº‹ä»¶ï¼Œè¦ä¹ˆäº§ç”Ÿä¸€ä¸ª error äº‹ä»¶ã€‚ å‘å‡ºä¸€ä¸ªå…ƒç´ æˆ–è€…ä¸€ä¸ª completed äº‹ä»¶æˆ–è€…ä¸€ä¸ª error äº‹ä»¶ ä¸ä¼šå…±äº«çŠ¶æ€å˜åŒ– å¦‚æœä½ é‡åˆ°é‚£ç§å¯èƒ½éœ€è¦å‘å‡ºä¸€ä¸ªå…ƒç´ ï¼Œåˆå¯èƒ½ä¸éœ€è¦å‘å‡ºæ—¶ï¼Œå°±å¯ä»¥ä½¿ç”¨ Maybeã€‚ å¦‚ä½•åˆ›å»º Maybe åˆ›å»º Maybe å’Œåˆ›å»º Observable éå¸¸ç›¸ä¼¼ï¼š func getMaybe() -> Maybe { return Maybe.create { (maybe) -> Disposable in guard let url = URL.init(string: \"http://www.baidu.com/\") else { maybe(.error(TError.init(errorCode: 10, errorString: \"url error\", errorData: nil))) return Disposables.create() } let task = URLSession.shared.dataTask(with: url, completionHandler: { (data, response, error) in if let errInfo = error { maybe(.error(errInfo)) return } if let data = data { maybe(.success(data)) return } // æ— é”™è¯¯ä¹Ÿæ— æ•°æ®è¿”å› maybe(.completed) }) task.resume() return Disposables.create { task.cancel() } } } ä¹‹åï¼Œä½ å¯ä»¥è¿™æ ·ä½¿ç”¨ Maybeï¼š testMaybe() { getMaybe() .subscribe(onSuccess: { (data) in print(data.debugDescription) }, onError: { (err) in if let err = err as? TError { err.printLog() return } print(err.localizedDescription) }, onCompleted: { print(\"Completed With No Data\") }) .disposed(by: disposeBag) } è®¢é˜…æä¾›ä¸€ä¸ª MaybeEvent çš„æšä¸¾ï¼š public enum MaybeEvent { case success(Element) case error(Swift.Error) case completed } ä½ åŒæ ·å¯ä»¥å¯¹ Observable è°ƒç”¨ .asMaybe() æ–¹æ³•ï¼Œå°†å®ƒè½¬æ¢ä¸º Maybeã€‚äº‹ä»¶çš„å¯¹åº”å…³ç³»å¦‚ä¸‹ï¼š Event => MaybeEvent 1 * next(Element) + completed => success(Element) n * next(Element) + completed or error(Swift.Error) => error(Swift.Error) 1 * completed => completed func testObservableAsMaybe() { getObservable(with: githubStr) .asMaybe() .subscribe(onSuccess: { (jsonObj) in // 1*onNext + 1*onCompleted print(\"Get JSON success\") if jsonObj is Int { print(jsonObj) return } guard JSONSerialization.isValidJSONObject(jsonObj) else { return } if let jsonData = try? JSONSerialization.data(withJSONObject: jsonObj, options: .prettyPrinted) { let jsonStr = String.init(data: jsonData, encoding: String.Encoding.utf8) print(jsonStr ?? \"\") } }, onError: { (error) in // n*onNext + 1*onCompleted || onError if let error = error as? TError { error.printLog() } else { print(error.localizedDescription) } }, onCompleted: { // 1*onCompleted print(\"completed\") }) .disposed(by: disposeBag) } Driver https://beeth0ven.github.io/RxSwift-Chinese-Documentation/content/rxswift_core/observable/driver.html public protocol ObservableConvertibleType { associatedtype E func asObservable() -> Observable } public protocol SharedSequenceConvertibleType : ObservableConvertibleType { associatedtype SharingStrategy: SharingStrategyProtocol func asSharedSequence() -> SharedSequence } public struct SharedSequence : SharedSequenceConvertibleType { ... ... } public struct DriverSharingStrategy: SharingStrategyProtocol { public static var scheduler: SchedulerType { return SharingScheduler.make() } public static func share(_ source: Observable) -> Observable { return source.share(replay: 1, scope: .whileConnected) } } public typealias Driver = SharedSequence Driverï¼ˆå¸æœºï¼Ÿï¼‰ æ˜¯ä¸€ä¸ªç²¾å¿ƒå‡†å¤‡çš„ç‰¹å¾åºåˆ—ã€‚å®ƒä¸»è¦æ˜¯ä¸ºäº†ç®€åŒ– UI å±‚çš„ä»£ç ã€‚ä¸è¿‡å¦‚æœä½ é‡åˆ°çš„åºåˆ—å…·æœ‰ä»¥ä¸‹ç‰¹å¾ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨å®ƒï¼š ä¸ä¼šäº§ç”Ÿ error äº‹ä»¶ ä¸€å®šåœ¨ MainScheduler ç›‘å¬ï¼ˆä¸»çº¿ç¨‹ç›‘å¬ï¼‰ å…±äº«çŠ¶æ€å˜åŒ– è¿™äº›éƒ½æ˜¯é©±åŠ¨ UI çš„åºåˆ—æ‰€å…·æœ‰çš„ç‰¹å¾ã€‚ ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ Driver ï¼Ÿ æˆ‘ä»¬ä¸¾ä¸ªä¾‹å­æ¥è¯´æ˜ä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆè¦ä½¿ç”¨ Driverã€‚ è¿™æ˜¯æ–‡æ¡£ç®€ä»‹é¡µçš„ä¾‹å­ï¼š let results = query.rx.text .throttle(0.3, scheduler: MainScheduler.instance) .flatMapLatest { query in fetchAutoCompleteItems(query) } results .map { \"\\($0.count)\" } .bind(to: resultCount.rx.text) .disposed(by: disposeBag) results .bind(to: resultsTableView.rx.items(cellIdentifier: \"Cell\")) { (_, result, cell) in cell.textLabel?.text = \"\\(result)\" } .disposed(by: disposeBag) è¿™æ®µä»£ç çš„ä¸»è¦ç›®çš„æ˜¯ï¼š å–å‡ºç”¨æˆ·è¾“å…¥ç¨³å®šåçš„å†…å®¹ å‘æœåŠ¡å™¨è¯·æ±‚ä¸€ç»„ç»“æœ å°†è¿”å›çš„ç»“æœç»‘å®šåˆ°ä¸¤ä¸ª UI å…ƒç´ ä¸Šï¼štableView å’Œ æ˜¾ç¤ºç»“æœæ•°é‡çš„label é‚£ä¹ˆè¿™é‡Œå­˜åœ¨ä»€ä¹ˆé—®é¢˜ï¼Ÿ å¦‚æœ fetchAutoCompleteItems çš„åºåˆ—äº§ç”Ÿäº†ä¸€ä¸ªé”™è¯¯ï¼ˆç½‘ç»œè¯·æ±‚å¤±è´¥ï¼‰ï¼Œè¿™ä¸ªé”™è¯¯å°†å–æ¶ˆæ‰€æœ‰ç»‘å®šï¼Œå½“ç”¨æˆ·è¾“å…¥ä¸€ä¸ªæ–°çš„å…³é”®å­—æ—¶ï¼Œæ˜¯æ— æ³•å‘èµ·æ–°çš„ç½‘ç»œè¯·æ±‚ã€‚ å¦‚æœ fetchAutoCompleteItems åœ¨åå°è¿”å›åºåˆ—ï¼Œé‚£ä¹ˆåˆ·æ–°é¡µé¢ä¹Ÿä¼šåœ¨åå°è¿›è¡Œï¼Œè¿™æ ·å°±ä¼šå‡ºç°å¼‚å¸¸å´©æºƒã€‚ è¿”å›çš„ç»“æœè¢«ç»‘å®šåˆ°ä¸¤ä¸ª UI å…ƒç´ ä¸Šã€‚é‚£å°±æ„å‘³ç€ï¼Œæ¯æ¬¡ç”¨æˆ·è¾“å…¥ä¸€ä¸ªæ–°çš„å…³é”®å­—æ—¶ï¼Œå°±ä¼šåˆ†åˆ«ä¸ºä¸¤ä¸ª UI å…ƒç´ å‘èµ· HTTP è¯·æ±‚ï¼Œè¿™å¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç»“æœã€‚ ä¸€ä¸ªæ›´å¥½çš„æ–¹æ¡ˆæ˜¯è¿™æ ·çš„ï¼š let results = query.rx.text .throttle(0.3, scheduler: MainScheduler.instance) .flatMapLatest { query in fetchAutoCompleteItems(query) .observeOn(MainScheduler.instance) // ç»“æœåœ¨ä¸»çº¿ç¨‹è¿”å› .catchErrorJustReturn([]) // é”™è¯¯è¢«å¤„ç†äº†ï¼Œè¿™æ ·è‡³å°‘ä¸ä¼šç»ˆæ­¢æ•´ä¸ªåºåˆ— } .share(replay: 1) // HTTP è¯·æ±‚æ˜¯è¢«å…±äº«çš„ results .map { \"\\($0.count)\" } .bind(to: resultCount.rx.text) .disposed(by: disposeBag) results .bind(to: resultsTableView.rx.items(cellIdentifier: \"Cell\")) { (_, result, cell) in cell.textLabel?.text = \"\\(result)\" } .disposed(by: disposeBag) åœ¨ä¸€ä¸ªå¤§å‹ç³»ç»Ÿå†…ï¼Œè¦ç¡®ä¿æ¯ä¸€æ­¥ä¸è¢«é—æ¼æ˜¯ä¸€ä»¶ä¸å¤ªå®¹æ˜“çš„äº‹æƒ…ã€‚æ‰€ä»¥æ›´å¥½çš„é€‰æ‹©æ˜¯åˆç†è¿ç”¨ç¼–è¯‘å™¨å’Œç‰¹å¾åºåˆ—æ¥ç¡®ä¿è¿™äº›å¿…å¤‡æ¡ä»¶éƒ½å·²ç»æ»¡è¶³ã€‚ ä»¥ä¸‹æ˜¯ä½¿ç”¨ Driver ä¼˜åŒ–åçš„ä»£ç ï¼š let results = query.rx.text.asDriver() // å°†æ™®é€šåºåˆ—è½¬æ¢ä¸º Driver .throttle(0.3, scheduler: MainScheduler.instance) .flatMapLatest { query in fetchAutoCompleteItems(query) .asDriver(onErrorJustReturn: []) // ä»…ä»…æä¾›å‘ç”Ÿé”™è¯¯æ—¶çš„å¤‡é€‰è¿”å›å€¼ } results .map { \"\\($0.count)\" } .drive(resultCount.rx.text) // è¿™é‡Œæ”¹ç”¨ `drive` è€Œä¸æ˜¯ `bindTo` .disposed(by: disposeBag) // è¿™æ ·å¯ä»¥ç¡®ä¿å¿…å¤‡æ¡ä»¶éƒ½å·²ç»æ»¡è¶³äº† results .drive(resultsTableView.rx.items(cellIdentifier: \"Cell\")) { (_, result, cell) in cell.textLabel?.text = \"\\(result)\" } .disposed(by: disposeBag) é¦–å…ˆç¬¬ä¸€ä¸ª asDriver æ–¹æ³•å°† ControlProperty è½¬æ¢ä¸º Driver ç„¶åç¬¬äºŒä¸ªå˜åŒ–æ˜¯ï¼š .asDriver(onErrorJustReturn: []) ä»»ä½•å¯è¢«ç›‘å¬çš„åºåˆ—éƒ½å¯ä»¥è¢«è½¬æ¢ä¸º Driverï¼Œåªè¦ä»–æ»¡è¶³ 3 ä¸ªæ¡ä»¶ï¼š ä¸ä¼šäº§ç”Ÿ error äº‹ä»¶ ä¸€å®šåœ¨ MainScheduler ç›‘å¬ï¼ˆä¸»çº¿ç¨‹ç›‘å¬ï¼‰ å…±äº«çŠ¶æ€å˜åŒ– é‚£ä¹ˆè¦å¦‚ä½•ç¡®å®šæ¡ä»¶éƒ½è¢«æ»¡è¶³ï¼Ÿé€šè¿‡ Rx æ“ä½œç¬¦æ¥è¿›è¡Œè½¬æ¢ã€‚asDriver(onErrorJustReturn: []) ç›¸å½“äºä»¥ä¸‹ä»£ç ï¼š let safeSequence = xs .observeOn(MainScheduler.instance) // ä¸»çº¿ç¨‹ç›‘å¬ .catchErrorJustReturn(onErrorJustReturn) // æ— æ³•äº§ç”Ÿé”™è¯¯ .share(replay: 1, scope: .whileConnected)// å…±äº«çŠ¶æ€å˜åŒ– return Driver(raw: safeSequence) // å°è£… æœ€åä½¿ç”¨ drive è€Œä¸æ˜¯ bindTo drive æ–¹æ³•åªèƒ½è¢« Driver è°ƒç”¨ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœä½ å‘ç°ä»£ç æ‰€å­˜åœ¨ driveï¼Œé‚£ä¹ˆè¿™ä¸ªåºåˆ—ä¸ä¼šäº§ç”Ÿé”™è¯¯äº‹ä»¶å¹¶ä¸”ä¸€å®šåœ¨ä¸»çº¿ç¨‹ç›‘å¬ã€‚è¿™æ ·ä½ å¯ä»¥å®‰å…¨çš„ç»‘å®š UI å…ƒç´ ã€‚ eg: func testObservableAsDriver() { func getImage() -> Observable { return Observable.create { (observer) -> Disposable in let downloadToken = SDWebImageDownloader.shared().downloadImage( with: URL.init(string: \"https://avatars1.githubusercontent.com/u/11990850\"), options: SDWebImageDownloaderOptions.highPriority, progress: nil, completed: { (image, data, error, finished) in if let img = image { observer.onNext(img) observer.onCompleted() return } if let err = error { observer.onError(err) return } observer.onError(TError.init(errorCode: 10, errorString: \"UNKNOW ERROR\", errorData: data)) } ) return Disposables.create { SDWebImageDownloader.shared().cancel(downloadToken) } } } getImage() .asDriver(onErrorJustReturn: #imageLiteral(resourceName: \"placeholderImg\")) .drive(self.imageView.rx.image) .disposed(by: disposeBag) } ControlEvent https://beeth0ven.github.io/RxSwift-Chinese-Documentation/content/rxswift_core/observable/control_event.html public protocol ObservableType : ObservableConvertibleType { func subscribe(_ observer: O) -> Disposable where O.E == E } public protocol ControlEventType : ObservableType { func asControlEvent() -> ControlEvent } public struct ControlEvent : ControlEventType { ... ... } ControlEvent ä¸“é—¨ç”¨äºæè¿° UI æ§ä»¶æ‰€äº§ç”Ÿçš„äº‹ä»¶ï¼Œå®ƒå…·æœ‰ä»¥ä¸‹ç‰¹å¾ï¼š ä¸ä¼šäº§ç”Ÿ error äº‹ä»¶ ä¸€å®šåœ¨ MainScheduler è®¢é˜…ï¼ˆä¸»çº¿ç¨‹è®¢é˜…ï¼‰ ä¸€å®šåœ¨ MainScheduler ç›‘å¬ï¼ˆä¸»çº¿ç¨‹ç›‘å¬ï¼‰ å…±äº«çŠ¶æ€å˜åŒ– func testControlEvent() { // extension Reactive where Base: UIButton { // // /// Reactive wrapper for `TouchUpInside` control event. // public var tap: ControlEvent { // return controlEvent(.touchUpInside) // } // } let disposeBag = DisposeBag() self.btn.rx.tap .subscribe(onNext: { [weak self] in let ac = UIAlertController.init(title: \"TEST TAP(touchUpInside)\", message: \"testControlEvent\", preferredStyle: UIAlertControllerStyle.alert) ac.addAction(UIAlertAction.init(title: \"ç¡®å®š\", style: UIAlertActionStyle.cancel, handler: nil)) self?.present(ac, animated: true, completion: nil) }) .disposed(by: disposeBag) self.btn.rx.controlEvent(UIControlEvents.touchDragExit) .subscribe(onNext: { [weak self] in let ac = UIAlertController.init(title: \"TEST touchDragExit\", message: \"testControlEvent\", preferredStyle: UIAlertControllerStyle.alert) ac.addAction(UIAlertAction.init(title: \"ç¡®å®š\", style: UIAlertActionStyle.cancel, handler: nil)) self?.present(ac, animated: true, completion: nil) }) .disposed(by: disposeBag) } æ€»ç»“ Observable => Event public enum Event { case next(Element) case error(Swift.Error) case completed } Single => SingleEvent å‘å‡ºä¸€ä¸ªå…ƒç´ ï¼Œæˆ–ä¸€ä¸ª error äº‹ä»¶ ä¸ä¼šå…±äº«çŠ¶æ€å˜åŒ– public enum SingleEvent { case success(Element) case error(Swift.Error) } Event => SingleEvent 1 * next(Element) + completed => success(Element) n * next(Element) + completed or error(Swift.Error) => error(Swift.Error) Completable è¦ä¹ˆåªèƒ½äº§ç”Ÿä¸€ä¸ª completed äº‹ä»¶ï¼Œè¦ä¹ˆäº§ç”Ÿä¸€ä¸ª error äº‹ä»¶ã€‚é€‚ç”¨äºé‚£ç§ä½ åªå…³å¿ƒä»»åŠ¡æ˜¯å¦å®Œæˆï¼Œè€Œä¸éœ€è¦åœ¨æ„ä»»åŠ¡è¿”å›å€¼çš„æƒ…å†µã€‚å®ƒå’Œ Observable æœ‰ç‚¹ç›¸ä¼¼ã€‚ å‘å‡ºé›¶ä¸ªå…ƒç´  å‘å‡ºä¸€ä¸ª completed äº‹ä»¶æˆ–è€…ä¸€ä¸ª error äº‹ä»¶ ä¸ä¼šå…±äº«çŠ¶æ€å˜åŒ– Maybe => MaybeEvent å‘å‡ºä¸€ä¸ªå…ƒç´ æˆ–è€…ä¸€ä¸ª completed äº‹ä»¶æˆ–è€…ä¸€ä¸ª error äº‹ä»¶ ä¸ä¼šå…±äº«çŠ¶æ€å˜åŒ– public enum MaybeEvent { case success(Element) case error(Swift.Error) case completed } Event => MaybeEvent 1 * next(Element) + completed => success(Element) n * next(Element) + completed or error(Swift.Error) => error(Swift.Error) 1 * completed => completed Driver observableValue.asDriver(onErrorJustReturn: ElementType) å°† Observable è½¬ä¸º Driver ç±»å‹ ä¸ä¼šäº§ç”Ÿ error äº‹ä»¶ ä¸€å®šåœ¨ MainScheduler ç›‘å¬ï¼ˆä¸»çº¿ç¨‹ç›‘å¬ï¼‰ å…±äº«çŠ¶æ€å˜åŒ– ControlEvent control.rx.controlEvent(UIControlEvents.touchUpInside).subscribe(...) ControlEvent ä¸“é—¨ç”¨äºæè¿° UI æ§ä»¶æ‰€äº§ç”Ÿçš„äº‹ä»¶ ä¸ä¼šäº§ç”Ÿ error äº‹ä»¶ ä¸€å®šåœ¨ MainScheduler è®¢é˜…ï¼ˆä¸»çº¿ç¨‹è®¢é˜…ï¼‰ ä¸€å®šåœ¨ MainScheduler ç›‘å¬ï¼ˆä¸»çº¿ç¨‹ç›‘å¬ï¼‰ å…±äº«çŠ¶æ€å˜åŒ– "},"RxSwiftStudy/2.Observer-è§‚å¯Ÿè€….html":{"url":"RxSwiftStudy/2.Observer-è§‚å¯Ÿè€….html","title":"2. Observer - è§‚å¯Ÿè€…","keywords":"","body":"Observer - è§‚å¯Ÿè€… https://beeth0ven.github.io/RxSwift-Chinese-Documentation/content/rxswift_core/observer.html è§‚å¯Ÿè€… æ˜¯ç”¨æ¥ç›‘å¬äº‹ä»¶ï¼Œç„¶åå®ƒéœ€è¦è¿™ä¸ªäº‹ä»¶åšå‡ºå“åº”ã€‚ä¾‹å¦‚ï¼šå¼¹å‡ºæç¤ºæ¡†å°±æ˜¯è§‚å¯Ÿè€…ï¼Œå®ƒå¯¹ç‚¹å‡»æŒ‰é’®è¿™ä¸ªäº‹ä»¶åšå‡ºå“åº”ã€‚ å¦‚ä½•åˆ›å»ºè§‚å¯Ÿè€… å’Œ Observable ä¸€æ ·ï¼Œæ¡†æ¶å·²ç»å¸®æˆ‘ä»¬åˆ›å»ºå¥½äº†è®¸å¤šå¸¸ç”¨çš„è§‚å¯Ÿè€…ã€‚ä¾‹å¦‚ï¼šview æ˜¯å¦éšè—ï¼Œbutton æ˜¯å¦å¯ç‚¹å‡»ï¼Œ label çš„å½“å‰æ–‡æœ¬ï¼ŒimageView çš„å½“å‰å›¾ç‰‡ç­‰ç­‰ã€‚å¦å¤–ï¼Œæœ‰ä¸€äº›è‡ªå®šä¹‰çš„è§‚å¯Ÿè€…æ˜¯éœ€è¦æˆ‘ä»¬è‡ªå·±åˆ›å»ºçš„ã€‚ tap.subscribe(onNext: { [weak self] in self?.showAlert() }, onError: { error in print(\"å‘ç”Ÿé”™è¯¯ï¼š \\(error.localizedDescription)\") }, onCompleted: { print(\"ä»»åŠ¡å®Œæˆ\") }) åˆ›å»ºè§‚å¯Ÿè€…æœ€ç›´æ¥çš„æ–¹æ³•å°±æ˜¯åœ¨ Observable çš„ subscribe æ–¹æ³•åé¢æè¿°ï¼Œäº‹ä»¶å‘ç”Ÿæ—¶ï¼Œéœ€è¦å¦‚ä½•åšå‡ºå“åº”ã€‚è€Œè§‚å¯Ÿè€…å°±æ˜¯ç”±åé¢çš„ onNextï¼ŒonErrorï¼ŒonCompletedçš„è¿™äº›é—­åŒ…æ„å»ºå‡ºæ¥çš„ã€‚ ä»¥ä¸Šæ˜¯åˆ›å»ºè§‚å¯Ÿè€…æœ€å¸¸è§çš„æ–¹æ³•ã€‚å½“ç„¶ä½ è¿˜å¯ä»¥é€šè¿‡å…¶ä»–çš„æ–¹å¼æ¥åˆ›å»ºè§‚å¯Ÿè€…ï¼Œè¯¦è§ AnyObserver AnyObserver https://beeth0ven.github.io/RxSwift-Chinese-Documentation/content/rxswift_core/observer/any_observer.html public protocol ObserverType { ... ... } public struct AnyObserver : ObserverType { ... ... } AnyObserver å¯ä»¥ç”¨æ¥æå™ä»»æ„ä¸€ç§è§‚å¯Ÿè€…ã€‚ åˆ›å»ºæ–¹å¼ï¼š let observer: AnyObserver = AnyObserver.init { (event) in switch event { case .next(let value): // åºåˆ—å¤„ç† case .error(let error): // error case .completed: // å®Œæˆ } } egï¼š å‡†å¤‡ä»£ç ï¼š func getObservable(with url: String) -> Observable { return Observable.create { (observer) -> Disposable in guard let url = URL.init(string: url) else { let err = TError.init(errorCode: 10, errorString: \"url error\", errorData: nil) observer.onError(err) return Disposables.create() } let request = URLRequest.init(url: url) let task = URLSession.shared.dataTask(with: request, completionHandler: { (data, response, error) in if let err = error { observer.onError(err) return } guard let jsonData = data, let jsonObj = try? JSONSerialization.jsonObject(with: jsonData, options: .mutableLeaves) else { let err = TError.init(errorCode: 11, errorString: \"json error\", errorData: data) observer.onError(err) return } observer.onNext(jsonObj) observer.onCompleted() }) task.resume() return Disposables.create { task.cancel() } } } ä»¥å‰çš„åšæ³•ï¼š func theGeneralPractice() { getObservable(with: \"https://api.github.com/\") .subscribe(onNext: { (jsonObj) in print(\"Get JSON success\") guard JSONSerialization.isValidJSONObject(jsonObj) else { return } if let jsonData = try? JSONSerialization.data(withJSONObject: jsonObj, options: .prettyPrinted) { let jsonStr = String.init(data: jsonData, encoding: String.Encoding.utf8) print(jsonStr ?? \"\") } }, onError: { (error) in if let error = error as? TError { error.printLog() } else { print(error.localizedDescription) } }, onCompleted: { print(\"completed\") }) .disposed(by: disposeBag) } ç›¸å½“äºï¼š func testCreateObserver() { let observer: AnyObserver = AnyObserver.init { (event) in switch event { case .next(let jsonObj): print(\"Get JSON success\") guard JSONSerialization.isValidJSONObject(jsonObj) else { return } if let jsonData = try? JSONSerialization.data(withJSONObject: jsonObj, options: .prettyPrinted) { let jsonStr = String.init(data: jsonData, encoding: String.Encoding.utf8) print(jsonStr ?? \"\") } case .error(let error): if let err = error as? TError { err.printLog() } else { print(error.localizedDescription) } case .completed: print(\"completed\") } } getObservable(with: \"https://api.github.com/\") .subscribe(observer) .disposed(by: disposeBag) } Binder https://beeth0ven.github.io/RxSwift-Chinese-Documentation/content/rxswift_core/observer/binder.html public protocol ObserverType { ... ... } public struct Binder: ObserverType { ... ... } Binder ä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ä¸ªç‰¹å¾ï¼š ä¸ä¼šå¤„ç†é”™è¯¯äº‹ä»¶ ç¡®ä¿ç»‘å®šéƒ½æ˜¯åœ¨ç»™å®š [Scheduler] ä¸Šæ‰§è¡Œï¼ˆé»˜è®¤ MainSchedulerï¼‰ ä¸€æ—¦äº§ç”Ÿé”™è¯¯äº‹ä»¶ï¼Œåœ¨è°ƒè¯•ç¯å¢ƒä¸‹å°†æ‰§è¡Œ fatalErrorï¼Œåœ¨å‘å¸ƒç¯å¢ƒä¸‹å°†æ‰“å°é”™è¯¯ä¿¡æ¯ã€‚ ç¤ºä¾‹ åœ¨ä»‹ç» AnyObserver æ—¶ï¼Œæˆ‘ä»¬ä¸¾äº†è¿™æ ·ä¸€ä¸ªä¾‹å­ï¼š let observer: AnyObserver = AnyObserver { [weak self] (event) in switch event { case .next(let isHidden): self?.usernameValidOutlet.isHidden = isHidden default: break } } usernameValid .bind(to: observer) .disposed(by: disposeBag) ç”±äºè¿™ä¸ªè§‚å¯Ÿè€…æ˜¯ä¸€ä¸ª UI è§‚å¯Ÿè€…ï¼Œæ‰€ä»¥å®ƒåœ¨å“åº”äº‹ä»¶æ—¶ï¼Œåªä¼šå¤„ç† next äº‹ä»¶ï¼Œå¹¶ä¸”æ›´æ–° UI çš„æ“ä½œéœ€è¦åœ¨ä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œã€‚ å› æ­¤ä¸€ä¸ªæ›´å¥½çš„æ–¹æ¡ˆå°±æ˜¯ä½¿ç”¨ Binderï¼š let observer: Binder = Binder(usernameValidOutlet) { (view, isHidden) in view.isHidden = isHidden } usernameValid .bind(to: observer) .disposed(by: disposeBag) Binder å¯ä»¥åªå¤„ç† next äº‹ä»¶ï¼Œå¹¶ä¸”ä¿è¯å“åº” next äº‹ä»¶çš„ä»£ç ä¸€å®šä¼šåœ¨ç»™å®š [Scheduler] ä¸Šæ‰§è¡Œï¼Œè¿™é‡Œé‡‡ç”¨é»˜è®¤çš„ MainSchedulerã€‚ å¤ç”¨ ç”±äºé¡µé¢æ˜¯å¦éšè—æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„è§‚å¯Ÿè€…ï¼Œæ‰€ä»¥åº”è¯¥è®©æ‰€æœ‰çš„ UIView éƒ½æä¾›è¿™ç§è§‚å¯Ÿè€…ï¼š extension Reactive where Base: UIView { public var isHidden: Binder { return Binder(self.base) { view, hidden in view.isHidden = hidden } } } usernameValid .bind(to: usernameValidOutlet.rx.isHidden) .disposed(by: disposeBag) è¿™æ ·ä½ ä¸å¿…ä¸ºæ¯ä¸ª UI æ§ä»¶å•ç‹¬åˆ›å»ºè¯¥è§‚å¯Ÿè€…ã€‚è¿™å°±æ˜¯ usernameValidOutlet.rx.isHidden çš„ç”±æ¥ï¼Œè®¸å¤š UI è§‚å¯Ÿè€… éƒ½æ˜¯è¿™æ ·åˆ›å»ºçš„ï¼š æŒ‰é’®æ˜¯å¦å¯ç‚¹å‡» button.rx.isEnabledï¼š extension Reactive where Base: UIControl { public var isEnabled: Binder { return Binder(self.base) { control, value in control.isEnabled = value } } } label çš„å½“å‰æ–‡æœ¬ label.rx.textï¼š extension Reactive where Base: UILabel { public var text: Binder { return Binder(self.base) { label, text in label.text = text } } } ä½ ä¹Ÿå¯ä»¥ç”¨è¿™ç§æ–¹å¼æ¥åˆ›å»ºè‡ªå®šä¹‰çš„ UI è§‚å¯Ÿè€…ã€‚ eg: å‡†å¤‡ä»£ç ï¼š func getImage() -> Observable { return Observable.create { (observer) -> Disposable in let downloadToken = SDWebImageDownloader.shared().downloadImage( with: URL.init(string: \"https://avatars1.githubusercontent.com/u/11990850\"), options: SDWebImageDownloaderOptions.highPriority, progress: nil, completed: { (image, data, error, finished) in if let img = image { observer.onNext(img) observer.onCompleted() return } if let err = error { observer.onError(err) return } observer.onError(TError.init(errorCode: 10, errorString: \"UNKNOW ERROR\", errorData: data)) } ) return Disposables.create { SDWebImageDownloader.shared().cancel(downloadToken) } } } ä¹‹å‰çš„è°ƒç”¨æ–¹å¼ï¼š getImage().asDriver(onErrorJustReturn: #imageLiteral(resourceName: \"placeholderImg\")) .drive(imageView.rx.image) .disposed(by: disposeBag) å…¶ä¸­ imageView.rx.image å®šä¹‰ä¸­æœ‰ Binder çš„å®šä¹‰ï¼š extension Reactive where Base: UIImageView { /// Bindable sink for `image` property. public var image: Binder { return Binder(base) { imageView, image in imageView.image = image } } } ç›¸å½“äºï¼š func testCreateImageViewBinderObserver() { let observer: Binder = Binder.init(imageView) { (imageView, image) in imageView.image = image } getImage() .asDriver(onErrorJustReturn: #imageLiteral(resourceName: \"placeholderImg\")) .drive(observer) .disposed(by: disposeBag) // getImage() // .observeOn(MainScheduler.instance) // .bind(to: observer) // .disposed(by: disposeBag) } æ€»ç»“ AnyObserver let observer: AnyObserver = AnyObserver.init { (event) in switch event { case .next(let value): // åºåˆ—å¤„ç† case .error(let error): // error case .completed: // å®Œæˆ } } someObservableVar.subscribe(observer).disposed(by: disposeBag) Binder let observer: Binder = Binder.init(imageView) { (imageView, image) in imageView.image = image } let placeholderImage = #imageLiteral(resourceName: \"placeholderImg\") someImageObservableVar.asDriver(onErrorJustReturn: placeholderImage).drive(observer).disposed(by: disposeBag) // æˆ– // someImageObservableVar.observeOn(MainScheduler.instance).bind(to: observer).disposed(by: disposeBag) "},"RxSwiftStudy/3.Observable&Observer-æ—¢æ˜¯å¯è¢«ç›‘å¬çš„åºåˆ—ä¹Ÿæ˜¯è§‚å¯Ÿè€….html":{"url":"RxSwiftStudy/3.Observable&Observer-æ—¢æ˜¯å¯è¢«ç›‘å¬çš„åºåˆ—ä¹Ÿæ˜¯è§‚å¯Ÿè€….html","title":"3. Observable & Observer æ—¢æ˜¯å¯è¢«ç›‘å¬çš„åºåˆ—ä¹Ÿæ˜¯è§‚å¯Ÿè€…","keywords":"","body":"Observable & Observer - æ—¢æ˜¯å¯è¢«ç›‘å¬çš„åºåˆ—ä¹Ÿæ˜¯è§‚å¯Ÿè€… https://beeth0ven.github.io/RxSwift-Chinese-Documentation/content/rxswift_core/observable_and_observer.html åœ¨æˆ‘ä»¬æ‰€é‡åˆ°çš„äº‹ç‰©ä¸­ï¼Œæœ‰ä¸€éƒ¨åˆ†éå¸¸ç‰¹åˆ«ã€‚å®ƒä»¬æ—¢æ˜¯å¯è¢«ç›‘å¬çš„åºåˆ—ä¹Ÿæ˜¯è§‚å¯Ÿè€…ã€‚ ä¾‹å¦‚ï¼štextFieldçš„å½“å‰æ–‡æœ¬ã€‚å®ƒå¯ä»¥çœ‹æˆæ˜¯ç”±ç”¨æˆ·è¾“å…¥ï¼Œè€Œäº§ç”Ÿçš„ä¸€ä¸ªæ–‡æœ¬åºåˆ—ã€‚ä¹Ÿå¯ä»¥æ˜¯ç”±å¤–éƒ¨æ–‡æœ¬åºåˆ—ï¼Œæ¥æ§åˆ¶å½“å‰æ˜¾ç¤ºå†…å®¹çš„è§‚å¯Ÿè€…ï¼š // ä½œä¸ºå¯è¢«ç›‘å¬çš„åºåˆ— let observable = textField.rx.text observable.subscribe(onNext: { text in show(text: text) }) // ä½œä¸ºè§‚å¯Ÿè€… let observer = textField.rx.text let text: Observable = ... text.bind(to: observer) çœ‹ä¸‹ textFieldçš„ rx.text çš„å®šä¹‰ public var text: ControlProperty { return value } /// Reactive wrapper for `text` property. public var value: ControlProperty { return base.rx.controlPropertyWithDefaultEvents( getter: { textField in textField.text }, setter: { textField, value in // This check is important because setting text value always clears control state // including marked text selection which is imporant for proper input // when IME input method is used. if textField.text != value { textField.text = value } } ) } çœ‹ä¸‹ ControlProperty æ˜¯å•¥ public protocol ControlPropertyType : ObservableType, ObserverType { ... } public struct ControlProperty : ControlPropertyType { ... ... } æœ‰è®¸å¤š UI æ§ä»¶éƒ½å­˜åœ¨è¿™ç§ç‰¹æ€§ï¼Œä¾‹å¦‚ï¼šswitchçš„å¼€å…³çŠ¶æ€ï¼ŒsegmentedControlçš„é€‰ä¸­ç´¢å¼•å·ï¼ŒdatePickerçš„é€‰ä¸­æ—¥æœŸç­‰ç­‰ã€‚ å¦å¤–ï¼Œæ¡†æ¶é‡Œé¢å®šä¹‰äº†ä¸€äº›è¾…åŠ©ç±»å‹ï¼Œå®ƒä»¬æ—¢æ˜¯å¯è¢«ç›‘å¬çš„åºåˆ—ä¹Ÿæ˜¯è§‚å¯Ÿè€…ã€‚å¦‚æœä½ èƒ½åˆé€‚çš„åº”ç”¨è¿™äº›è¾…åŠ©ç±»å‹ï¼Œå®ƒä»¬å°±å¯ä»¥å¸®åŠ©ä½ æ›´å‡†ç¡®çš„æè¿°äº‹ç‰©çš„ç‰¹å¾ã€‚ AsyncSubject https://beeth0ven.github.io/RxSwift-Chinese-Documentation/content/rxswift_core/observable_and_observer/async_subject.html public final class AsyncSubject : Observable , SubjectType , ObserverType , SynchronizedUnsubscribeType { ... ... } å¦‚æœæº Observableåœ¨å‘å‡ºå¤šä¸ªå…ƒç´ å¹¶äº§ç”Ÿå®Œæˆäº‹ä»¶åï¼Œ AsyncSubject å‘å‡ºæœ€åä¸€ä¸ªå…ƒç´ ï¼ˆä»…ä»…åªæœ‰æœ€åä¸€ä¸ªå…ƒç´ ï¼‰ï¼› å¦‚æœæº Observable æ²¡æœ‰å‘å‡ºä»»ä½•å…ƒç´ ï¼Œåªæœ‰ä¸€ä¸ªå®Œæˆäº‹ä»¶ï¼Œ AsyncSubject ä¹Ÿåªæœ‰ä¸€ä¸ªå®Œæˆäº‹ä»¶ã€‚ å¦‚æœæº Observable å› ä¸ºäº§ç”Ÿäº†ä¸€ä¸ª error äº‹ä»¶è€Œä¸­æ­¢ï¼Œ AsyncSubject å°±ä¸ä¼šå‘å‡ºä»»ä½•å…ƒç´ ï¼Œè€Œæ˜¯å°†è¿™ä¸ª error äº‹ä»¶å‘é€å‡ºæ¥ã€‚ åˆ›å»ºæ–¹æ³•ï¼š let subject = AsyncSubject() egï¼š func testAsyncSubject() { let subject = AsyncSubject() subject .subscribe({ (e) in print(\"Subscription: 1 Event:\", e) }) .disposed(by: disposeBag) // 1 subject.onNext(\"ğŸ¶\") subject.onNext(\"ğŸ±\") // åªå‘é€ onCompletedå‰é¢æœ€åä¸€ä¸ª subject.onNext(\"ğŸ¹\") subject.onCompleted() } è¾“å‡ºå¦‚ä¸‹ï¼š Subscription: 1 Event: next(ğŸ¹) Subscription: 1 Event: completed PublishSubject https://beeth0ven.github.io/RxSwift-Chinese-Documentation/content/rxswift_core/observable_and_observer/publish_subject.html public final class PublishSubject : Observable , SubjectType , Cancelable , ObserverType , SynchronizedUnsubscribeType { ... ... } å¯¹è§‚å¯Ÿè€…å‘é€è®¢é˜…åäº§ç”Ÿçš„å…ƒç´  åœ¨è§‚å¯Ÿè€…è®¢é˜…å‰å‘å‡ºçš„å…ƒç´ ä¸ä¼šé‡æ–°å‘é€ç»™è§‚å¯Ÿè€…ï¼ˆåªä¼šå‘é€è®¢é˜…ä¹‹åäº§ç”Ÿçš„å…ƒç´ ç»™è¿™ä¸ªè®¢é˜…è€…ï¼‰ å¦‚æœä½ å¸Œæœ›è§‚å¯Ÿè€…æ¥æ”¶åˆ°æ‰€æœ‰çš„å…ƒç´ ï¼Œä½ å¯ä»¥é€šè¿‡ä½¿ç”¨ Observable çš„ create æ–¹æ³•æ¥åˆ›å»º Observableï¼Œæˆ–è€…ä½¿ç”¨ ReplaySubjectã€‚ åˆ›å»ºæ–¹æ³•ï¼š let subject = PublishSubject() egï¼š func testPublishSubject() { let disposeBag = DisposeBag() let subject = PublishSubject() subject .subscribe({ (e) in print(\"Subscription: 1 Event:\", e) }) .disposed(by: disposeBag) subject.onNext(\"ğŸ¶\") subject.onNext(\"ğŸ±\") subject .subscribe({ (e) in print(\"Subscription: 2 Event:\", e) }) .disposed(by: disposeBag) subject.onNext(\"ğŸ…°ï¸\") subject.onNext(\"ğŸ…±ï¸\") subject.onCompleted() } è¾“å‡ºå¦‚ä¸‹ï¼š Subscription: 1 Event: next(ğŸ¶) Subscription: 1 Event: next(ğŸ±) Subscription: 1 Event: next(ğŸ…°ï¸) Subscription: 2 Event: next(ğŸ…°ï¸) Subscription: 1 Event: next(ğŸ…±ï¸) Subscription: 2 Event: next(ğŸ…±ï¸) Subscription: 1 Event: completed Subscription: 2 Event: completed ReplaySubject https://beeth0ven.github.io/RxSwift-Chinese-Documentation/content/rxswift_core/observable_and_observer/replay_subject.html public class ReplaySubject : Observable , SubjectType , ObserverType , Disposable { ... ... } å¯¹è§‚å¯Ÿè€…å‘é€å…¨éƒ¨çš„å…ƒç´ ï¼Œæ— è®ºè§‚å¯Ÿè€…æ˜¯ä½•æ—¶è¿›è¡Œè®¢é˜…çš„ã€‚ä¼šæŒ‰é¡ºåºè¡¥å‘è®¢é˜…ä¹‹å‰äº§ç”Ÿçš„å…ƒç´  è¿™é‡Œå­˜åœ¨å¤šä¸ªç‰ˆæœ¬çš„ ReplaySubjectï¼Œæœ‰çš„åªä¼šå°†æœ€æ–°çš„ n ä¸ªå…ƒç´ å‘é€ç»™è§‚å¯Ÿè€…ï¼Œæœ‰çš„åªä¼šå°†é™åˆ¶æ—¶é—´æ®µå†…æœ€æ–°çš„å…ƒç´ å‘é€ç»™è§‚å¯Ÿè€…ã€‚ å¦‚æœæŠŠ ReplaySubject å½“ä½œè§‚å¯Ÿè€…æ¥ä½¿ç”¨ï¼Œæ³¨æ„ä¸è¦åœ¨å¤šä¸ªçº¿ç¨‹è°ƒç”¨ onNext, onError æˆ– onCompletedã€‚è¿™æ ·ä¼šå¯¼è‡´æ— åºè°ƒç”¨ï¼Œå°†é€ æˆæ„æƒ³ä¸åˆ°çš„ç»“æœã€‚ åˆ›å»ºæ–¹æ³•ï¼š // ç¼“å­˜æ‰€æœ‰å·²äº§ç”Ÿçš„å…ƒç´  let subject = ReplaySubject.createUnbounded() // ç¼“å­˜æŒ‡å®šæ•°é‡çš„å·²äº§ç”Ÿçš„å…ƒç´  let subject = ReplaySubject.create(bufferSize: 1) egï¼š func testReplaySubject() { // let subject = ReplaySubject.createUnbounded() let subject = ReplaySubject.create(bufferSize: 1) subject .subscribe { print(\"Subscription: 1 Event:\", $0) } .disposed(by: disposeBag) subject.onNext(\"ğŸ¶\") subject.onNext(\"ğŸ±\") subject .subscribe { print(\"Subscription: 2 Event:\", $0) } .disposed(by: disposeBag) subject.onNext(\"ğŸ…°ï¸\") subject.onNext(\"ğŸ…±ï¸\") } è¾“å‡ºå¦‚ä¸‹ï¼š Subscription: 1 Event: next(ğŸ¶) Subscription: 1 Event: next(ğŸ±) Subscription: 2 Event: next(ğŸ±) Subscription: 1 Event: next(ğŸ…°ï¸) Subscription: 2 Event: next(ğŸ…°ï¸) Subscription: 1 Event: next(ğŸ…±ï¸) Subscription: 2 Event: next(ğŸ…±ï¸) BehaviorSubject https://beeth0ven.github.io/RxSwift-Chinese-Documentation/content/rxswift_core/observable_and_observer/behavior_subject.html public final class BehaviorSubject : Observable , SubjectType , ObserverType , SynchronizedUnsubscribeType , Disposable { ... ... } å½“è§‚å¯Ÿè€…å¯¹ BehaviorSubject è¿›è¡Œè®¢é˜…æ—¶ï¼Œå®ƒä¼šå°†æº Observable ä¸­æœ€æ–°çš„å…ƒç´ å‘é€å‡ºæ¥ å¦‚æœä¸å­˜åœ¨æœ€æ–°çš„å…ƒç´ ï¼Œå°±å‘å‡ºé»˜è®¤å…ƒç´ ã€‚ æ¯å½“äº§ç”Ÿæ–°çš„å…ƒç´ ï¼Œéƒ½ä¼šå‘é€ç»™è§‚å¯Ÿè€…ã€‚ å¦‚æœæº Observable å› ä¸ºäº§ç”Ÿäº†ä¸€ä¸ª error äº‹ä»¶è€Œä¸­æ­¢ï¼Œ BehaviorSubject å°±ä¸ä¼šå‘å‡ºä»»ä½•å…ƒç´ ï¼Œè€Œæ˜¯å°†è¿™ä¸ª error äº‹ä»¶å‘é€å‡ºæ¥ã€‚ egï¼š func testBehaviorSubject() { let subject = BehaviorSubject(value: \"ğŸ”´\") subject .subscribe { print(\"Subscription: 1 Event:\", $0) } .disposed(by: disposeBag) subject.onNext(\"ğŸ¶\") subject.onNext(\"ğŸ±\") subject .subscribe { print(\"Subscription: 2 Event:\", $0) } .disposed(by: disposeBag) subject.onNext(\"ğŸ…°ï¸\") subject.onNext(\"ğŸ…±ï¸\") subject .subscribe { print(\"Subscription: 3 Event:\", $0) } .disposed(by: disposeBag) subject.onNext(\"ğŸ\") subject.onNext(\"ğŸŠ\") } è¾“å‡ºå¦‚ä¸‹ï¼š Subscription: 1 Event: next(ğŸ”´) Subscription: 1 Event: next(ğŸ¶) Subscription: 1 Event: next(ğŸ±) Subscription: 2 Event: next(ğŸ±) Subscription: 1 Event: next(ğŸ…°ï¸) Subscription: 2 Event: next(ğŸ…°ï¸) Subscription: 1 Event: next(ğŸ…±ï¸) Subscription: 2 Event: next(ğŸ…±ï¸) Subscription: 3 Event: next(ğŸ…±ï¸) Subscription: 1 Event: next(ğŸ) Subscription: 2 Event: next(ğŸ) Subscription: 3 Event: next(ğŸ) Subscription: 1 Event: next(ğŸŠ) Subscription: 2 Event: next(ğŸŠ) Subscription: 3 Event: next(ğŸŠ) Variable https://beeth0ven.github.io/RxSwift-Chinese-Documentation/content/rxswift_core/observable_and_observer/variable.html public final class Variable { ... ... } åœ¨ Swift ä¸­æˆ‘ä»¬ç»å¸¸ä¼šç”¨ var å…³é”®å­—æ¥å£°æ˜å˜é‡ã€‚RxSwift æä¾›çš„ Variable å®é™…ä¸Šæ˜¯ var çš„ Rx ç‰ˆæœ¬ï¼Œä½ å¯ä»¥å°†å®ƒçœ‹ä½œæ˜¯ RxVarã€‚ æˆ‘ä»¬æ¥å¯¹æ¯”ä¸€ä¸‹ var ä»¥åŠ Variable çš„ç”¨æ³•ï¼š ä½¿ç”¨ varï¼š // åœ¨ ViewController ä¸­ var model: Model? = nil { didSet { updateUI(with: model) } } override func viewDidLoad() { super.viewDidLoad() model = getModel() } func updateUI(with model: Model?) { ... } func getModel() -> Model { ... } ä½¿ç”¨ Variableï¼š // åœ¨ ViewController ä¸­ let model: Variable = Variable(nil) override func viewDidLoad() { super.viewDidLoad() model.asObservable() .subscribe(onNext: { [weak self] model in self?.updateUI(with: model) }) .disposed(by: disposeBag) model.value = getModel() } func updateUI(with model: Model?) { ... } func getModel() -> Model { ... } ç¬¬ä¸€ç§ä½¿ç”¨ var çš„æ–¹å¼ååˆ†å¸¸è§ï¼Œåœ¨ ViewController ä¸­ç›‘å¬ Model çš„å˜åŒ–ï¼Œç„¶ååˆ·æ–°é¡µé¢ã€‚ ç¬¬äºŒç§ä½¿ç”¨ Variable åˆ™æ˜¯ RxSwift ç‹¬æœ‰çš„ã€‚Variable å‡ ä¹æä¾›äº† var çš„æ‰€æœ‰åŠŸèƒ½ã€‚å¦å¤–ï¼ŒåŠ ä¸Šä¸€æ¡éå¸¸é‡è¦çš„ç‰¹æ€§ï¼Œå°±æ˜¯å¯ä»¥é€šè¿‡è°ƒç”¨ asObservable() æ–¹æ³•è½¬æ¢æˆåºåˆ—ã€‚ç„¶åä½ å¯ä»¥å¯¹è¿™ä¸ªåºåˆ—åº”ç”¨æ“ä½œç¬¦ï¼Œæ¥åˆæˆå…¶ä»–çš„åºåˆ—ã€‚æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬å£°æ˜çš„å˜é‡éœ€è¦æä¾› Rx æ”¯æŒï¼Œé‚£å°±é€‰ç”¨ Variable è¿™ä¸ªç±»å‹ã€‚ è¯´æ˜: Variable å°è£…äº†ä¸€ä¸ª BehaviorSubjectï¼Œæ‰€ä»¥å®ƒä¼šæŒæœ‰å½“å‰å€¼ï¼Œå¹¶ä¸” Variable ä¼šå¯¹æ–°çš„è§‚å¯Ÿè€…å‘é€å½“å‰å€¼ã€‚å®ƒä¸ä¼šäº§ç”Ÿ error äº‹ä»¶ã€‚Variable åœ¨ deinit æ—¶ï¼Œä¼šå‘å‡ºä¸€ä¸ª completed äº‹ä»¶ã€‚ eg: func testVariable() { struct Model { var text: String? var image: UIImage? } func updateView(with model: Model?) { guard let m = model else { return } DispatchQueue.main.async { self.imageView.image = m.image print(m.text ?? \"none\") } } let model: Variable = Variable.init(nil) model .asObservable() .subscribe(onNext: { (m) in updateView(with: m) }) .disposed(by: disposeBag) getImage() .subscribe(onNext: { (image) in model.value = Model.init(text: image.description, image: image) }, onError: { (err) in if let err = err as? TError { err.printLog() return } print(err.localizedDescription) }) .disposed(by: disposeBag) } ControlProperty https://beeth0ven.github.io/RxSwift-Chinese-Documentation/content/rxswift_core/observable_and_observer/control_property.html public protocol ControlPropertyType : ObservableType, ObserverType { /// - returns: `ControlProperty` interface func asControlProperty() -> ControlProperty } public struct ControlProperty : ControlPropertyType { ... ... } ControlProperty ä¸“é—¨ç”¨äºæè¿° UI æ§ä»¶å±æ€§çš„ï¼Œå®ƒå…·æœ‰ä»¥ä¸‹ç‰¹å¾ï¼š ä¸ä¼šäº§ç”Ÿ error äº‹ä»¶ ä¸€å®šåœ¨ MainScheduler è®¢é˜…ï¼ˆä¸»çº¿ç¨‹è®¢é˜…ï¼‰ ä¸€å®šåœ¨ MainScheduler ç›‘å¬ï¼ˆä¸»çº¿ç¨‹ç›‘å¬ï¼‰ å…±äº«çŠ¶æ€å˜åŒ– eg: func testControlProperty() { // ä»…ä»…ç”¨äºæµ‹è¯•ï¼Œä¸»è¦ç”¨äºUIæ§ä»¶ï¼Œä¾‹å¦‚ textField.rx.text // Creat: var c_value: String = \"\" let c_observable = Observable.create({ (observer) -> Disposable in observer.onNext(c_value) observer.onCompleted() return Disposables.create() }) let c_observer = AnyObserver.init { (e) in switch e { case .next(let el): c_value = el default: break } print(\"controlProperty is Changed: \" + e.debugDescription) } let controlProperty = ControlProperty.init(values: c_observable, valueSink: c_observer) // USE: let observable = Observable.create({ (observer) -> Disposable in observer.onNext(\"æµ‹è¯•1\") observer.onNext(\"æµ‹è¯•2\") observer.onCompleted() return Disposables.create() }) let observer = AnyObserver.init { (e) in print(\"controlProperty Value Is: \" + e.debugDescription) } observable .bind(to: controlProperty) .disposed(by: disposeBag) controlProperty .bind(to: observer) .disposed(by: disposeBag) } é™„å½• Subjectç›¸å…³çš„ä¸€äº› Protocol | Class | Struct å®šä¹‰ ObservableType public protocol ObservableConvertibleType { /// Type of elements in sequence. associatedtype E /// Converts `self` to `Observable` sequence. /// /// - returns: Observable sequence that represents `self`. func asObservable() -> Observable } public protocol ObservableType : ObservableConvertibleType { /** Subscribes `observer` to receive events for this sequence. ### Grammar **Next\\* (Error | Completed)?** * sequences can produce zero or more elements so zero or more `Next` events can be sent to `observer` * once an `Error` or `Completed` event is sent, the sequence terminates and can't produce any other elements It is possible that events are sent from different threads, but no two events can be sent concurrently to `observer`. ### Resource Management When sequence sends `Complete` or `Error` event all internal resources that compute sequence elements will be freed. To cancel production of sequence elements and free resources immediately, call `dispose` on returned subscription. - returns: Subscription for `observer` that can be used to cancel production of sequence elements and free resources. */ func subscribe(_ observer: O) -> Disposable where O.E == E } Observable public class Observable : ObservableType { ... ... } SubjectType public protocol SubjectType : ObservableType { /// The type of the observer that represents this subject. /// /// Usually this type is type of subject itself, but it doesn't have to be. associatedtype SubjectObserverType : ObserverType /// Returns observer interface for subject. /// /// - returns: Observer interface for subject. func asObserver() -> SubjectObserverType } ObserverType public protocol ObserverType { /// The type of elements in sequence that observer can observe. associatedtype E /// Notify observer about sequence event. /// /// - parameter event: Event that occurred. func on(_ event: Event) } SynchronizedUnsubscribeType protocol SynchronizedUnsubscribeType : class { associatedtype DisposeKey func synchronizedUnsubscribe(_ disposeKey: DisposeKey) } Disposable public protocol Disposable { /// Dispose resource. func dispose() } "},"RxSwiftStudy/4.Disposable-å¯è¢«æ¸…é™¤çš„èµ„æº.html":{"url":"RxSwiftStudy/4.Disposable-å¯è¢«æ¸…é™¤çš„èµ„æº.html","title":"4. Disposable - å¯è¢«æ¸…é™¤çš„èµ„æº","keywords":"","body":"Observable dispose çš„æ—¶æœº https://beeth0ven.github.io/RxSwift-Chinese-Documentation/content/rxswift_core/disposable.html Observable å‘å‡ºäº† completed æˆ–è€… error äº‹ä»¶ä¹‹åä¼šç›´æ¥é‡Šæ”¾ å¦‚æœä¸€ç›´æ²¡ completed æˆ–è€… error, è°ƒç”¨ dispose() ä¼šæå‰ dispose å¦‚æœä¸€ç›´æ²¡ completed æˆ–è€… error, è‹¥è°ƒç”¨ disposed(by: disposeBag), disposeBag é‡Šæ”¾æ—¶å€™ Observable æ‰ä¼š dispose æµ‹è¯•ä»£ç ï¼š class DisposableViewController: UIViewController { let disposeBag = DisposeBag() deinit { print(\"Deinit:\" + self.debugDescription) } override func viewDidLoad() { super.viewDidLoad() testDisposeTime() } // MARK: DisposeTime func testDisposeTime() { // observer.onCompleted()ä¹‹åä¼šç›´æ¥dispose // å¦‚æœä¸€ç›´æ²¡ onCompleted(), è°ƒç”¨dispose()æ‰ä¼šdispose // å¦‚æœä¸€ç›´æ²¡ onCompleted(), è°ƒç”¨disposed(by: disposeBag), disposeBagé‡Šæ”¾æ—¶å€™æ‰ä¼šdispose // Observable 1: ä¸å‘é€ .onCompleted() ä¸è°ƒç”¨ .dispose() _ = Observable .create({ (observer) -> Disposable in observer.onNext( \"\"\" \\n Observable 1: ä¸å‘é€ .onCompleted() ä¸è°ƒç”¨ .dispose() \\t\\t\\t æ°¸è¿œä¸ä¼šé‡Šæ”¾ \"\"\" ) return Disposables.create { print(\"Observable 1: Now Dispose\") } }) .subscribe(onNext: { (s) in print(s) }) // Observable 2: ä¼šå‘é€ .onCompleted() çš„ Observable _ = Observable .create({ (observer) -> Disposable in observer.onNext( \"\"\" \\n Observable 2: ä¼šå‘é€ .onCompleted() çš„ Observable \\t\\t\\t å®Œæˆåå°±ä¼šé‡Šæ”¾ \"\"\" ) observer.onCompleted() return Disposables.create { print(\"Observable 2: Now Dispose\") } }) .subscribe(onNext: { (s) in print(s) }) // Observable 3: ä¸å‘é€ .onCompleted() , è°ƒç”¨ .dispose() Observable .create({ (observer) -> Disposable in observer.onNext( \"\"\" \\n Observable 3: ä¸å‘é€ .onCompleted() , è°ƒç”¨ .dispose() \\t\\t\\t è°ƒç”¨ .dispose() æ—¶å€™é‡Šæ”¾ \"\"\" ) return Disposables.create { print(\"Observable 3: Now Dispose\") } }) .subscribe(onNext: { (s) in print(s) }) .dispose() // Observable 4: ä¸å‘é€ .onCompleted() , è°ƒç”¨ .disposed(by: disposeBag) Observable .create({ (observer) -> Disposable in observer.onNext( \"\"\" \\n Observable 4: ä¸å‘é€ .onCompleted() , è°ƒç”¨ .disposed(by: disposeBag) \\t\\t\\t disposeBagé‡Šæ”¾æ—¶å€™(VC deinitä¹‹å)é‡Šæ”¾ \"\"\" ) return Disposables.create { print(\"Observable 4: Now Dispose\") } }) .subscribe(onNext: { (s) in print(s) }) .disposed(by: disposeBag) } } è¾“å‡ºå¦‚ä¸‹ï¼š Observable 1: ä¸å‘é€ .onCompleted() ä¸è°ƒç”¨ .dispose() æ°¸è¿œä¸ä¼šé‡Šæ”¾ Observable 2: ä¼šå‘é€ .onCompleted() çš„ Observable å®Œæˆåå°±ä¼šé‡Šæ”¾ Observable 2: Now Dispose Observable 3: ä¸å‘é€ .onCompleted() , è°ƒç”¨ .dispose() è°ƒç”¨ .dispose() æ—¶å€™é‡Šæ”¾ Observable 3: Now Dispose Observable 4: ä¸å‘é€ .onCompleted() , è°ƒç”¨ .disposed(by: disposeBag) disposeBagé‡Šæ”¾æ—¶å€™(VC deinitä¹‹å)é‡Šæ”¾ Deinit: Observable 4: Now Dispose Disposable - å¯è¢«æ¸…é™¤çš„èµ„æº https://beeth0ven.github.io/RxSwift-Chinese-Documentation/content/rxswift_core/disposable.html é€šå¸¸æ¥è¯´ï¼Œä¸€ä¸ªåºåˆ—å¦‚æœå‘å‡ºäº† error æˆ–è€… completed äº‹ä»¶ï¼Œé‚£ä¹ˆæ‰€æœ‰å†…éƒ¨èµ„æºéƒ½ä¼šè¢«é‡Šæ”¾ã€‚å¦‚æœä½ éœ€è¦æå‰é‡Šæ”¾è¿™äº›èµ„æºæˆ–å–æ¶ˆè®¢é˜…çš„è¯ï¼Œé‚£ä¹ˆä½ å¯ä»¥å¯¹è¿”å›çš„ å¯è¢«æ¸…é™¤çš„èµ„æºï¼ˆDisposableï¼‰ è°ƒç”¨ dispose æ–¹æ³•ã€‚ è°ƒç”¨ dispose æ–¹æ³•åï¼Œè®¢é˜…å°†è¢«å–æ¶ˆï¼Œå¹¶ä¸”å†…éƒ¨èµ„æºéƒ½ä¼šè¢«é‡Šæ”¾ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œä½ æ˜¯ä¸éœ€è¦æ‰‹åŠ¨è°ƒç”¨ dispose æ–¹æ³•çš„ï¼Œè¿™é‡Œåªæ˜¯åšä¸ªæ¼”ç¤ºè€Œå·²ã€‚æˆ‘ä»¬æ¨èä½¿ç”¨ æ¸…é™¤åŒ…ï¼ˆDisposeBagï¼‰ æˆ–è€… takeUntil æ“ä½œç¬¦ æ¥ç®¡ç†è®¢é˜…çš„ç”Ÿå‘½å‘¨æœŸã€‚ func testDispose() { for i in 1...4 { Observable .create({ (observer) -> Disposable in observer.onNext(\"Observable \\(i) onNext\") return Disposables.create { print(\"Observable \\(i): Now Dispose\") } }) .subscribe({ (e) in print(e) }) .dispose() } } è¾“å‡ºå¦‚ä¸‹ next(Observable 1 onNext) Observable 1: Now Dispose next(Observable 2 onNext) Observable 2: Now Dispose next(Observable 3 onNext) Observable 3: Now Dispose next(Observable 4 onNext) Observable 4: Now Dispose DisposeBag - æ¸…é™¤åŒ… å› ä¸ºæˆ‘ä»¬ç”¨çš„æ˜¯ Swift ï¼Œæ‰€ä»¥æˆ‘ä»¬æ›´ä¹ æƒ¯äºä½¿ç”¨ ARC æ¥ç®¡ç†å†…å­˜ã€‚é‚£ä¹ˆæˆ‘ä»¬èƒ½ä¸èƒ½ç”¨ ARC æ¥ç®¡ç†è®¢é˜…çš„ç”Ÿå‘½å‘¨æœŸäº†ã€‚ç­”æ¡ˆæ˜¯è‚¯å®šäº†ï¼Œä½ å¯ä»¥ç”¨ æ¸…é™¤åŒ…ï¼ˆDisposeBagï¼‰ æ¥å®ç°è¿™ç§è®¢é˜…ç®¡ç†æœºåˆ¶ã€‚å½“ æ¸…é™¤åŒ…(DisposeBag) è¢«é‡Šæ”¾çš„æ—¶å€™ï¼Œæ¸…é™¤åŒ… å†…éƒ¨æ‰€æœ‰ å¯è¢«æ¸…é™¤çš„èµ„æºï¼ˆDisposableï¼‰ éƒ½å°†è¢«æ¸…é™¤ã€‚ func testDisposeBag() { let funcDisposeBag = DisposeBag() for i in 1...4 { Observable .create({ (observer) -> Disposable in observer.onNext(\"Observable \\(i) onNext\") return Disposables.create { print(\"Observable \\(i) Now Dispose\") } }) .subscribe({ (e) in print(e) }) .disposed(by: funcDisposeBag) } } è¾“å‡ºå¦‚ä¸‹ï¼š next(Observable 1 onNext) next(Observable 2 onNext) next(Observable 3 onNext) next(Observable 4 onNext) Observable 1 Now Dispose Observable 2 Now Dispose Observable 3 Now Dispose Observable 4 Now Dispose è¿™ä¸ªä¾‹å­ä¸­ funcDisposeBag åœ¨å‡½æ•°è¿è¡Œå®Œä¹‹åé‡Šæ”¾ï¼Œå½“å‡½æ•°è¿è¡Œç»“æŸæ—¶ï¼Œ funcDisposeBag å°±è¢«é‡Šæ”¾ï¼Œé‚£ä¹ˆè¿™é‡Œçš„ 4 æ¬¡è®¢é˜…ä¹Ÿå°±è¢«å–æ¶ˆäº†ã€‚ takeUntil å¦å¤–ä¸€ç§å®ç°è‡ªåŠ¨å–æ¶ˆè®¢é˜…çš„æ–¹æ³•å°±æ˜¯ä½¿ç”¨ takeUntil æ“ä½œç¬¦ï¼Œä¸Šé¢çš„æ¼”ç¤ºä»£ç ä¹Ÿå¯ä»¥é€šè¿‡ä½¿ç”¨ takeUntil æ¥å®ç°ï¼š @IBAction func testTakeUntil() { for i in 1...4 { let observable = Observable.create({ (observer) -> Disposable in observer.onNext(\"Observable \\(i) onNext\") return Disposables.create { print(\"Observable \\(i): Now Dispose\") } }) _ = observable .takeUntil(self.rx.deallocated) .subscribe({ (e) in print(\"Observable \\(i): \" + e.debugDescription) }) } } è¿™å°†ä½¿å¾—è®¢é˜…ä¸€ç›´æŒç»­åˆ°æ§åˆ¶å™¨çš„ dealloc äº‹ä»¶äº§ç”Ÿä¸ºæ­¢ã€‚è¾“å‡ºä¸ºï¼š Observable 1: next(Observable 1 onNext) Observable 2: next(Observable 2 onNext) Observable 3: next(Observable 3 onNext) Observable 4: next(Observable 4 onNext) Deinit: Observable 1: completed Observable 1: Now Dispose Observable 2: completed Observable 2: Now Dispose Observable 3: completed Observable 3: Now Dispose Observable 4: completed Observable 4: Now Dispose "},"RxSwiftStudy/5.Schedulers-è°ƒåº¦å™¨.html":{"url":"RxSwiftStudy/5.Schedulers-è°ƒåº¦å™¨.html","title":"5. Schedulers - è°ƒåº¦å™¨","keywords":"","body":"Schedulers - è°ƒåº¦å™¨ https://beeth0ven.github.io/RxSwift-Chinese-Documentation/content/rxswift_core/schedulers.html Schedulers æ˜¯ Rx å®ç°å¤šçº¿ç¨‹çš„æ ¸å¿ƒæ¨¡å—ï¼Œå®ƒä¸»è¦ç”¨äºæ§åˆ¶ä»»åŠ¡åœ¨å“ªä¸ªçº¿ç¨‹æˆ–é˜Ÿåˆ—è¿è¡Œã€‚ å¦‚æœä½ æ›¾ç»ä½¿ç”¨è¿‡ GCDï¼Œ é‚£ä½ å¯¹ä»¥ä¸‹ä»£ç åº”è¯¥ä¸ä¼šé™Œç”Ÿï¼š // åå°å–å¾—æ•°æ®ï¼Œä¸»çº¿ç¨‹å¤„ç†ç»“æœ DispatchQueue.global(qos: .userInitiated).async { let data = try? Data(contentsOf: url) DispatchQueue.main.async { self.data = data } } å¦‚æœç”¨ RxSwift æ¥å®ç°ï¼Œå¤§è‡´æ˜¯è¿™æ ·çš„ï¼š let rxData: Observable = ... rxData .subscribeOn(ConcurrentDispatchQueueScheduler(qos: .userInitiated)) .observeOn(MainScheduler.instance) .subscribe(onNext: { [weak self] data in self?.data = data }) .disposed(by: disposeBag) ä½¿ç”¨ subscribeOn æˆ‘ä»¬ç”¨ subscribeOn æ¥å†³å®šæ•°æ®åºåˆ—çš„æ„å»ºå‡½æ•°åœ¨å“ªä¸ª Scheduler ä¸Šè¿è¡Œã€‚ä»¥ä¸Šä¾‹å­ä¸­ï¼Œç”±äºè·å– Data éœ€è¦èŠ±å¾ˆé•¿çš„æ—¶é—´ï¼Œæ‰€ä»¥ç”¨ subscribeOn åˆ‡æ¢åˆ° åå° Scheduler æ¥è·å– Dataã€‚è¿™æ ·å¯ä»¥é¿å…ä¸»çº¿ç¨‹è¢«é˜»å¡ã€‚ eg: é¦–å…ˆå†™ä¸€äº›è¾…åŠ©ä»£ç ï¼š // getCurrentQueueName() -> String func getCurrentQueueName() -> String { let name = __dispatch_queue_get_label(nil) return String.init(cString: name, encoding: .utf8) ?? \"\" } // MARK: getObservable() -> Observable func getObservable() -> Observable { return Observable.create { [weak self] (observer) -> Disposable in guard let strongSelf = self else { return Disposables.create() } print(\"Observable Queue Is: \" + strongSelf.getCurrentQueueName()) // å½“å‰çº¿ç¨‹ç›´æ¥å‘é€å…ƒç´  observer.on(.next(\"Test 1\")) DispatchQueue.main.async { // åˆ‡æ¢åˆ°ä¸»çº¿ç¨‹å‘é€å…ƒç´  observer.on(.next(\"Test 2\")) } return Disposables.create() } } // MARK: getObserver() -> AnyObserver func getObserver() -> AnyObserver { return AnyObserver.init(eventHandler: { [weak self] (e) in guard let strongSelf = self else { return } print(\"AnyObserver Queue Is: \" + strongSelf.getCurrentQueueName()) print(\"\\t\\t\" + e.debugDescription) }) } æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š func testSubscribeOn() { let subscribeQueue = DispatchQueue.init(label: \"ink.tbd.test.subscribeQueue\") getObservable() // æ•°æ®åºåˆ—çš„æ„å»ºå‡½æ•°åœ¨å“ªä¸ªSchedulerä¸Šè¿è¡Œ .subscribeOn(ConcurrentDispatchQueueScheduler.init(queue: subscribeQueue)) .subscribe(getObserver()) .disposed(by: disposeBag) } è¾“å‡ºå¦‚ä¸‹ï¼š Observable Queue Is: ink.tbd.test.subscribeQueue AnyObserver Queue Is: ink.tbd.test.subscribeQueue next(Test 1) AnyObserver Queue Is: com.apple.main-thread next(Test 2) å¯ä»¥çŸ¥é“ï¼š subscribeOn(_ scheduler: ImmediateSchedulerType) å¯ä»¥ä½¿ Observable çš„ä¸»ä½“åœ¨æŒ‡å®šçº¿ç¨‹ä¸­è¿è¡Œ Observerå“åº”äº‹ä»¶çš„çº¿ç¨‹å—åˆ° Observable ä»£ç ä¸­ä¸­å‘é€äº‹ä»¶æ‰€åœ¨çš„çº¿ç¨‹å½±å“ï¼Œåœ¨ä»€ä¹ˆçº¿ç¨‹ä¸­å‘é€ï¼Œå“åº”ä¹Ÿå°±åœ¨ä»€ä¹ˆçº¿ç¨‹ä¹‹ä¸­ ä½¿ç”¨ observeOn æˆ‘ä»¬ç”¨ observeOn æ¥å†³å®šåœ¨å“ªä¸ª Scheduler ç›‘å¬è¿™ä¸ªæ•°æ®åºåˆ—ã€‚ä»¥ä¸Šä¾‹å­ä¸­ï¼Œé€šè¿‡ä½¿ç”¨ observeOn æ–¹æ³•åˆ‡æ¢åˆ°ä¸»çº¿ç¨‹æ¥ç›‘å¬å¹¶ä¸”å¤„ç†ç»“æœã€‚ ä¸€ä¸ªæ¯”è¾ƒå…¸å‹çš„ä¾‹å­å°±æ˜¯ï¼Œåœ¨åå°å‘èµ·ç½‘ç»œè¯·æ±‚ï¼Œç„¶åè§£ææ•°æ®ï¼Œæœ€ååœ¨ä¸»çº¿ç¨‹åˆ·æ–°é¡µé¢ã€‚ä½ å°±å¯ä»¥å…ˆç”¨ subscribeOn åˆ‡åˆ°åå°å»å‘é€è¯·æ±‚å¹¶è§£ææ•°æ®ï¼Œæœ€åç”¨ observeOn åˆ‡æ¢åˆ°ä¸»çº¿ç¨‹æ›´æ–°é¡µé¢ã€‚ eg: func testObserveOn() { let observeQueue = DispatchQueue.init(label: \"ink.tbd.test.observeQueue\") getObservable() // åœ¨å“ªä¸ªSchedulerç›‘å¬è¿™ä¸ªæ•°æ®åºåˆ— .observeOn(ConcurrentDispatchQueueScheduler.init(queue: observeQueue)) .subscribe(getObserver()) .disposed(by: disposeBag) } è¿è¡Œç»“æœå¦‚ä¸‹ï¼š Observable Queue Is: com.apple.main-thread AnyObserver Queue Is: ink.tbd.test.observeQueue next(Test 1) AnyObserver Queue Is: ink.tbd.test.observeQueue next(Test 2) å¯ä»¥çŸ¥é“ï¼š observeOn(_ scheduler: ImmediateSchedulerType) å¯ä»¥ä½¿ Observer çš„ä¸»ä½“åœ¨æŒ‡å®šçº¿ç¨‹ä¸­è¿è¡Œï¼Œä¸ç®¡ Observable ä»£ç ä¸­å‘é€äº‹ä»¶åœ¨ä»€ä¹ˆçº¿ç¨‹ï¼Œéƒ½ä¼šåˆ‡æ¢åˆ°æŒ‡å®šçº¿ç¨‹æ‰§è¡Œã€‚ RxSwiftä¸­æä¾›çš„Scheduler MainScheduler MainScheduler ä»£è¡¨ä¸»çº¿ç¨‹ã€‚å¦‚æœä½ éœ€è¦æ‰§è¡Œä¸€äº›å’Œ UI ç›¸å…³çš„ä»»åŠ¡ï¼Œå°±éœ€è¦åˆ‡æ¢åˆ°è¯¥ Scheduler è¿è¡Œã€‚ SerialDispatchQueueScheduler SerialDispatchQueueScheduler æŠ½è±¡äº†ä¸²è¡Œ DispatchQueueã€‚å¦‚æœä½ éœ€è¦æ‰§è¡Œä¸€äº›ä¸²è¡Œä»»åŠ¡ï¼Œå¯ä»¥åˆ‡æ¢åˆ°è¿™ä¸ª Scheduler è¿è¡Œã€‚ ConcurrentDispatchQueueScheduler ConcurrentDispatchQueueScheduler æŠ½è±¡äº†å¹¶è¡Œ DispatchQueueã€‚å¦‚æœä½ éœ€è¦æ‰§è¡Œä¸€äº›å¹¶å‘ä»»åŠ¡ï¼Œå¯ä»¥åˆ‡æ¢åˆ°è¿™ä¸ª Scheduler è¿è¡Œã€‚ OperationQueueScheduler OperationQueueScheduler æŠ½è±¡äº† NSOperationQueueã€‚ å®ƒå…·å¤‡ NSOperationQueue çš„ä¸€äº›ç‰¹ç‚¹ï¼Œä¾‹å¦‚ï¼Œä½ å¯ä»¥é€šè¿‡è®¾ç½® maxConcurrentOperationCountï¼Œæ¥æ§åˆ¶åŒæ—¶æ‰§è¡Œå¹¶å‘ä»»åŠ¡çš„æœ€å¤§æ•°é‡ã€‚ "},"RxSwiftStudy/6.ErrorHandling-é”™è¯¯å¤„ç†.html":{"url":"RxSwiftStudy/6.ErrorHandling-é”™è¯¯å¤„ç†.html","title":"6. Error Handling - é”™è¯¯å¤„ç†","keywords":"","body":"Error Handling - é”™è¯¯å¤„ç† https://beeth0ven.github.io/RxSwift-Chinese-Documentation/content/rxswift_core/error_handling.html ä¸€æ—¦åºåˆ—é‡Œé¢äº§å‡ºäº†ä¸€ä¸ª error äº‹ä»¶ï¼Œæ•´ä¸ªåºåˆ—å°†è¢«ç»ˆæ­¢ã€‚RxSwift ä¸»è¦æœ‰ä¸¤ç§é”™è¯¯å¤„ç†æœºåˆ¶ï¼š retry - é‡è¯• catch - æ¢å¤ retry retry å¯ä»¥è®©åºåˆ—åœ¨å‘ç”Ÿé”™è¯¯åé‡è¯•ï¼š // è¯·æ±‚å¤±è´¥æ—¶ï¼Œç«‹å³é‡è¯•ï¼Œ // é‡è¯• 3 æ¬¡åä»ç„¶å¤±è´¥ï¼Œå°±å°†é”™è¯¯æŠ›å‡º func testRetry() { getDictObservable() .retry(3) // æ€»å…±è°ƒç”¨3æ¬¡åŒ…æ‹¬ç¬¬ä¸€æ¬¡ .subscribe({ (e) in print(\"in the end: \\(e.debugDescription)\") }) .disposed(by: disposeBag) } ä»¥ä¸Šçš„ä»£ç éå¸¸ç›´æ¥ retry(3) å°±æ˜¯å½“å‘ç”Ÿé”™è¯¯æ—¶ï¼Œå°±è¿›è¡Œé‡è¯•æ“ä½œï¼Œå¹¶ä¸”æœ€å¤šé‡è¯• 3 æ¬¡ã€‚ retryWhen å¦‚æœæˆ‘ä»¬éœ€è¦åœ¨å‘ç”Ÿé”™è¯¯æ—¶ï¼Œç»è¿‡ä¸€æ®µå»¶æ—¶åé‡è¯•ï¼Œé‚£å¯ä»¥è¿™æ ·å®ç°ï¼š func testRetryWhen() { let retryDelay: RxTimeInterval = 1.0 getDictObservable() .retryWhen({ (rxError) -> Observable in return rxError.flatMap({ (e) -> Observable in return Observable.timer(retryDelay, scheduler: MainScheduler.instance) }) }) .subscribe({ (e) in print(\"in the end: \\(e.debugDescription)\") }) .disposed(by: disposeBag) } è¿™é‡Œæˆ‘ä»¬éœ€è¦ç”¨åˆ° retryWhen æ“ä½œç¬¦ï¼Œè¿™ä¸ªæ“ä½œç¬¦ä¸»è¦æè¿°åº”è¯¥åœ¨ä½•æ—¶é‡è¯•ï¼Œå¹¶ä¸”é€šè¿‡é—­åŒ…é‡Œé¢è¿”å›çš„ Observable æ¥æ§åˆ¶é‡è¯•çš„æ—¶æœºï¼š .retryWhen { (rxError: Observable) -> Observable in ... } é—­åŒ…é‡Œé¢çš„å‚æ•°æ˜¯ Observable ä¹Ÿå°±æ˜¯æ‰€äº§ç”Ÿé”™è¯¯çš„åºåˆ—ï¼Œç„¶åè¿”å›å€¼æ˜¯ä¸€ä¸ª Observableã€‚å½“è¿™ä¸ªè¿”å›çš„ Observable å‘å‡ºä¸€ä¸ªå…ƒç´ æ—¶ï¼Œå°±è¿›è¡Œé‡è¯•æ“ä½œã€‚å½“å®ƒå‘å‡ºä¸€ä¸ª error æˆ–è€… completed äº‹ä»¶æ—¶ï¼Œå°±ä¸ä¼šé‡è¯•ï¼Œå¹¶ä¸”å°†è¿™ä¸ªäº‹ä»¶ä¼ é€’ç»™åˆ°åé¢çš„è§‚å¯Ÿè€…ã€‚ å¦‚æœéœ€è¦åŠ ä¸Šä¸€ä¸ªæœ€å¤§é‡è¯•æ¬¡æ•°çš„é™åˆ¶ï¼š func testRetryWhenAndMaxRetry() { let retryDelay: RxTimeInterval = 1.0 let maxRetryCount: Int = 4 getDictObservable() .retryWhen({ (rxError) -> Observable in return rxError.enumerated().flatMap({ (index, element) -> Observable in // æœ€å¤š 4 æ¬¡ if index >= maxRetryCount { let err = TError.init(errorCode: 0, errorString: \"Retry Too Many Times\", errorData: nil) return Observable.error(err) } return Observable.timer(retryDelay, scheduler: MainScheduler.instance) }) }) .subscribe({ (e) in print(\"in the end: \\(e.debugDescription)\") }) .disposed(by: disposeBag) } æˆ‘ä»¬è¿™é‡Œè¦å®ç°çš„æ˜¯ï¼Œå¦‚æœé‡è¯•è¶…è¿‡ 4 æ¬¡ï¼Œå°±å°†é”™è¯¯æŠ›å‡ºã€‚å¦‚æœé”™è¯¯åœ¨ 4 æ¬¡ä»¥å†…æ—¶ï¼Œå°±ç­‰å¾… 1 ç§’åé‡è¯•ï¼š ... rxError.flatMapWithIndex { (error, index) -> Observable in guard index .timer(retryDelay, scheduler: MainScheduler.instance) } ... æˆ‘ä»¬ç”¨ flatMapWithIndex è¿™ä¸ªæ“ä½œç¬¦ï¼Œå› ä¸ºå®ƒå¯ä»¥ç»™æˆ‘ä»¬æä¾›é”™è¯¯çš„ç´¢å¼•æ•° indexã€‚ç„¶åç”¨è¿™ä¸ªç´¢å¼•æ•°åˆ¤æ–­æ˜¯å¦è¶…è¿‡æœ€å¤§é‡è¯•æ•°ï¼Œå¦‚æœè¶…è¿‡äº†ï¼Œå°±å°†é”™è¯¯æŠ›å‡ºã€‚å¦‚æœæ²¡æœ‰è¶…è¿‡ï¼Œå°±ç­‰å¾… 5 ç§’åé‡è¯•ã€‚ catchErrorJustReturn - æ¢å¤ catchErrorJustReturn å¯ä»¥åœ¨é”™è¯¯äº§ç”Ÿæ—¶ï¼Œç”¨ä¸€ä¸ªå¤‡ç”¨å…ƒç´ æˆ–è€…ä¸€ç»„å¤‡ç”¨å…ƒç´ å°†é”™è¯¯æ›¿æ¢æ‰ï¼š func testCatchErrorJustReturn() { let defaultDict = [\"returnDefaultDict\": \"Is DefaultDict\"] getDictObservable() .catchErrorJustReturn(defaultDict) .subscribe ({ (e) in print(e) }) .disposed(by: disposeBag) } catchErrorJustReturn å½“é”™è¯¯äº§ç”Ÿæ—¶ï¼Œå°±è¿”å›ä¸€ä¸ªç©ºæ•°ç»„ï¼Œäºæ˜¯å°±ä¼šæ˜¾ç¤ºä¸€ä¸ªç©ºåˆ—è¡¨é¡µã€‚ ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ catchErrorï¼Œå½“é”™è¯¯äº§ç”Ÿæ—¶ï¼Œå°†é”™è¯¯äº‹ä»¶æ›¿æ¢æˆä¸€ä¸ªå¤‡é€‰åºåˆ—ï¼š func testCatchError() { let defaultDictVariable: Variable = Variable.init([\"returnDefaultDict\": \"Is DefaultDictVariable\"]) getDictObservable() .catchError({ (error) -> Observable in return defaultDictVariable.asObservable() }) .subscribe ({ (e) in print(e) }) .disposed(by: disposeBag) } Result å¦‚æœæˆ‘ä»¬åªæ˜¯æƒ³ç»™ç”¨æˆ·é”™è¯¯æç¤ºï¼Œé‚£è¦å¦‚ä½•æ“ä½œå‘¢ï¼Ÿ ä»¥ä¸‹æä¾›ä¸€ä¸ªæœ€ä¸ºç›´æ¥çš„æ–¹æ¡ˆï¼Œä¸è¿‡è¿™ä¸ªæ–¹æ¡ˆå­˜åœ¨ä¸€äº›é—®é¢˜ï¼š // å½“ç”¨æˆ·ç‚¹å‡»æ›´æ–°æŒ‰é’®æ—¶ï¼Œ // å°±ç«‹å³å–å‡ºä¿®æ”¹åçš„ç”¨æˆ·ä¿¡æ¯ã€‚ // ç„¶åå‘èµ·ç½‘ç»œè¯·æ±‚ï¼Œè¿›è¡Œæ›´æ–°æ“ä½œï¼Œ // ä¸€æ—¦æ“ä½œå¤±è´¥å°±æç¤ºç”¨æˆ·å¤±è´¥åŸå›  updateUserInfoButton.rx.tap .withLatestFrom(rxUserInfo) .flatMapLatest { userInfo -> Observable in return update(userInfo) } .observeOn(MainScheduler.instance) .subscribe(onNext: { print(\"ç”¨æˆ·ä¿¡æ¯æ›´æ–°æˆåŠŸ\") }, onError: { error in print(\"ç”¨æˆ·ä¿¡æ¯æ›´æ–°å¤±è´¥ï¼š \\(error.localizedDescription)\") }) .disposed(by: disposeBag) è¿™æ ·å®ç°æ˜¯éå¸¸ç›´æ¥çš„ã€‚ä½†æ˜¯ä¸€æ—¦ç½‘ç»œè¯·æ±‚æ“ä½œå¤±è´¥äº†ï¼Œåºåˆ—å°±ä¼šç»ˆæ­¢ã€‚æ•´ä¸ªè®¢é˜…å°†è¢«å–æ¶ˆã€‚å¦‚æœç”¨æˆ·å†æ¬¡ç‚¹å‡»æ›´æ–°æŒ‰é’®ï¼Œå°±æ— æ³•å†æ¬¡å‘èµ·ç½‘ç»œè¯·æ±‚è¿›è¡Œæ›´æ–°æ“ä½œäº†ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦é€‰æ‹©åˆé€‚çš„æ–¹æ¡ˆæ¥è¿›è¡Œé”™è¯¯å¤„ç†ã€‚ä¾‹å¦‚ä½¿ç”¨æšä¸¾ Resultï¼š // è‡ªå®šä¹‰ä¸€ä¸ªæšä¸¾ç±»å‹ Result public enum Result { case success(T) case failure(Swift.Error) } ç„¶åä¹‹å‰çš„ä»£ç éœ€è¦ä¿®æ”¹æˆï¼š updateUserInfoButton.rx.tap .withLatestFrom(rxUserInfo) .flatMapLatest { userInfo -> Observable> in return update(userInfo) .map(Result.success) // è½¬æ¢æˆ Result .catchError { error in Observable.just(Result.failure(error)) } } .observeOn(MainScheduler.instance) .subscribe(onNext: { result in switch result { // å¤„ç† Result case .success: print(\"ç”¨æˆ·ä¿¡æ¯æ›´æ–°æˆåŠŸ\") case .failure(let error): print(\"ç”¨æˆ·ä¿¡æ¯æ›´æ–°å¤±è´¥ï¼š \\(error.localizedDescription)\") } }) .disposed(by: disposeBag) è¿™æ ·æˆ‘ä»¬çš„é”™è¯¯äº‹ä»¶è¢«åŒ…è£…æˆäº† Result.failure(Error) å…ƒç´ ï¼Œå°±ä¸ä¼šç»ˆæ­¢æ•´ä¸ªåºåˆ—ã€‚å°±ç®—ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼Œæ•´ä¸ªè®¢é˜…ä¾ç„¶å­˜åœ¨ã€‚å¦‚æœç”¨æˆ·å†æ¬¡ç‚¹å‡»æ›´æ–°æŒ‰é’®ï¼Œä¹Ÿæ˜¯èƒ½å¤Ÿå‘èµ·ç½‘ç»œè¯·æ±‚è¿›è¡Œæ›´æ–°æ“ä½œçš„ã€‚ ç¤ºä¾‹ï¼š // MARK: â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• // MARK: Test ResultModel // MARK: â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• @IBOutlet weak var testInPreviousWayButton: UIButton! @IBOutlet weak var testResultModelButton: UIButton! override func viewDidLoad() { super.viewDidLoad() testInPreviousWay() testResultModel() } // testInPreviousWay func testInPreviousWay() { // å¦‚æœè¿™éƒ¨åˆ†ä»£ç åªä¼šè¿è¡Œä¸€æ¬¡ï¼ˆåªè¿›è¡Œä¸€æ¬¡ç»‘å®šï¼‰ // æ­¤æ—¶å¦‚æœå‘ç”Ÿerroräº‹ä»¶ä¹‹ååˆ™è¢«ä¸¢å¼ƒï¼Œåç»­ç‚¹å‡»åˆ™æ— æ³•å†å“åº” testInPreviousWayButton.rx.tap .flatMapLatest({ [unowned self] (_) -> Observable in return self.getDictObservable() }) .subscribe(onNext: { [unowned self] (dict) in print(\"Button is Taped: \\(self.testInPreviousWayButton.titleLabel?.text ?? \"\" ) \") print(\"get dict success: \\(dict)\") }, onError: { (_) in // æ­¤å¤„ä¸€æ—¦è¿›å…¥ï¼Œè®¢é˜…å°†å¤±æ•ˆï¼Œåç»­ç‚¹å‡»ä¸ä¼šå“åº” print(\"Button is Taped: \\(self.testInPreviousWayButton.titleLabel?.text ?? \"\" ) \") // err.printLog() }) .disposed(by: disposeBag) } // testResultModel func testResultModel() { enum ResultModel { case success(T) case failure(Error) } // å¦‚æœè¿™éƒ¨åˆ†ä»£ç åªä¼šè¿è¡Œä¸€æ¬¡ï¼ˆåªè¿›è¡Œä¸€æ¬¡ç»‘å®šï¼‰ // æ­¤æ—¶å¦‚æœå‘ç”Ÿerroräº‹ä»¶ä¹‹ååˆ™ä¼šè¢«è½¬æˆResultMode.failure(err) // æ­¤æ—¶æ‹¦æˆªäº†erroräº‹ä»¶ï¼Œè®¢é˜…ä¸ä¼šä¸¢å¼ƒï¼Œåç»­ç‚¹å‡»å¯ä»¥ç»§ç»­å“åº” testResultModelButton.rx.tap .flatMapLatest({ [unowned self] (_) -> Observable> in return self.getDictObservable() .map(ResultModel.success) .catchError({ (error) -> Observable> in return Observable.just(ResultModel.failure(error)) }) }) .subscribe(onNext: { [unowned self] (resultModel) in switch resultModel { case .success(let dict): print(\"Is In ResultModel & Button is Taped: \\(self.testResultModelButton.titleLabel?.text ?? \"\" ) \") print(\"get dict success: \\(dict)\") case .failure(_): print(\"Is In ResultModel & Button is Taped: \\(self.testResultModelButton.titleLabel?.text ?? \"\" ) \") // err.printLog() } }, onError: { [unowned self] (err) in // æ­¤å¤„æ°¸è¿œä¸ä¼šè¿›å…¥ print(\"Is In Subscribe Error & Button is Taped: \\(self.testResultModelButton.titleLabel?.text ?? \"\" ) \") err.printLog() }) .disposed(by: disposeBag) } å¦å¤–ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ materialize æ“ä½œç¬¦æ¥è¿›è¡Œé”™è¯¯å¤„ç†ã€‚è¿™é‡Œå°±ä¸è¯¦ç»†ä»‹ç»äº†ï¼Œå¦‚ä½ æƒ³äº†è§£å¦‚ä½•ä½¿ç”¨ materialize å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç«  How to handle errors in RxSwift "},"RxSwiftStudy/7.Operator-æ“ä½œç¬¦.html":{"url":"RxSwiftStudy/7.Operator-æ“ä½œç¬¦.html","title":"7. Operator - æ“ä½œç¬¦","keywords":"","body":"Operator - æ“ä½œç¬¦ å®˜æ–¹æ–‡æ¡£ http://reactivex.io/documentation/operators.html ä¸­æ–‡ç¿»è¯‘æ–‡æ¡£ https://beeth0ven.github.io/RxSwift-Chinese-Documentation/content/decision_tree.html å‡†å¤‡æµ‹è¯•ä½¿ç”¨çš„æ–¹æ³• Debug debug do åˆ›å»º Observable create never empty just error from of range repeatElement defer interval timer å˜æ¢ Observable toArray map scan flatMap flatMapFirst flatMapLatest flatMapWithIndex concatMap buffer window groupBy è¿‡æ»¤ Observable ignoreElements elementAt filter debounce throttle distinctUntilChanged sample skip skipWhile skipUntil take takeLast takeWhile takeUntil single è”åˆ Observable startWith combineLatest zip withLatestFrom merge switchLatest é”™è¯¯å¤„ç†æ“ä½œç¬¦ catchError catchErrorJustReturn retry retryWhen æ¡ä»¶å’Œ Bool æ“ä½œç¬¦ amb skipWhile skipUntil takeWhile takeUntil æ•°å­¦å’Œèšåˆæ“ä½œç¬¦ concat reduce è¿æ¥ Observable æ“ä½œç¬¦ multicast publish connect refCount replay share shareReplay shareReplayLatestWhileConnected About Time delay delaySubscription defer interval timer timeout Scheduler observeOn subscribeOn Materialize materialize dematerialize Using using "},"RxSwiftStudy/Operator/Prepare.html":{"url":"RxSwiftStudy/Operator/Prepare.html","title":"7.00 å‡†å¤‡æµ‹è¯•ä½¿ç”¨çš„æ–¹æ³•","keywords":"","body":"å‡†å¤‡æµ‹è¯•ä½¿ç”¨çš„æ–¹æ³• ä¸€äº›ç»å¸¸åœ¨æµ‹è¯•ä¸­ä½¿ç”¨åˆ°çš„Observable getFirstObservable() -> Observable 1s observer.onNext(\"First -> 1|A\") observer.onNext(\"First -> 1|B\") observer.onNext(\"First -> 1|C\") 5s observer.onNext(\"First -> 2|A\") observer.onNext(\"First -> 2|B\") observer.onNext(\"First -> 2|C\") 9s observer.onNext(\"First -> 3|A\") observer.onNext(\"First -> 3|B\") observer.onNext(\"First -> 3|C\") observer.onCompleted() func getFirstObservable() -> Observable { return Observable.create({ (observer) -> Disposable in // section 1 delayTime(1, block: { observer.onNext(\"First -> 1|A\") observer.onNext(\"First -> 1|B\") observer.onNext(\"First -> 1|C\") }) // section 2 delayTime(5, block: { observer.onNext(\"First -> 2|A\") observer.onNext(\"First -> 2|B\") observer.onNext(\"First -> 2|C\") }) // section 3 delayTime(9, block: { observer.onNext(\"First -> 3|A\") observer.onNext(\"First -> 3|B\") observer.onNext(\"First -> 3|C\") observer.onCompleted() }) return Disposables.create() }) } getSecondObservable() -> Observable 0.1s observer.onNext(\"Second -> 1\") 4.1s observer.onNext(\"Second -> 2\") 8.1s observer.onNext(\"Second -> 3\") observer.onCompleted() func getSecondObservable() -> Observable { return Observable.create({ (observer) -> Disposable in delayTime(0.1, block: { observer.onNext(\"Second -> 1\") delayTime(4, block: { observer.onNext(\"Second -> 2\") }) delayTime(8, block: { observer.onNext(\"Second -> 3\") observer.onCompleted() }) }) return Disposables.create() }) } getThirdObservable() -> Observable 0.1s observer.onNext(\"Third -> 1\") observer.onNext(\"Third -> 2\") observer.onNext(\"Third -> 3\") observer.onCompleted() func getThirdObservable() -> Observable { return Observable.create({ (observer) -> Disposable in delayTime(0.1, block: { observer.onNext(\"Third -> 1\") observer.onNext(\"Third -> 2\") observer.onNext(\"Third -> 3\") observer.onCompleted() }) return Disposables.create() }) } getFourthObservable() -> Observable 0s print(\"> Send onNext(\\\"0ï¸âƒ£\\\")\") observer.onNext(\"0ï¸âƒ£\") 1s print(\"> Send onNext(\\\"1ï¸âƒ£\\\")\") observer.onNext(\"1ï¸âƒ£\") 2s print(\"> Send onNext(\\\"2ï¸âƒ£\\\")\") observer.onNext(\"2ï¸âƒ£\") func getFourthObservable() -> Observable { let observable = Observable.create({ (observer) -> Disposable in print(\"> Send onNext(\\\"0ï¸âƒ£\\\")\") observer.onNext(\"0ï¸âƒ£\") delayTime(1, block: { print(\"> Send onNext(\\\"1ï¸âƒ£\\\")\") observer.onNext(\"1ï¸âƒ£\") }) delayTime(2, block: { print(\"> Send onNext(\\\"2ï¸âƒ£\\\")\") observer.onNext(\"2ï¸âƒ£\") }) return Disposables.create() }) return observable } getErrorObservable() -> Observable 1s observer.onNext(\"1ï¸âƒ£\") 2s observer.onNext(\"2ï¸âƒ£\") 3s let err = TError.init(errorCode: 10, errorString: \"Test\", errorData: nil) observer.onError(err) func getErrorObservable() -> Observable { return Observable.create({ (observer) -> Disposable in delayTime(1, block: { observer.onNext(\"1ï¸âƒ£\") }) delayTime(2, block: { observer.onNext(\"2ï¸âƒ£\") }) delayTime(3, block: { let err = TError.init(errorCode: 10, errorString: \"Test\", errorData: nil) observer.onError(err) }) return Disposables.create() }) } "},"RxSwiftStudy/Operator/Debug.html":{"url":"RxSwiftStudy/Operator/Debug.html","title":"7.01 Debug Operator","keywords":"","body":"Debug Operator debug æ‰“å°æ‰€æœ‰çš„è®¢é˜…ï¼Œäº‹ä»¶ä»¥åŠé”€æ¯ä¿¡æ¯ eg: func debug() { getFirstObservable() // identifier: æè¿°ï¼Œ trimOutput: æ˜¯å¦æˆªå–æœ€å¤šå››åä¸ªå­—ç¬¦ .debug(\"Test Debug\", trimOutput: true) .subscribe() .disposed(by: disposeBag) } è¾“å‡ºå¦‚ä¸‹ï¼š 2017-12-27 09:14:12.680: Test Debug -> subscribed 2017-12-27 09:14:13.683: Test Debug -> Event next(First -> 1|A) 2017-12-27 09:14:13.683: Test Debug -> Event next(First -> 1|B) 2017-12-27 09:14:13.683: Test Debug -> Event next(First -> 1|C) 2017-12-27 09:14:17.683: Test Debug -> Event next(First -> 2|A) 2017-12-27 09:14:17.683: Test Debug -> Event next(First -> 2|B) 2017-12-27 09:14:17.683: Test Debug -> Event next(First -> 2|C) 2017-12-27 09:14:21.683: Test Debug -> Event next(First -> 3|A) 2017-12-27 09:14:21.683: Test Debug -> Event next(First -> 3|B) 2017-12-27 09:14:21.683: Test Debug -> Event next(First -> 3|C) 2017-12-27 09:14:21.683: Test Debug -> Event completed 2017-12-27 09:14:21.683: Test Debug -> isDisposed do å½“ Observable äº§ç”ŸæŸäº›äº‹ä»¶æ—¶ï¼Œæ‰§è¡ŒæŸä¸ªæ“ä½œ å½“ Observable çš„æŸäº›äº‹ä»¶äº§ç”Ÿæ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ do æ“ä½œç¬¦æ¥æ³¨å†Œä¸€äº›å›è°ƒæ“ä½œã€‚ è¿™äº›å›è°ƒä¼šè¢«å•ç‹¬è°ƒç”¨ï¼Œå®ƒä»¬ä¼šå’Œ Observable åŸæœ¬çš„å›è°ƒåˆ†ç¦»ã€‚ eg: func `do`() { let observable = Observable.create({ (observer) -> Disposable in delayTime(1, block: { observer.onNext(\"1ï¸âƒ£\") }) delayTime(2, block: { observer.onNext(\"2ï¸âƒ£\") }) delayTime(3, block: { observer.onNext(\"3ï¸âƒ£\") observer.onCompleted() }) return Disposables.create() }) observable .do(onNext: { (str) in print(\"do --> \" + str) }, onError: { (error) in print(\"do --> \") error.printLog() }, onCompleted: { print(\"do --> onCompleted\") }, onSubscribe: { print(\"do --> onSubscribe\") }, onSubscribed: { print(\"do --> onSubscribed\") }, onDispose: { print(\"do --> onDispose\") }) .subscribe({ (e) in print(\"in subscribe --> \\(e)\") }) .disposed(by: disposeBag) } è¾“å‡ºå¦‚ä¸‹ï¼š do --> onSubscribe do --> onSubscribed do --> 1ï¸âƒ£ in subscribe --> next(1ï¸âƒ£) do --> 2ï¸âƒ£ in subscribe --> next(2ï¸âƒ£) do --> 3ï¸âƒ£ in subscribe --> next(3ï¸âƒ£) do --> onCompleted in subscribe --> completed do --> onDispose "},"RxSwiftStudy/Operator/Create.html":{"url":"RxSwiftStudy/Operator/Create.html","title":"7.02 åˆ›å»º Observable","keywords":"","body":"åˆ›å»º Observable - Create Observable Operator create create æ“ä½œç¬¦å°†åˆ›å»ºä¸€ä¸ª Observableï¼Œä½ éœ€è¦æä¾›ä¸€ä¸ªæ„å»ºå‡½æ•°ï¼Œåœ¨æ„å»ºå‡½æ•°é‡Œé¢æè¿°äº‹ä»¶ï¼ˆnextï¼Œerrorï¼Œcompletedï¼‰çš„äº§ç”Ÿè¿‡ç¨‹ã€‚ é€šå¸¸æƒ…å†µä¸‹ä¸€ä¸ªæœ‰é™çš„åºåˆ—ï¼Œåªä¼šè°ƒç”¨ä¸€æ¬¡è§‚å¯Ÿè€…çš„ onCompleted æˆ–è€… onError æ–¹æ³•ã€‚å¹¶ä¸”åœ¨è°ƒç”¨å®ƒä»¬åï¼Œä¸ä¼šå†å»è°ƒç”¨è§‚å¯Ÿè€…çš„å…¶ä»–æ–¹æ³•ã€‚ eg: func create() { _ = Observable.create { (observer) -> Disposable in observer.onNext(\"1\") observer.onNext(\"2\") observer.onNext(\"3\") observer.onNext(\"4\") observer.onNext(\"5\") observer.onNext(\"6\") observer.onNext(\"7\") observer.onCompleted() return Disposables.create() } } never åˆ›å»ºä¸€ä¸ªæ°¸è¿œä¸ä¼šå‘å‡ºå…ƒç´ çš„ Observable never æ“ä½œç¬¦å°†åˆ›å»ºä¸€ä¸ª Observableï¼Œè¿™ä¸ª Observable ä¸ä¼šäº§ç”Ÿä»»ä½•äº‹ä»¶ã€‚ eg: func never() { let observable = Observable.never() observable .subscribe({ (e) in print(e) }) .disposed(by: disposeBag) } empty åˆ›å»ºä¸€ä¸ªç©º Observable empty æ“ä½œç¬¦å°†åˆ›å»ºä¸€ä¸ª Observableï¼Œè¿™ä¸ª Observable åªæœ‰ä¸€ä¸ªå®Œæˆäº‹ä»¶ã€‚ eg: func empty() { let observable = Observable.empty() // ç›¸å½“äºä»¥ä¸‹ä»£ç  // let observable = Observable.create { observer in // observer.onCompleted() // return Disposables.create() // } observable .debug(\"Empty\") .subscribe() .disposed(by: disposeBag) } è¾“å‡ºï¼š 2017-12-27 09:25:19.926: Empty -> subscribed 2017-12-27 09:25:19.926: Empty -> Event completed 2017-12-27 09:25:19.926: Empty -> isDisposed just åˆ›å»º Observable å‘å‡ºå”¯ä¸€çš„ä¸€ä¸ªå…ƒç´  just æ“ä½œç¬¦å°†æŸä¸€ä¸ªå…ƒç´ è½¬æ¢ä¸º Observableã€‚ eg: func just() { let justObservable = Observable.just(\"A String\") // ç›¸å½“äºï¼š // let justObservable = Observable.create { observer in // observer.onNext(\"A String\") // observer.onCompleted() // return Disposables.create() // } justObservable .subscribe({ (e) in print(\"just => \\(e.debugDescription)\") }) .disposed(by: disposeBag) } è¾“å‡ºå¦‚ä¸‹ï¼š just => next(A String) just => completed error åˆ›å»ºä¸€ä¸ªåªæœ‰ error äº‹ä»¶çš„ Observable error æ“ä½œç¬¦å°†åˆ›å»ºä¸€ä¸ª Observableï¼Œè¿™ä¸ª Observable åªä¼šäº§ç”Ÿä¸€ä¸ª error äº‹ä»¶ã€‚ eg: func error() { let err = TError.init(errorCode: 10, errorString: \"test error\", errorData: nil) let observable = Observable.error(err) // ç›¸å½“äºä»¥ä¸‹ä»£ç  // let err = TError.init(errorCode: 10, errorString: \"test error\", errorData: nil) // let id = Observable.create { observer in // observer.onError(err) // return Disposables.create() // } observable .subscribe({ (e) in print(\"Error --> \\(e.debugDescription)\") }) .disposed(by: disposeBag) } è¾“å‡ºå¦‚ä¸‹ï¼š Error --> error(TError(errorCode: 10, errorString: \"test error\", errorData: nil)) from å°†å…¶ä»–ç±»å‹æˆ–è€…æ•°æ®ç»“æ„è½¬æ¢ä¸º Observable, å½“ä½ åœ¨ä½¿ç”¨ Observable æ—¶ï¼Œå¦‚æœèƒ½å¤Ÿç›´æ¥å°†å…¶ä»–ç±»å‹è½¬æ¢ä¸º Observableï¼Œè¿™å°†æ˜¯éå¸¸çœäº‹çš„ã€‚ from æ“ä½œç¬¦å°±æä¾›äº†è¿™ç§åŠŸèƒ½ï¼Œå°†ä¸€ä¸ªæ•°ç»„è½¬æ¢ä¸º Observable eg: func from() { let array = [34, 2, 44, 21, 54] let observable = Observable.from(array) // ç›¸å½“äº // let observable = Observable.create { (observer) -> Disposable in // observer.onNext(34) // observer.onNext(2) // observer.onNext(44) // observer.onNext(21) // observer.onNext(54) // observer.onCompleted() // return Disposables.create() // } observable .subscribe({ (e) in print(\"From Array => \\(e.debugDescription)\") }) .disposed(by: disposeBag) // å°†ä¸€ä¸ªå¯é€‰å€¼è½¬æ¢ä¸º Observableï¼š let optionalInt: Int? = 12 let observableOptional = Observable.from(optional: optionalInt) // ç›¸å½“äº // let optionalInt: Int? = 12 // let observableOptional = Observable.create { observer in // if let value = optionalInt { // observer.onNext(value) // } // observer.onCompleted() // return Disposables.create() // } observableOptional .subscribe({ (e) in print(\"From Optional => \\(e.debugDescription)\") }) .disposed(by: disposeBag) } è¾“å‡ºå¦‚ä¸‹ï¼š From Array => next(34) From Array => next(2) From Array => next(44) From Array => next(21) From Array => next(54) From Array => completed From Optional => next(12) From Optional => completed of of æ“ä½œç¬¦å°†æŸä¸€ä¸ªå…ƒç´ æˆ–å¤šä¸ªå…ƒç´ è½¬æ¢ä¸º Observableã€‚ eg: func of() { let ofObservable = Observable.of(1, 2, 3) // let ofObservable = Observable.of(1, 2, 3, scheduler: MainScheduler.instance) // ç›¸å½“äº: // let ofObservable = Observable.create { observer in // observer.onNext(1) // observer.onNext(2) // observer.onNext(3) // observer.onCompleted() // return Disposables.create() // } ofObservable .subscribe({ (e) in print(\"Of => \\(e.debugDescription)\") }) .disposed(by: disposeBag) } è¾“å‡ºå¦‚ä¸‹ Of => next(1) Of => next(2) Of => next(3) Of => completed range åˆ›å»ºä¸€ä¸ªå‘å°„ç‰¹å®šèŒƒå›´çš„é¡ºåºæ•´æ•°çš„ Observable eg: func range() { let rangeObservable = Observable.range(start: 10, count: 30, scheduler: MainScheduler.instance) rangeObservable .debug(\"range\") .subscribe() .disposed(by: disposeBag) } è¾“å‡ºå¦‚ä¸‹ï¼š 2017-12-27 09:37:15.266: range -> subscribed 2017-12-27 09:37:15.266: range -> Event next(10) 2017-12-27 09:37:15.267: range -> Event next(11) 2017-12-27 09:37:15.267: range -> Event next(12) 2017-12-27 09:37:15.268: range -> Event next(13) 2017-12-27 09:37:15.268: range -> Event next(14) 2017-12-27 09:37:15.268: range -> Event next(15) 2017-12-27 09:37:15.268: range -> Event next(16) 2017-12-27 09:37:15.268: range -> Event next(17) 2017-12-27 09:37:15.268: range -> Event next(18) 2017-12-27 09:37:15.268: range -> Event next(19) 2017-12-27 09:37:15.268: range -> Event next(20) 2017-12-27 09:37:15.268: range -> Event next(21) 2017-12-27 09:37:15.268: range -> Event next(22) 2017-12-27 09:37:15.268: range -> Event next(23) 2017-12-27 09:37:15.268: range -> Event next(24) 2017-12-27 09:37:15.268: range -> Event next(25) 2017-12-27 09:37:15.268: range -> Event next(26) 2017-12-27 09:37:15.268: range -> Event next(27) 2017-12-27 09:37:15.268: range -> Event next(28) 2017-12-27 09:37:15.268: range -> Event next(29) 2017-12-27 09:37:15.268: range -> Event next(30) 2017-12-27 09:37:15.269: range -> Event next(31) 2017-12-27 09:37:15.269: range -> Event next(32) 2017-12-27 09:37:15.269: range -> Event next(33) 2017-12-27 09:37:15.269: range -> Event next(34) 2017-12-27 09:37:15.269: range -> Event next(35) 2017-12-27 09:37:15.269: range -> Event next(36) 2017-12-27 09:37:15.269: range -> Event next(37) 2017-12-27 09:37:15.269: range -> Event next(38) 2017-12-27 09:37:15.269: range -> Event next(39) 2017-12-27 09:37:15.269: range -> Event completed 2017-12-27 09:37:15.269: range -> isDisposed repeatElement repeatElement æ“ä½œç¬¦å°†åˆ›å»ºä¸€ä¸ª Observableï¼Œè¿™ä¸ª Observable å°†æ— æ­¢å°½çš„å‘å‡ºåŒä¸€ä¸ªå…ƒç´ ã€‚ eg: func repeatElement() { let observable = Observable.repeatElement(10, scheduler: MainScheduler.instance) // ç›¸å½“äºï¼š // let observable = Observable.create { observer in // DispatchQueue.global().async { // while true { // DispatchQueue.main.async { // observer.onNext(0) // } // // é˜²æ­¢é˜»å¡ä¸»çº¿ç¨‹ // Thread.sleep(forTimeInterval: 0.001) // } // } // return Disposables.create() // } observable .debug(\"repeatElement\") .subscribe() .disposed(by: disposeBag) } è¾“å‡ºå¦‚ä¸‹ï¼š 2017-12-27 09:39:01.061: repeatElement -> subscribed 2017-12-27 09:39:01.061: repeatElement -> Event next(10) 2017-12-27 09:39:01.062: repeatElement -> Event next(10) 2017-12-27 09:39:01.062: repeatElement -> Event next(10) 2017-12-27 09:39:01.062: repeatElement -> Event next(10) 2017-12-27 09:39:01.062: repeatElement -> Event next(10) 2017-12-27 09:39:01.062: repeatElement -> Event next(10) 2017-12-27 09:39:01.062: repeatElement -> Event next(10) 2017-12-27 09:39:01.063: repeatElement -> Event next(10) 2017-12-27 09:39:01.063: repeatElement -> Event next(10) 2017-12-27 09:39:01.063: repeatElement -> Event next(10) 2017-12-27 09:39:01.063: repeatElement -> Event next(10) ............ ............ defer ç›´åˆ°è®¢é˜…å‘ç”Ÿï¼Œæ‰åˆ›å»º Observableï¼Œå¹¶ä¸”ä¸ºæ¯ä½è®¢é˜…è€…åˆ›å»ºå…¨æ–°çš„ Observable âš ï¸æ³¨æ„ï¼šæ˜¯å»¶è¿Ÿåˆ›å»º Observable ï¼Œè€Œä¸æ˜¯å»¶è¿Ÿè®¢é˜…æˆ–è€…å»¶è¿Ÿå…ƒç´ çš„å‘å‡ºæ—¶é—´ defer æ“ä½œç¬¦å°†ç­‰å¾…è§‚å¯Ÿè€…è®¢é˜…å®ƒï¼Œæ‰åˆ›å»ºä¸€ä¸ª Observableï¼Œå®ƒä¼šé€šè¿‡ä¸€ä¸ªæ„å»ºå‡½æ•°ä¸ºæ¯ä¸€ä½è®¢é˜…è€…åˆ›å»ºæ–°çš„ Observableã€‚ âš ï¸æ³¨æ„ï¼šçœ‹ä¸Šå»æ¯ä½è®¢é˜…è€…éƒ½æ˜¯å¯¹åŒä¸€ä¸ª Observable äº§ç”Ÿè®¢é˜…ï¼Œå®é™…ä¸Šå®ƒä»¬éƒ½è·å¾—äº†ç‹¬ç«‹çš„åºåˆ—ã€‚å…¶å®å¹¶ä¸æ˜¯åƒä»¥å‰ä¸€æ ·è®¢é˜…åŒä¸€ä¸ª Observableï¼Œå®é™…ä¸ºæ¯ä¸ªè®¢é˜…è€…éƒ½åˆ›å»ºäº†ä¸€ä¸ª Observable ï¼Œåœ¨ä¸€äº›æƒ…å†µä¸‹ï¼Œç›´åˆ°è®¢é˜…æ—¶æ‰åˆ›å»º Observable æ˜¯å¯ä»¥ä¿è¯æ‹¿åˆ°çš„æ•°æ®éƒ½æ˜¯æœ€æ–°çš„ã€‚ eg: func `defer`() { let observable = Observable.deferred { [unowned self] () -> Observable in print(\"Observable is Create Now\") return self.getSecondObservable() } delayTime(2) { print(\"First Subscribe Now\") observable .debug(\"Test Defer: First Subscribe\") .subscribe() .disposed(by: self.disposeBag) } // æµ‹è¯•æ˜¯å¦ä¸ºæ¯ä½è®¢é˜…è€…éƒ½åˆ›å»ºäº† Observable delayTime(5) { print(\"Second Subscribe Now\") observable .debug(\"Test Defer: Second Subscribe\") .subscribe() .disposed(by: self.disposeBag) } } è¾“å‡ºå¦‚ä¸‹ï¼š First Subscribe Now 2017-12-27 09:44:31.176: Test Defer: First Subscribe -> subscribed Observable is Create Now 2017-12-27 09:44:31.280: Test Defer: First Subscribe -> Event next(Second -> 1) Second Subscribe Now 2017-12-27 09:44:34.171: Test Defer: Second Subscribe -> subscribed Observable is Create Now 2017-12-27 09:44:34.279: Test Defer: Second Subscribe -> Event next(Second -> 1) 2017-12-27 09:44:35.280: Test Defer: First Subscribe -> Event next(Second -> 2) 2017-12-27 09:44:38.279: Test Defer: Second Subscribe -> Event next(Second -> 2) 2017-12-27 09:44:39.280: Test Defer: First Subscribe -> Event next(Second -> 3) 2017-12-27 09:44:39.280: Test Defer: First Subscribe -> Event completed 2017-12-27 09:44:39.280: Test Defer: First Subscribe -> isDisposed 2017-12-27 09:44:42.279: Test Defer: Second Subscribe -> Event next(Second -> 3) 2017-12-27 09:44:42.279: Test Defer: Second Subscribe -> Event completed 2017-12-27 09:44:42.280: Test Defer: Second Subscribe -> isDisposed interval åˆ›å»ºä¸€ä¸ª Observable æ¯éš”ä¸€æ®µæ—¶é—´ï¼Œå‘å‡ºä¸€ä¸ªç´¢å¼•æ•° interval æ“ä½œç¬¦å°†åˆ›å»ºä¸€ä¸ª Observableï¼Œå®ƒæ¯éš”ä¸€æ®µè®¾å®šçš„æ—¶é—´ï¼Œå‘å‡ºä¸€ä¸ªç´¢å¼•æ•°çš„å…ƒç´ ã€‚å®ƒå°†å‘å‡ºæ— æ•°ä¸ªå…ƒç´ ã€‚ eg: func interval() { let intervalQueue = DispatchQueue.init(label: \"ink.tbd.test.interval\") Observable .interval(1, scheduler: ConcurrentDispatchQueueScheduler.init(queue: intervalQueue)) .subscribe({ (e) in print(\"interval => \\(e.debugDescription)\") }) .disposed(by: disposeBag) } è¾“å‡ºå¦‚ä¸‹ï¼š interval => next(0) interval => next(1) interval => next(2) interval => next(3) interval => next(4) interval => next(5) interval => next(6) interval => next(7) ........... ........... timer åˆ›å»ºä¸€ä¸ª Observable åœ¨ä¸€æ®µå»¶æ—¶åï¼Œäº§ç”Ÿå”¯ä¸€çš„ä¸€ä¸ªå…ƒç´  timer æ“ä½œç¬¦å°†åˆ›å»ºä¸€ä¸ª Observableï¼Œå®ƒåœ¨ç»è¿‡è®¾å®šçš„ä¸€æ®µæ—¶é—´åï¼Œäº§ç”Ÿå”¯ä¸€çš„ä¸€ä¸ªå…ƒç´ ã€‚ âš ï¸æ³¨æ„ï¼štimer(_:period:scheduler:) ä¸ interval(_:scheduler:) çš„åŒºåˆ« timer(_:period:scheduler:) çš„å®ç°ï¼š public static func timer(_ dueTime: RxTimeInterval, period: RxTimeInterval? = nil, scheduler: SchedulerType) -> Observable { return Timer( dueTime: dueTime, period: period, scheduler: scheduler ) } interval(_:scheduler:) çš„å®ç°ï¼š public static func interval(_ period: RxTimeInterval, scheduler: SchedulerType) -> Observable { return Timer(dueTime: period, period: period, scheduler: scheduler ) } eg: func timer() { // dueTime: åˆå§‹å»¶æ—¶, period: æ—¶é—´é—´éš”, scheduler: é˜Ÿåˆ— let timerObservable = Observable.timer(5.0, period: 1, scheduler: MainScheduler.instance) timerObservable .debug(\"timer\") .subscribe() .disposed(by: disposeBag) } è¾“å‡ºå¦‚ä¸‹ï¼š 2017-12-27 09:57:16.075: timer -> subscribed 2017-12-27 09:57:21.077: timer -> Event next(0) 2017-12-27 09:57:22.076: timer -> Event next(1) 2017-12-27 09:57:23.077: timer -> Event next(2) 2017-12-27 09:57:24.077: timer -> Event next(3) 2017-12-27 09:57:25.077: timer -> Event next(4) 2017-12-27 09:57:26.077: timer -> Event next(5) 2017-12-27 09:57:27.077: timer -> Event next(6) 2017-12-27 09:57:28.076: timer -> Event next(7) 2017-12-27 09:57:29.076: timer -> Event next(8) 2017-12-27 09:57:30.076: timer -> Event next(9) 2017-12-27 09:57:31.075: timer -> Event next(10) ............ ............ "},"RxSwiftStudy/Operator/Transforming.html":{"url":"RxSwiftStudy/Operator/Transforming.html","title":"7.03 å˜æ¢ Observable","keywords":"","body":"å˜æ¢ Observable - Transforming Operator toArray å°† Observable ä¸­çš„å•ä¸ªå…ƒç´ è½¬æ¢æˆ Array çš„æ•°æ®ç»“æ„çš„ Observable è¿›è¡Œå‘é€ eg: func toArray() { let observable = Observable.of(1, 2, 3, 4, 5, 6) observable .toArray() .debug(\"toArray\") .subscribe() .disposed(by: disposeBag) } è¾“å‡ºå¦‚ä¸‹ï¼š 2017-12-27 10:05:30.889: toArray -> subscribed 2017-12-27 10:05:30.893: toArray -> Event next([1, 2, 3, 4, 5, 6]) 2017-12-27 10:05:30.893: toArray -> Event completed 2017-12-27 10:05:30.893: toArray -> isDisposed map é€šè¿‡ä¸€ä¸ªè½¬æ¢å‡½æ•°ï¼Œå°† Observable çš„æ¯ä¸ªå…ƒç´ è½¬æ¢ä¸€éï¼Œmap æ“ä½œç¬¦å°†æº Observable çš„æ¯ä¸ªå…ƒç´ åº”ç”¨ä½ æä¾›çš„è½¬æ¢æ–¹æ³•ï¼Œç„¶åè¿”å›å«æœ‰è½¬æ¢ç»“æœçš„ Observableã€‚ func map() { let disposeBag = DisposeBag() Observable.of(1, 2, 3) .map({ (value) -> String in return \"Value is \\(value * 10)\" }) .subscribe({ e in print(\"map => \\(e.debugDescription)\") }) .disposed(by: disposeBag) } è¾“å‡ºå¦‚ä¸‹ï¼š map => next(Value is 10) map => next(Value is 20) map => next(Value is 30) map => completed scan æŒç»­çš„å°† Observable çš„æ¯ä¸€ä¸ªå…ƒç´ åº”ç”¨ä¸€ä¸ªå‡½æ•°ï¼Œç„¶åå‘å‡ºæ¯ä¸€æ¬¡å‡½æ•°è¿”å›çš„ç»“æœã€‚ scan æ“ä½œç¬¦å°†å¯¹ç¬¬ä¸€ä¸ªå…ƒç´ åº”ç”¨ä¸€ä¸ªå‡½æ•°ï¼Œå°†ç»“æœä½œä¸ºç¬¬ä¸€ä¸ªå…ƒç´ å‘å‡ºã€‚ç„¶åï¼Œå°†ç»“æœä½œä¸ºå‚æ•°å¡«å…¥åˆ°ç¬¬äºŒä¸ªå…ƒç´ çš„åº”ç”¨å‡½æ•°ä¸­ï¼Œåˆ›å»ºç¬¬äºŒä¸ªå…ƒç´ ã€‚ä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ°éå†å®Œå…¨éƒ¨çš„å…ƒç´ ã€‚(è¿™ç§æ“ä½œç¬¦åœ¨å…¶ä»–åœ°æ–¹æœ‰æ—¶å€™è¢«ç§°ä½œæ˜¯ accumulatorã€‚) ä¸ reduce ç±»ä¼¼ï¼Œreduce å‘é€æœ€ç»ˆç»“æœï¼Œscan å‘é€æ¯ä¸ªæ­¥éª¤ eg: func scan() { let observable = Observable.of(1, 2, 4, 8, 16, 32, 64, 128, 256, 512) observable .scan(0, accumulator: { (l, r) -> Int in return l + r }) .debug(\"Scan\") .subscribe() .disposed(by: disposeBag) } è¾“å‡ºå¦‚ä¸‹ï¼š 2017-12-27 10:09:36.991: Scan -> subscribed 2017-12-27 10:09:36.991: Scan -> Event next(1) 2017-12-27 10:09:36.991: Scan -> Event next(3) 2017-12-27 10:09:36.991: Scan -> Event next(7) 2017-12-27 10:09:36.991: Scan -> Event next(15) 2017-12-27 10:09:36.991: Scan -> Event next(31) 2017-12-27 10:09:36.991: Scan -> Event next(63) 2017-12-27 10:09:36.991: Scan -> Event next(127) 2017-12-27 10:09:36.991: Scan -> Event next(255) 2017-12-27 10:09:36.991: Scan -> Event next(511) 2017-12-27 10:09:36.991: Scan -> Event next(1023) 2017-12-27 10:09:36.991: Scan -> Event completed 2017-12-27 10:09:36.991: Scan -> isDisposed flatMap å°† Observable çš„å…ƒç´ è½¬æ¢æˆå…¶ä»–çš„ Observableï¼Œç„¶åå°†è¿™äº› Observables åˆå¹¶ï¼ŒflatMap æ“ä½œç¬¦å°†æº Observable çš„æ¯ä¸€ä¸ªå…ƒç´ åº”ç”¨ä¸€ä¸ªè½¬æ¢æ–¹æ³•ï¼Œå°†ä»–ä»¬è½¬æ¢æˆ Observablesã€‚ç„¶åå°†è¿™äº› Observables çš„å…ƒç´ åˆå¹¶ä¹‹åå†å‘é€å‡ºæ¥ã€‚ è¿™ä¸ªæ“ä½œç¬¦æ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œä¾‹å¦‚ï¼Œå½“ Observable çš„å…ƒç´ æœ¬ç”Ÿæ‹¥æœ‰å…¶ä»–çš„ Observable æ—¶ï¼Œä½ å¯ä»¥å°†æ‰€æœ‰å­ Observables çš„å…ƒç´ å‘é€å‡ºæ¥ã€‚ func flatMap() { let first = BehaviorSubject(value: \"First => ğŸ‘¦ğŸ»\") let second = BehaviorSubject(value: \"Second => ğŸ˜Š\") let variable = Variable(first) variable .asObservable() .flatMap { $0 } .subscribe(onNext: { print($0) }) .disposed(by: disposeBag) first.onNext(\"First => ğŸ±\") variable.value = second second.onNext(\"Second => ğŸ˜¢\") first.onNext(\"First => ğŸ¶\") first.onNext(\"First => ğŸ±\") second.onNext(\"Second => ğŸ˜‚\") } è¾“å‡ºå¦‚ä¸‹ï¼š First => ğŸ‘¦ğŸ» First => ğŸ± Second => ğŸ˜Š Second => ğŸ˜¢ First => ğŸ¶ First => ğŸ± Second => ğŸ˜‚ flatMapFirst å°† Observable çš„å…ƒç´ è½¬æ¢æˆå…¶ä»–çš„ Observableï¼Œç„¶åå–è¿™äº› Observables ä¸­çš„ç¬¬ä¸€ä¸ªã€‚ åªå‘ç¬¬ä¸€ä¸ª Observables çš„å…ƒç´ ï¼Œå…¶ä»–çš„ Observables çš„å…ƒç´ å°†è¢«å¿½ç•¥æ‰ã€‚ eg: func flatMapFirst() { let first = BehaviorSubject(value: \"First => ğŸ‘¦ğŸ»\") let second = BehaviorSubject(value: \"Second => ğŸ˜Š\") let variable = Variable(first) variable .asObservable() .flatMapFirst{ $0 } .subscribe(onNext: { print($0) }) .disposed(by: disposeBag) first.onNext(\"First => ğŸ±\") variable.value = second second.onNext(\"Second => ğŸ˜¢\") first.onNext(\"First => ğŸ¶\") first.onNext(\"First => ğŸ±\") second.onNext(\"Second => ğŸ˜‚\") } è¾“å‡ºå¦‚ä¸‹ï¼š First => ğŸ‘¦ğŸ» First => ğŸ± First => ğŸ¶ First => ğŸ± flatMapLatest å°† Observable çš„å…ƒç´ è½¬æ¢æˆå…¶ä»–çš„ Observableï¼Œç„¶åå–è¿™äº› Observables ä¸­æœ€æ–°çš„ä¸€ä¸ªã€‚ ä¸€æ—¦è½¬æ¢å‡ºä¸€ä¸ªæ–°çš„ Observableï¼Œå°±åªå‘å‡ºå®ƒçš„å…ƒç´ ï¼Œæ—§çš„ Observables çš„å…ƒç´ å°†è¢«å¿½ç•¥æ‰ã€‚ eg: func flatMapLatest() { let first = BehaviorSubject(value: \"First => ğŸ‘¦ğŸ»\") let second = BehaviorSubject(value: \"Second => ğŸ˜Š\") let variable = Variable(first) variable .asObservable() .flatMapLatest { $0 } .subscribe(onNext: { print($0) }) .disposed(by: disposeBag) first.onNext(\"First => ğŸ±\") variable.value = second second.onNext(\"Second => ğŸ˜¢\") first.onNext(\"First => ğŸ¶\") first.onNext(\"First => ğŸ±\") second.onNext(\"Second => ğŸ˜‚\") } è¾“å‡ºå¦‚ä¸‹ï¼š First => ğŸ‘¦ğŸ» First => ğŸ± Second => ğŸ˜Š Second => ğŸ˜¢ Second => ğŸ˜‚ flatMapWithIndex @available(*, deprecated, message: \"Please use enumerated().flatMap()\") flatMapWithIndexï¼ˆ .enumerated().flatMap(_:) ï¼‰ æ“ä½œç¬¦å°† Observable çš„å…ƒç´ è½¬æ¢æˆå…¶ä»–çš„ Observableï¼Œç„¶åå–è¿™äº› Observables ä¸­æŒ‡å®šçš„ä¸€ä¸ªæˆ–è€…å‡ ä¸ªã€‚ åªå‘å‡ºæŒ‡å®šå…è®¸çš„ index çš„ Observable ä¸­äº§ç”Ÿçš„å…ƒç´ ï¼Œå…¶ä»–çš„ Observables çš„å…ƒç´ å°†è¢«å¿½ç•¥æ‰ã€‚ eg: func flatMapWithIndex() { // @available(*, deprecated, message: \"Please use enumerated().flatMap()\") let first = BehaviorSubject(value: \"First => ğŸ‘¦ğŸ»\") let second = BehaviorSubject(value: \"Second => ğŸ˜Š\") let variable = Variable(first) variable .asObservable() .enumerated() .flatMap({ (tuple) -> Observable in let (index, subject) = tuple if index == 1 { return subject } return BehaviorSubject.empty() }) // .enumerated().flatMap(_:) ä»¥å‰æ˜¯ // .flatMapWithIndex({ (subject, index) -> Observable in // if index == 1 { // return subject // } // return BehaviorSubject.empty() // }) .subscribe(onNext: { print($0) }) .disposed(by: disposeBag) first.onNext(\"First => ğŸ±\") variable.value = second second.onNext(\"Second => ğŸ˜¢\") first.onNext(\"First => ğŸ¶\") first.onNext(\"First => ğŸ±\") second.onNext(\"Second => ğŸ˜‚\") } è¾“å‡ºå¦‚ä¸‹ï¼š Second => ğŸ˜Š Second => ğŸ˜¢ Second => ğŸ˜‚ concatMap concatMap æ“ä½œç¬¦å°†æº Observable çš„æ¯ä¸€ä¸ªå…ƒç´ åº”ç”¨ä¸€ä¸ªè½¬æ¢æ–¹æ³•ï¼Œå°†å…ƒç´ è½¬æ¢æˆ Observableã€‚ eg: func concatMap() { getFirstObservable() .concatMap({ (str) -> Observable in return Observable.of(\"\\(str) + 1ï¸âƒ£\", \"\\(str) + 2ï¸âƒ£\", \"\\(str) + 3ï¸âƒ£\", \"======================\") }) .subscribe({ (e) in print(e) }) .disposed(by: disposeBag) } è¾“å‡ºå¦‚ä¸‹ï¼š next(First -> 1|A + 1ï¸âƒ£) next(First -> 1|A + 2ï¸âƒ£) next(First -> 1|A + 3ï¸âƒ£) next(======================) next(First -> 1|B + 1ï¸âƒ£) next(First -> 1|B + 2ï¸âƒ£) next(First -> 1|B + 3ï¸âƒ£) next(======================) next(First -> 1|C + 1ï¸âƒ£) next(First -> 1|C + 2ï¸âƒ£) next(First -> 1|C + 3ï¸âƒ£) next(======================) next(First -> 2|A + 1ï¸âƒ£) next(First -> 2|A + 2ï¸âƒ£) next(First -> 2|A + 3ï¸âƒ£) next(======================) next(First -> 2|B + 1ï¸âƒ£) next(First -> 2|B + 2ï¸âƒ£) next(First -> 2|B + 3ï¸âƒ£) next(======================) next(First -> 2|C + 1ï¸âƒ£) next(First -> 2|C + 2ï¸âƒ£) next(First -> 2|C + 3ï¸âƒ£) next(======================) next(First -> 3|A + 1ï¸âƒ£) next(First -> 3|A + 2ï¸âƒ£) next(First -> 3|A + 3ï¸âƒ£) next(======================) next(First -> 3|B + 1ï¸âƒ£) next(First -> 3|B + 2ï¸âƒ£) next(First -> 3|B + 3ï¸âƒ£) next(======================) next(First -> 3|C + 1ï¸âƒ£) next(First -> 3|C + 2ï¸âƒ£) next(First -> 3|C + 3ï¸âƒ£) next(======================) completed buffer buffer æ“ä½œç¬¦å°†ç¼“å­˜ Observable ä¸­å‘å‡ºçš„æ–°å…ƒç´ ï¼Œå½“å…ƒç´ è¾¾åˆ°æŸä¸ªæ•°é‡ï¼Œæˆ–è€…ç»è¿‡äº†ç‰¹å®šçš„æ—¶é—´ï¼Œå®ƒå°±ä¼šå°†è¿™ä¸ªå…ƒç´ é›†åˆå‘é€å‡ºæ¥ã€‚ eg: func buffer() { getFirstObservable() .buffer(timeSpan: 1, count: 2, scheduler: MainScheduler.instance) .subscribe(onNext: { (strArr) in print(strArr) }) .disposed(by: disposeBag) } è¾“å‡ºå¦‚ä¸‹ï¼š [] [\"First -> 1|A\", \"First -> 1|B\"] [\"First -> 1|C\"] [] [] [\"First -> 2|A\", \"First -> 2|B\"] [\"First -> 2|C\"] [] [] [\"First -> 3|A\", \"First -> 3|B\"] [\"First -> 3|C\"] window å°† Observable åˆ†è§£ä¸ºå¤šä¸ªå­ Observableï¼Œå‘¨æœŸæ€§çš„å°†å­ Observable å‘å‡ºæ¥ window æ“ä½œç¬¦å’Œ buffer ååˆ†ç›¸ä¼¼: \\ å‘é€å‡ºçš„å†…å®¹å½¢æ€ å‘é€çš„æ—¶æœº buffer å‘¨æœŸæ€§çš„å°†ç¼“å­˜çš„å…ƒç´ é›†åˆå‘é€å‡ºæ¥ è¦ç­‰åˆ°å…ƒç´ æœé›†å®Œæ¯•åï¼Œæ‰ä¼šå‘å‡ºå…ƒç´ åºåˆ— window å‘¨æœŸæ€§çš„å°†å…ƒç´ é›†åˆä»¥ Observable çš„å½¢æ€å‘é€å‡ºæ¥ å¯ä»¥å®æ—¶å‘å‡ºå…ƒç´ åºåˆ— eg: func window() { getFirstObservable() .window(timeSpan: 2, count: 3, scheduler: MainScheduler.instance) .subscribe(onNext: { [unowned self] (observable) in print(\"window => onNext(\\(observable))\") observable .subscribe({ (e) in print(\"window|onNext => \\(e)\") }) .disposed(by: self.disposeBag) }, onError: { (err) in print(\"window => onError begin\") err.printLog() print(\"window => onError end\") }, onCompleted: { print(\"window => onCompleted\") }) .disposed(by: disposeBag) } è¾“å‡ºå¦‚ä¸‹ï¼š window => onNext(RxSwift.AddRef) window|onNext => next(First -> 1|A) window|onNext => next(First -> 1|B) window|onNext => next(First -> 1|C) window|onNext => completed window => onNext(RxSwift.AddRef) window|onNext => completed window => onNext(RxSwift.AddRef) window|onNext => next(First -> 2|A) window|onNext => next(First -> 2|B) window|onNext => next(First -> 2|C) window|onNext => completed window => onNext(RxSwift.AddRef) window|onNext => completed window => onNext(RxSwift.AddRef) window|onNext => next(First -> 3|A) window|onNext => next(First -> 3|B) window|onNext => next(First -> 3|C) window|onNext => completed window => onNext(RxSwift.AddRef) window|onNext => completed window => onCompleted groupBy å°†æº Observable åˆ†è§£ä¸ºå¤šä¸ªå­ Observableï¼Œå¹¶ä¸”æ¯ä¸ªå­ Observable å°†æº Observable ä¸­ç›¸ä¼¼çš„å…ƒç´ å‘é€å‡ºæ¥ã€‚ groupBy æ“ä½œç¬¦å°†æº Observable åˆ†è§£ä¸ºå¤šä¸ªå­ Observableï¼Œç„¶åå°†è¿™äº›å­ Observable å‘é€å‡ºæ¥ã€‚ // å®ƒä¼šå°†å…ƒç´ é€šè¿‡æŸä¸ªé”®è¿›è¡Œåˆ†ç»„ï¼Œç„¶åå°†åˆ†ç»„åçš„å…ƒç´ åºåˆ—ä»¥ Observable çš„å½¢æ€å‘é€å‡ºæ¥ã€‚ eg: func groupBy() { enum ObservableValueType { case integer case string case other } let observable = Observable.of(1, 2, 3, 4, \"22\", \"23\", \"34\", \"54\", \"12\", 44, \"112\", 65) observable .groupBy(keySelector: { (value) -> ObservableValueType in if value is Int { return ObservableValueType.integer } if value is String { return ObservableValueType.string } return ObservableValueType.other }) .subscribe(onNext: { [unowned self] (group) in group .subscribe({ (e) in print(\"\\(group.key)\\t=> \\(e.debugDescription)\") }) .disposed(by: self.disposeBag) }) .disposed(by: disposeBag) } è¾“å‡ºå¦‚ä¸‹ï¼š integer => next(1) integer => next(2) integer => next(3) integer => next(4) string => next(22) string => next(23) string => next(34) string => next(54) string => next(12) integer => next(44) string => next(112) integer => next(65) integer => completed string => completed "},"RxSwiftStudy/Operator/Filtering.html":{"url":"RxSwiftStudy/Operator/Filtering.html","title":"7.04 è¿‡æ»¤ Observable","keywords":"","body":"è¿‡æ»¤ Observable - Filtering Operator ignoreElements å¿½ç•¥æ‰æ‰€æœ‰çš„å…ƒç´ ï¼Œåªå‘å‡º error æˆ– completed äº‹ä»¶ ignoreElements æ“ä½œç¬¦å°†é˜»æ­¢ Observable å‘å‡º next äº‹ä»¶ï¼Œä½†æ˜¯å…è®¸ä»–å‘å‡º error æˆ– completed äº‹ä»¶ã€‚ å¦‚æœä½ å¹¶ä¸å…³å¿ƒ Observable çš„ä»»ä½•å…ƒç´ ï¼Œä½ åªæƒ³çŸ¥é“ Observable åœ¨ä»€ä¹ˆæ—¶å€™ç»ˆæ­¢ï¼Œé‚£å°±å¯ä»¥ä½¿ç”¨ ignoreElements æ“ä½œç¬¦ã€‚ eg: func ignoreElements() { Observable.of(1, 2, 3, 4, 5) .ignoreElements() .debug(\"ignoreElements\") .subscribe() .disposed(by: disposeBag) } è¾“å‡ºå¦‚ä¸‹ï¼š 2017-12-27 11:12:47.786: ignoreElements -> subscribed 2017-12-27 11:12:47.787: ignoreElements -> Event completed 2017-12-27 11:12:47.787: ignoreElements -> isDisposed elementAt elementAt æ“ä½œç¬¦å°†æ‹‰å– Observable åºåˆ—ä¸­æŒ‡å®šç´¢å¼•æ•°çš„å…ƒç´ ï¼Œç„¶åå°†å®ƒä½œä¸ºå”¯ä¸€çš„å…ƒç´ å‘å‡ºã€‚ eg: func elementAt() { Observable.of(1, 2, 3, 4, 5) .elementAt(1) .subscribe({ (e) in print(\"elementAt subscribe -> \\(e.debugDescription)\") }) .disposed(by: disposeBag) } è¾“å‡ºå¦‚ä¸‹ï¼š elementAt subscribe -> next(2) elementAt subscribe -> completed filter filter æ“ä½œç¬¦å°†é€šè¿‡ä½ æä¾›çš„åˆ¤å®šæ–¹æ³•è¿‡æ»¤ä¸€ä¸ª Observableã€‚ä»…ä»…å‘å‡º Observable ä¸­é€šè¿‡åˆ¤å®šçš„å…ƒç´ ã€‚ eg: func filter() { Observable .of(21, 3, 15, 50, 4, 23, 90, 11) .debug(\"Filter : \") .filter({ (value) -> Bool in return value >= 20 }) .debug(\"Subscribe : \") .subscribe() .disposed(by: disposeBag) } è¾“å‡ºå¦‚ä¸‹ï¼š 2017-12-27 11:16:48.888: Subscribe : -> subscribed 2017-12-27 11:16:48.888: Filter : -> subscribed 2017-12-27 11:16:48.888: Filter : -> Event next(21) 2017-12-27 11:16:48.888: Subscribe : -> Event next(21) 2017-12-27 11:16:48.888: Filter : -> Event next(3) 2017-12-27 11:16:48.888: Filter : -> Event next(15) 2017-12-27 11:16:48.888: Filter : -> Event next(50) 2017-12-27 11:16:48.888: Subscribe : -> Event next(50) 2017-12-27 11:16:48.888: Filter : -> Event next(4) 2017-12-27 11:16:48.888: Filter : -> Event next(23) 2017-12-27 11:16:48.888: Subscribe : -> Event next(23) 2017-12-27 11:16:48.888: Filter : -> Event next(90) 2017-12-27 11:16:48.888: Subscribe : -> Event next(90) 2017-12-27 11:16:48.888: Filter : -> Event next(11) 2017-12-27 11:16:48.888: Filter : -> Event completed 2017-12-27 11:16:48.888: Subscribe : -> Event completed 2017-12-27 11:16:48.889: Subscribe : -> isDisposed 2017-12-27 11:16:48.889: Filter : -> isDisposed debounce ç”¨äºè¿‡æ»¤ä¸€å®šæ—¶é—´å†…å‘å‡ºçš„é«˜é¢‘å…ƒç´ ï¼Œåªå‘é€æœ€åä¸€ä¸ªã€‚debounce æ“ä½œç¬¦å°†å‘å‡ºè¿™ç§å…ƒç´ ï¼Œåœ¨ Observable äº§ç”Ÿè¿™ç§å…ƒç´ åï¼Œä¸€æ®µæ—¶é—´å†…æ²¡æœ‰æ–°å…ƒç´ äº§ç”Ÿã€‚ eg: func debounce() { getFirstObservable() .debounce(1, scheduler: MainScheduler.instance) .subscribe({ (e) in print(e) }) .disposed(by: disposeBag) } è¾“å‡ºå¦‚ä¸‹ï¼š next(First -> 1|C) next(First -> 2|C) next(First -> 3|C) completed throttle è¿”å›åœ¨æŒ‡å®šè¿ç»­æ—¶é—´çª—å£æœŸé—´ä¸­ï¼Œç”±æº Observable å‘å‡ºçš„ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªå…ƒç´ ã€‚è¿™ä¸ªè¿ç®—ç¬¦ç¡®ä¿æ²¡æœ‰ä¸¤ä¸ªå…ƒç´ åœ¨å°‘äº dueTime çš„æ—¶é—´å‘é€ã€‚ eg: func throttle() { let subject = BehaviorSubject.init(value: 0) subject .asObserver() // 1ç§’å†…ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªå‘å‡ºçš„å…ƒç´  .throttle(2, latest: true, scheduler: MainScheduler.instance) .subscribe({ (e) in print(e) }) .disposed(by: disposeBag) subject.onNext(1) subject.onNext(2) subject.onNext(3) delayTime(3) { // ä¸ä¼šå‘é€onNext(4)ï¼Œå› ä¸ºonNext(3)åœ¨ä¸Šä¸€ä¸ª2ç§’çš„çª—å£ä¸­ï¼Œæœ€åå»¶è¿Ÿåˆ°2ç§’å‘é€å‡ºæ¥ï¼Œ // onNext(4)æ˜¯åœ¨ç¬¬3ç§’è¿›è¡Œå‘é€ï¼Œæ­¤æ—¶ onNext(4)çš„å‘é€æ—¶é—´å‡å»onNext(3)å‘é€æ—¶é—´å°äº2ï¼Œæ‰€ä»¥è¢«å¿½ç•¥ // å› ä¸ºthrottleä¼šç¡®ä¿æ²¡æœ‰ä¸¤ä¸ªå…ƒç´ åœ¨å°‘äºdueTimeçš„æ—¶é—´ subject.onNext(4) subject.onNext(5) subject.onNext(6) } delayTime(8.2) { subject.onNext(7) } delayTime(12.2) { subject.onNext(8) subject.onNext(9) subject.onNext(10) subject.onCompleted() } } è¾“å‡ºå¦‚ä¸‹ï¼š next(0) next(3) next(6) next(7) next(8) next(10) completed distinctUntilChanged distinctUntilChanged æ“ä½œç¬¦å°†é˜»æ­¢ Observable å‘å‡ºç›¸åŒçš„å…ƒç´ ã€‚å¦‚æœåä¸€ä¸ªå…ƒç´ å’Œå‰ä¸€ä¸ªå…ƒç´ æ˜¯ç›¸åŒçš„ï¼Œé‚£ä¹ˆè¿™ä¸ªå…ƒç´ å°†ä¸ä¼šè¢«å‘å‡ºæ¥ã€‚å¦‚æœåä¸€ä¸ªå…ƒç´ å’Œå‰ä¸€ä¸ªå…ƒç´ ä¸ç›¸åŒï¼Œé‚£ä¹ˆè¿™ä¸ªå…ƒç´ æ‰ä¼šè¢«å‘å‡ºæ¥ã€‚ eg: func distinctUntilChanged() { let observable = Observable.of(\"ğŸ±\", \"ğŸ·\", \"ğŸ±\", \"ğŸ±\", \"ğŸ±\", \"ğŸµ\", \"ğŸµ\", \"ğŸµ\", \"ğŸµ\", \"ğŸ±\") observable .distinctUntilChanged() .debug(\"distinctUntilChanged\") .subscribe() .disposed(by: disposeBag) } è¾“å‡ºå¦‚ä¸‹ï¼š 2017-12-27 11:23:01.265: distinctUntilChanged -> subscribed 2017-12-27 11:23:01.269: distinctUntilChanged -> Event next(ğŸ±) 2017-12-27 11:23:01.270: distinctUntilChanged -> Event next(ğŸ·) 2017-12-27 11:23:01.270: distinctUntilChanged -> Event next(ğŸ±) 2017-12-27 11:23:01.270: distinctUntilChanged -> Event next(ğŸµ) 2017-12-27 11:23:01.270: distinctUntilChanged -> Event next(ğŸ±) 2017-12-27 11:23:01.270: distinctUntilChanged -> Event completed 2017-12-27 11:23:01.270: distinctUntilChanged -> isDisposed sample sample æ“ä½œç¬¦å°†ä¸å®šæœŸçš„å¯¹æº Observable è¿›è¡Œå–æ ·æ“ä½œã€‚ é€šè¿‡ç¬¬äºŒä¸ª Observable æ¥æ§åˆ¶å–æ ·æ—¶æœºã€‚ä¸€æ—¦ç¬¬äºŒä¸ª Observable å‘å‡ºä¸€ä¸ªå…ƒç´ ï¼Œå°±ä»æº(ç¬¬ä¸€ä¸ª) Observable ä¸­å–å‡ºæœ€åäº§ç”Ÿçš„å…ƒç´ ï¼ˆå¦‚æœè¿™æ®µæ—¶é—´å†…æ²¡å‘å‡ºå…ƒç´ ï¼Œåˆ™ä¸å–ï¼‰ã€‚ eg: func sample() { let sampleObservable = Observable.interval(1, scheduler: MainScheduler.instance) let observable = getFirstObservable() .sample(sampleObservable) observable .debug(\"sample\") .subscribe() .disposed(by: disposeBag) } è¾“å‡ºå¦‚ä¸‹ï¼š 2017-12-27 11:24:47.642: sample -> subscribed 2017-12-27 11:24:48.643: sample -> Event next(First -> 1|C) 2017-12-27 11:24:52.644: sample -> Event next(First -> 2|C) 2017-12-27 11:24:56.643: sample -> Event next(First -> 3|C) 2017-12-27 11:24:56.643: sample -> Event completed 2017-12-27 11:24:56.643: sample -> isDisposed skip skip æ“ä½œç¬¦å¯ä»¥è®©ä½ è·³è¿‡ Observable ä¸­å¤´ n ä¸ªå…ƒç´ ï¼Œåªå…³æ³¨åé¢çš„å…ƒç´ ã€‚ eg: func skip() { Observable .of(0, 0, 0, 0, 1, 2, 3, 4, 5) .skip(4) .debug(\"skip\") .subscribe() .disposed(by: disposeBag) } è¾“å‡ºå¦‚ä¸‹ï¼š 2017-12-27 11:33:49.559: skip -> subscribed 2017-12-27 11:33:49.559: skip -> Event next(1) 2017-12-27 11:33:49.559: skip -> Event next(2) 2017-12-27 11:33:49.559: skip -> Event next(3) 2017-12-27 11:33:49.559: skip -> Event next(4) 2017-12-27 11:33:49.559: skip -> Event next(5) 2017-12-27 11:33:49.559: skip -> Event completed 2017-12-27 11:33:49.559: skip -> isDisposed skipWhile è·³è¿‡ Observable ä¸­å¤´å‡ ä¸ªå…ƒç´ ï¼Œç›´åˆ°å…ƒç´ çš„åˆ¤å®šä¸ºå¦ï¼Œé—­åŒ…è¿”å› true åˆ™è·³è¿‡(skip)ï¼ŒskipWhile æ“ä½œç¬¦å¯ä»¥è®©ä½ å¿½ç•¥æº Observable ä¸­ å¤´å‡ ä¸ª å…ƒç´ ï¼Œç›´åˆ°å…ƒç´ çš„åˆ¤å®šä¸º false åï¼Œå®ƒæ‰é•œåƒæº Observableï¼Œä¸€æ—¦æœ‰ false äº§ç”Ÿï¼Œåé¢çš„å…ƒç´ ä¸ä¼šå†è¿›è¡Œåˆ¤æ–­ã€‚ eg: func skipWhile() { Observable .of(0, 0, 0, 0, 1, 2, 3, 4, 5, -1, 0, 0, 10) .skipWhile({ (value) -> Bool in return value == 0 }) .debug(\"skipWhile\") .subscribe() .disposed(by: disposeBag) } è¾“å‡ºå¦‚ä¸‹ï¼š 2017-12-27 11:35:43.512: skipWhile -> subscribed 2017-12-27 11:35:43.512: skipWhile -> Event next(1) 2017-12-27 11:35:43.512: skipWhile -> Event next(2) 2017-12-27 11:35:43.513: skipWhile -> Event next(3) 2017-12-27 11:35:43.513: skipWhile -> Event next(4) 2017-12-27 11:35:43.513: skipWhile -> Event next(5) 2017-12-27 11:35:43.513: skipWhile -> Event next(-1) 2017-12-27 11:35:43.513: skipWhile -> Event next(0) 2017-12-27 11:35:43.513: skipWhile -> Event next(0) 2017-12-27 11:35:43.513: skipWhile -> Event next(10) 2017-12-27 11:35:43.513: skipWhile -> Event completed 2017-12-27 11:35:43.513: skipWhile -> isDisposed skipUntil è·³è¿‡ Observable ä¸­å¤´å‡ ä¸ªå…ƒç´ ï¼Œç›´åˆ°å¦ä¸€ä¸ª Observable å‘å‡ºä¸€ä¸ªå…ƒç´ ï¼ŒskipUntil æ“ä½œç¬¦å¯ä»¥è®©ä½ å¿½ç•¥æº Observable ä¸­å¤´å‡ ä¸ªå…ƒç´ ï¼Œç›´åˆ°å¦ä¸€ä¸ª Observable å‘å‡ºä¸€ä¸ªå…ƒç´ åï¼Œå®ƒæ‰é•œåƒæº Observableã€‚ eg: func skipUntil() { let skipUntilObservable = Observable.create { (observer) -> Disposable in delayTime(3, block: { print(\"skipUntilObservable => onNext(0)\") observer.onNext(0) }) return Disposables.create() } getFirstObservable() .skipUntil(skipUntilObservable) .debug(\"skipUntil\") .subscribe() .disposed(by: disposeBag) } è¾“å‡ºå¦‚ä¸‹ï¼š 2017-12-27 12:25:42.199: skipUntil -> subscribed skipUntilObservable => onNext(0) 2017-12-27 12:25:47.199: skipUntil -> Event next(First -> 2|A) 2017-12-27 12:25:47.200: skipUntil -> Event next(First -> 2|B) 2017-12-27 12:25:47.200: skipUntil -> Event next(First -> 2|C) 2017-12-27 12:25:51.201: skipUntil -> Event next(First -> 3|A) 2017-12-27 12:25:51.201: skipUntil -> Event next(First -> 3|B) 2017-12-27 12:25:51.201: skipUntil -> Event next(First -> 3|C) 2017-12-27 12:25:51.201: skipUntil -> Event completed 2017-12-27 12:25:51.201: skipUntil -> isDisposed take é€šè¿‡ take æ“ä½œç¬¦ä½ å¯ä»¥åªå‘å‡ºå¤´ n ä¸ªå…ƒç´ ã€‚å¹¶ä¸”å¿½ç•¥æ‰åé¢çš„å…ƒç´ ï¼Œç›´æ¥ç»“æŸåºåˆ—ã€‚ eg: func take() { Observable.of(\"ğŸ±\", \"ğŸ°\", \"ğŸ¶\", \"ğŸ¸\", \"ğŸ·\", \"ğŸµ\") .take(3) .debug(\"take\") .subscribe() .disposed(by: disposeBag) } è¾“å‡ºå¦‚ä¸‹ï¼š 2017-12-27 12:28:14.822: take -> subscribed 2017-12-27 12:28:14.822: take -> Event next(ğŸ±) 2017-12-27 12:28:14.822: take -> Event next(ğŸ°) 2017-12-27 12:28:14.822: take -> Event next(ğŸ¶) 2017-12-27 12:28:14.822: take -> Event completed 2017-12-27 12:28:14.822: take -> isDisposed takeLast é€šè¿‡ takeLast æ“ä½œç¬¦ä½ å¯ä»¥åªå‘å‡ºå°¾éƒ¨ n ä¸ªå…ƒç´ ã€‚å¹¶ä¸”å¿½ç•¥æ‰å‰é¢çš„å…ƒç´ ã€‚ åœ¨ onCompleted() ä¹‹åå–å‡ºæœ€ånä¸ªå…ƒç´ ä¸€æ¬¡æ€§å‘å‡ºã€‚ eg: func takeLast() { getFirstObservable() .takeLast(5) .debug(\"takeLast\") .subscribe() .disposed(by: disposeBag) } è¾“å‡ºå¦‚ä¸‹ï¼š 2017-12-27 12:30:13.992: takeLast -> subscribed 2017-12-27 12:30:22.994: takeLast -> Event next(First -> 2|B) 2017-12-27 12:30:22.994: takeLast -> Event next(First -> 2|C) 2017-12-27 12:30:22.994: takeLast -> Event next(First -> 3|A) 2017-12-27 12:30:22.994: takeLast -> Event next(First -> 3|B) 2017-12-27 12:30:22.994: takeLast -> Event next(First -> 3|C) 2017-12-27 12:30:22.995: takeLast -> Event completed 2017-12-27 12:30:22.995: takeLast -> isDisposed takeWhile é•œåƒä¸€ä¸ª Observable ç›´åˆ°æŸä¸ªå…ƒç´ çš„åˆ¤å®šä¸º false é—­åŒ…è¿”å› true åˆ™æ”¾è¡Œï¼Œè¿”å› false åˆ™ç»“æŸ takeWhile æ“ä½œç¬¦å°†é•œåƒæº Observable ç›´åˆ°æŸä¸ªå…ƒç´ çš„åˆ¤å®šä¸º falseã€‚æ­¤æ—¶ï¼Œè¿™ä¸ªé•œåƒçš„ Observable å°†ç«‹å³ç»ˆæ­¢ã€‚ eg: func takeWhile() { Observable .of(0, 0, 0, 0, 1, 2, 3, 4, 5, -1, 0, 0, 10) .takeWhile({ (value) -> Bool in return value >= 0 }) .debug(\"skipWhile\") .subscribe() .disposed(by: disposeBag) } è¾“å‡ºå¦‚ä¸‹ï¼š 2017-12-27 12:32:42.491: skipWhile -> subscribed 2017-12-27 12:32:42.492: skipWhile -> Event next(0) 2017-12-27 12:32:42.492: skipWhile -> Event next(0) 2017-12-27 12:32:42.492: skipWhile -> Event next(0) 2017-12-27 12:32:42.492: skipWhile -> Event next(0) 2017-12-27 12:32:42.492: skipWhile -> Event next(1) 2017-12-27 12:32:42.492: skipWhile -> Event next(2) 2017-12-27 12:32:42.492: skipWhile -> Event next(3) 2017-12-27 12:32:42.492: skipWhile -> Event next(4) 2017-12-27 12:32:42.492: skipWhile -> Event next(5) 2017-12-27 12:32:42.492: skipWhile -> Event completed 2017-12-27 12:32:42.492: skipWhile -> isDisposed takeUntil å¿½ç•¥ä¸€éƒ¨åˆ†å…ƒç´ ï¼Œè¿™äº›å…ƒç´ æ˜¯åœ¨ç¬¬äºŒä¸ª Observable äº§ç”Ÿäº‹ä»¶åå‘å‡ºçš„(åˆ™è¢«å¿½ç•¥)ã€‚ takeUntil æ“ä½œç¬¦å°†é•œåƒæº Observableï¼Œå®ƒåŒæ—¶è§‚æµ‹ç¬¬äºŒä¸ª Observableã€‚ä¸€æ—¦ç¬¬äºŒä¸ª Observable å‘å‡ºä¸€ä¸ªå…ƒç´ æˆ–è€…äº§ç”Ÿä¸€ä¸ªç»ˆæ­¢äº‹ä»¶ï¼Œé‚£ä¸ªé•œåƒçš„ Observable å°†ç«‹å³ç»ˆæ­¢ã€‚ eg: func takeUntil() { let takeUntilObservable = Observable.create { (observer) -> Disposable in delayTime(3, block: { print(\"takeUntilObservable => onNext(0)\") observer.onNext(0) }) return Disposables.create() } getFirstObservable() .takeUntil(takeUntilObservable) .debug(\"takeUntil\") .subscribe() .disposed(by: disposeBag) } è¾“å‡ºå¦‚ä¸‹ï¼š 2017-12-27 12:36:41.994: takeUntil -> subscribed 2017-12-27 12:36:42.996: takeUntil -> Event next(First -> 1|A) 2017-12-27 12:36:42.996: takeUntil -> Event next(First -> 1|B) 2017-12-27 12:36:42.996: takeUntil -> Event next(First -> 1|C) takeUntilObservable => onNext(0) 2017-12-27 12:36:44.995: takeUntil -> Event completed 2017-12-27 12:36:44.995: takeUntil -> isDisposed single é™åˆ¶ Observable åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œå¦å‡ºå‘å‡ºä¸€ä¸ª error äº‹ä»¶ï¼Œsingle æ“ä½œç¬¦å°†é™åˆ¶ Observable åªäº§ç”Ÿä¸€ä¸ªå…ƒç´ ã€‚ å¦‚æœ Observable åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œå®ƒå°†é•œåƒè¿™ä¸ª Observable ã€‚ å¦‚æœ Observable æ²¡æœ‰å…ƒç´ æˆ–è€…å…ƒç´ æ•°é‡å¤§äºä¸€ï¼Œå®ƒå°†äº§ç”Ÿä¸€ä¸ª error äº‹ä»¶ã€‚ eg: func single() { Observable .just(1) .single() .subscribe({ e in print(\"single 1 => \\(e.debugDescription)\") }) .disposed(by: disposeBag) Observable .of(1, 2, 3, 4, 5) .single() .subscribe({ (e) in print(\"single 2 => \\(e.debugDescription)\") }) .disposed(by: disposeBag) } è¾“å‡ºå¦‚ä¸‹ï¼š single 1 => next(1) single 1 => completed single 2 => next(1) single 2 => error(Sequence contains more than one element.) "},"RxSwiftStudy/Operator/Combining.html":{"url":"RxSwiftStudy/Operator/Combining.html","title":"7.05 è”åˆ Observable","keywords":"","body":"è”åˆ Observable - Combining Operator startWith startWith æ“ä½œç¬¦ä¼šåœ¨ Observable å¤´éƒ¨æ’å…¥ä¸€äº›å…ƒç´ ã€‚ï¼ˆå¦‚æœä½ æƒ³åœ¨å°¾éƒ¨åŠ å…¥ä¸€äº›å…ƒç´ å¯ä»¥ç”¨concatï¼‰ eg: func startWith() { Observable.of(\"ğŸ¶\", \"ğŸ±\", \"ğŸ­\", \"ğŸ¹\") .startWith(\"First\") .startWith(\"Second\") .startWith(\"Third\") .startWith(\"1\", \"2\", \"3\") .debug(\"startWith\") .subscribe() .disposed(by: disposeBag) } è¾“å‡ºå¦‚ä¸‹ï¼š 2017-12-27 12:42:41.259: startWith -> subscribed 2017-12-27 12:42:41.259: startWith -> Event next(1) 2017-12-27 12:42:41.259: startWith -> Event next(2) 2017-12-27 12:42:41.259: startWith -> Event next(3) 2017-12-27 12:42:41.259: startWith -> Event next(Third) 2017-12-27 12:42:41.259: startWith -> Event next(Second) 2017-12-27 12:42:41.259: startWith -> Event next(First) 2017-12-27 12:42:41.259: startWith -> Event next(ğŸ¶) 2017-12-27 12:42:41.259: startWith -> Event next(ğŸ±) 2017-12-27 12:42:41.259: startWith -> Event next(ğŸ­) 2017-12-27 12:42:41.259: startWith -> Event next(ğŸ¹) 2017-12-27 12:42:41.260: startWith -> Event completed 2017-12-27 12:42:41.260: startWith -> isDisposed combineLatest combineLatest æ“ä½œç¬¦å°†å¤šä¸ª Observables ä¸­æœ€æ–°çš„å…ƒç´ é€šè¿‡ä¸€ä¸ªå‡½æ•°ç»„åˆèµ·æ¥ï¼Œç„¶åå°†è¿™ä¸ªç»„åˆçš„ç»“æœå‘å‡ºæ¥ã€‚ è¿™äº›æº Observables ä¸­ä»»ä½•ä¸€ä¸ªå‘å‡ºä¸€ä¸ªå…ƒç´ ï¼Œä»–éƒ½ä¼šå‘å‡ºä¸€ä¸ªå…ƒç´ ï¼ˆå‰ææ˜¯ï¼Œè¿™äº› Observables æ›¾ç»å‘å‡ºè¿‡å…ƒç´ ï¼‰ã€‚ eg: func combineLatest() { Observable .combineLatest(getFirstObservable(), getSecondObservable(), resultSelector: { (fstr, sstr) -> String in return fstr + \" | \" + sstr }) .debug(\"combineLatest\") .subscribe() .disposed(by: disposeBag) } è¾“å‡ºå¦‚ä¸‹ 2017-12-27 12:45:26.780: combineLatest -> subscribed 2017-12-27 12:45:27.782: combineLatest -> Event next(First -> 1|A | Second -> 1) 2017-12-27 12:45:27.782: combineLatest -> Event next(First -> 1|B | Second -> 1) 2017-12-27 12:45:27.782: combineLatest -> Event next(First -> 1|C | Second -> 1) 2017-12-27 12:45:30.886: combineLatest -> Event next(First -> 1|C | Second -> 2) 2017-12-27 12:45:31.781: combineLatest -> Event next(First -> 2|A | Second -> 2) 2017-12-27 12:45:31.782: combineLatest -> Event next(First -> 2|B | Second -> 2) 2017-12-27 12:45:31.782: combineLatest -> Event next(First -> 2|C | Second -> 2) 2017-12-27 12:45:34.886: combineLatest -> Event next(First -> 2|C | Second -> 3) 2017-12-27 12:45:35.781: combineLatest -> Event next(First -> 3|A | Second -> 3) 2017-12-27 12:45:35.781: combineLatest -> Event next(First -> 3|B | Second -> 3) 2017-12-27 12:45:35.781: combineLatest -> Event next(First -> 3|C | Second -> 3) 2017-12-27 12:45:35.781: combineLatest -> Event completed 2017-12-27 12:45:35.782: combineLatest -> isDisposed zip é€šè¿‡ä¸€ä¸ªå‡½æ•°å°†å¤šä¸ª Observables çš„å…ƒç´ ç»„åˆèµ·æ¥ï¼Œç„¶åå°†æ¯ä¸€ä¸ªç»„åˆçš„ç»“æœå‘å‡ºæ¥ã€‚ zip æ“ä½œç¬¦å°†å¤šä¸ª(æœ€å¤šä¸è¶…è¿‡8ä¸ª) Observables çš„å…ƒç´ é€šè¿‡ä¸€ä¸ªå‡½æ•°ç»„åˆèµ·æ¥ï¼Œç„¶åå°†è¿™ä¸ªç»„åˆçš„ç»“æœå‘å‡ºæ¥ã€‚å®ƒä¼šä¸¥æ ¼çš„æŒ‰ç…§åºåˆ—çš„ç´¢å¼•æ•°è¿›è¡Œç»„åˆã€‚ ä¾‹å¦‚ï¼Œè¿”å›çš„ Observable çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œæ˜¯ç”±æ¯ä¸€ä¸ªæº Observables çš„ç¬¬ä¸€ä¸ªå…ƒç´ ç»„åˆå‡ºæ¥çš„ã€‚å®ƒçš„ç¬¬äºŒä¸ªå…ƒç´  ï¼Œæ˜¯ç”±æ¯ä¸€ä¸ªæº Observables çš„ç¬¬äºŒä¸ªå…ƒç´ ç»„åˆå‡ºæ¥çš„ã€‚å®ƒçš„ç¬¬ä¸‰ä¸ªå…ƒç´  ï¼Œæ˜¯ç”±æ¯ä¸€ä¸ªæº Observables çš„ç¬¬ä¸‰ä¸ªå…ƒç´ ç»„åˆå‡ºæ¥çš„ï¼Œä»¥æ­¤ç±»æ¨ã€‚ å®ƒçš„å…ƒç´ æ•°é‡ç­‰äºæº Observables ä¸­å…ƒç´ æ•°é‡æœ€å°‘çš„é‚£ä¸ªã€‚ eg: func zip() { let disposeBag = DisposeBag() let first = PublishSubject() let second = PublishSubject() Observable .zip(first, second) { $0 + $1 } .subscribe(onNext: { print($0) }) .disposed(by: disposeBag) first.onNext(\"1\") second.onNext(\"A\") first.onNext(\"2\") second.onNext(\"B\") second.onNext(\"C\") second.onNext(\"D\") first.onNext(\"3\") first.onNext(\"4\") first.onNext(\"5\") } è¾“å‡ºå¦‚ä¸‹ï¼š 1A 2B 3C 4D withLatestFrom å°†ä¸¤ Observables æœ€æ–°çš„å…ƒç´ é€šè¿‡ä¸€ä¸ªå‡½æ•°ç»„åˆä»¥æ¥ï¼Œå½“ç¬¬ä¸€ä¸ª Observable å‘å‡ºä¸€ä¸ªå…ƒç´ ï¼Œå°±å°†ç»„åˆåçš„å…ƒç´ å‘é€å‡ºæ¥ withLatestFrom æ“ä½œç¬¦å°†ä¸¤ä¸ª Observables ä¸­æœ€æ–°çš„å…ƒç´ é€šè¿‡ä¸€ä¸ªå‡½æ•°ç»„åˆèµ·æ¥ï¼Œç„¶åå°†è¿™ä¸ªç»„åˆçš„ç»“æœå‘å‡ºæ¥ã€‚ å½“ç¬¬ä¸€ä¸ª Observable å‘å‡ºä¸€ä¸ªå…ƒç´ æ—¶ï¼Œå°±ç«‹å³å–å‡ºç¬¬äºŒä¸ª Observable ä¸­æœ€æ–°çš„å…ƒç´ ï¼Œé€šè¿‡ä¸€ä¸ªç»„åˆå‡½æ•°å°†ä¸¤ä¸ªæœ€æ–°çš„å…ƒç´ åˆå¹¶åå‘é€å‡ºå»ã€‚ eg: func withLatestFrom() { // å½“ç¬¬ä¸€ä¸ª Observable å‘å‡ºä¸€ä¸ªå…ƒç´ æ—¶ï¼Œå°±ç«‹å³å–å‡ºç¬¬äºŒä¸ª Observable ä¸­æœ€æ–°çš„å…ƒç´ ï¼Œ // ç„¶åæŠŠç¬¬äºŒä¸ª Observable ä¸­æœ€æ–°çš„å…ƒç´ å‘é€å‡ºå»ã€‚ print(\"============================First============================\") getFirstObservable() .withLatestFrom(getSecondObservable()) .debug(\"withLatestFrom\") .subscribe() .disposed(by: disposeBag) // å½“ç¬¬ä¸€ä¸ª Observable å‘å‡ºä¸€ä¸ªå…ƒç´ æ—¶ï¼Œå°±ç«‹å³å–å‡ºç¬¬äºŒä¸ª Observable ä¸­æœ€æ–°çš„å…ƒç´ ï¼Œ // ç„¶åæŠŠç¬¬ä¸€ä¸ª Observable ä¸­æœ€æ–°çš„å…ƒç´ firstå’Œç„¶åæŠŠç¬¬äºŒä¸ª Observable ä¸­æœ€æ–°çš„å…ƒç´ secondç»„åˆfirst+secondå‘é€å‡ºå»ã€‚ delayTime(10) { print(\"============================Second============================\") self.getFirstObservable() .withLatestFrom(self.getSecondObservable(), resultSelector: { (first, second) -> String in return first + \" \" + second }) .debug(\"withLatestFrom & Function\") .subscribe() .disposed(by: self.disposeBag) } } è¾“å‡ºå¦‚ä¸‹ï¼š ============================First============================ 2017-12-27 12:50:16.250: withLatestFrom -> subscribed 2017-12-27 12:50:17.253: withLatestFrom -> Event next(Second -> 1) 2017-12-27 12:50:17.253: withLatestFrom -> Event next(Second -> 1) 2017-12-27 12:50:17.253: withLatestFrom -> Event next(Second -> 1) 2017-12-27 12:50:21.750: withLatestFrom -> Event next(Second -> 2) 2017-12-27 12:50:21.750: withLatestFrom -> Event next(Second -> 2) 2017-12-27 12:50:21.750: withLatestFrom -> Event next(Second -> 2) 2017-12-27 12:50:26.144: withLatestFrom -> Event next(Second -> 3) 2017-12-27 12:50:26.144: withLatestFrom -> Event next(Second -> 3) 2017-12-27 12:50:26.144: withLatestFrom -> Event next(Second -> 3) 2017-12-27 12:50:26.145: withLatestFrom -> Event completed 2017-12-27 12:50:26.145: withLatestFrom -> isDisposed ============================Second============================ 2017-12-27 12:50:26.253: withLatestFrom & Function -> subscribed 2017-12-27 12:50:27.254: withLatestFrom & Function -> Event next(First -> 1|A Second -> 1) 2017-12-27 12:50:27.255: withLatestFrom & Function -> Event next(First -> 1|B Second -> 1) 2017-12-27 12:50:27.255: withLatestFrom & Function -> Event next(First -> 1|C Second -> 1) 2017-12-27 12:50:31.254: withLatestFrom & Function -> Event next(First -> 2|A Second -> 2) 2017-12-27 12:50:31.254: withLatestFrom & Function -> Event next(First -> 2|B Second -> 2) 2017-12-27 12:50:31.254: withLatestFrom & Function -> Event next(First -> 2|C Second -> 2) 2017-12-27 12:50:35.253: withLatestFrom & Function -> Event next(First -> 3|A Second -> 3) 2017-12-27 12:50:35.253: withLatestFrom & Function -> Event next(First -> 3|B Second -> 3) 2017-12-27 12:50:35.253: withLatestFrom & Function -> Event next(First -> 3|C Second -> 3) 2017-12-27 12:50:35.254: withLatestFrom & Function -> Event completed 2017-12-27 12:50:35.254: withLatestFrom & Function -> isDisposed merge é€šè¿‡ä½¿ç”¨ merge æ“ä½œç¬¦ä½ å¯ä»¥å°†å¤šä¸ª Observables åˆå¹¶æˆä¸€ä¸ªï¼Œå½“æŸä¸€ä¸ª Observable å‘å‡ºä¸€ä¸ªå…ƒç´ æ—¶ï¼Œä»–å°±å°†è¿™ä¸ªå…ƒç´ å‘å‡ºã€‚ å¦‚æœï¼ŒæŸä¸€ä¸ª Observable å‘å‡ºä¸€ä¸ª onError äº‹ä»¶ï¼Œé‚£ä¹ˆè¢«åˆå¹¶çš„ Observable ä¹Ÿä¼šå°†å®ƒå‘å‡ºï¼Œå¹¶ä¸”ç«‹å³ç»ˆæ­¢åºåˆ—ã€‚ eg: func merge() { let subject1 = PublishSubject() let subject2 = PublishSubject() Observable.of(subject1, subject2) .merge() .subscribe(onNext: { print($0) }) .disposed(by: disposeBag) subject1.onNext(\"ğŸ…°ï¸\") subject1.onNext(\"ğŸ…±ï¸\") subject2.onNext(\"1ï¸âƒ£\") subject2.onNext(\"2ï¸âƒ£\") subject1.onNext(\"ğŸ†\") subject2.onNext(\"3ï¸âƒ£\") let err = TError.init(errorCode: 0, errorString: \"Test Error\", errorData: nil) subject1.onError(err) subject2.onNext(\"4ï¸âƒ£\") subject2.onNext(\"5ï¸âƒ£\") } è¾“å‡ºå¦‚ä¸‹ï¼š 2017-12-27 12:56:10.984: merge -> subscribed 2017-12-27 12:56:10.986: merge -> Event next(ğŸ…°ï¸) 2017-12-27 12:56:10.986: merge -> Event next(ğŸ…±ï¸) 2017-12-27 12:56:10.987: merge -> Event next(1ï¸âƒ£) 2017-12-27 12:56:10.987: merge -> Event next(2ï¸âƒ£) 2017-12-27 12:56:10.987: merge -> Event next(ğŸ†) 2017-12-27 12:56:10.987: merge -> Event next(3ï¸âƒ£) 2017-12-27 12:56:10.988: merge -> Event error(TError(errorCode: 0, errorString: \"Test Error\", errorData: nil)) Unhandled error happened: TError(errorCode: 0, errorString: \"Test Error\", errorData: nil) subscription called from: 0 RxSwift 0x0000000109fa158c _T07RxSwift14ObservableTypePAAE9subscribeAA10Disposable_py1EQzcSg6onNext_ys5Error_pcSg0gI0yycSg0G9CompletedAM0G8DisposedtF + 780 1 RxSwiftExample 0x0000000109853023 _T011RxSwiftExample8OperatorC5mergeyyF + 1427 2 RxSwiftExample 0x0000000109853884 _T011RxSwiftExample8OperatorC5mergeyyFTo + 36 3 RxSwiftExample 0x0000000109877de1 _T011RxSwiftExample27OperatorTableViewControllerC11viewDidLoadyyFy10Foundation9IndexPathVcfU1_ + 897 4 RxSwiftExample 0x0000000109877f17 _T011RxSwiftExample27OperatorTableViewControllerC11viewDidLoadyyFy10Foundation9IndexPathVcfU1_TA + 103 5 RxSwiftExample 0x0000000109838da0 _T010Foundation9IndexPathVIxx_ACIxi_TR + 48 6 RxSwiftExample 0x0000000109877fa2 _T010Foundation9IndexPathVIxx_ACIxi_TRTA + 66 7 RxSwift 0x0000000109fa1d35 _T07RxSwift14ObservableTypePAAE9subscribeAA10Disposable_py1EQzcSg6onNext_ys5Error_pcSg0gI0yycSg0G9CompletedAM0G8DisposedtFyAA5EventOyAGGcfU_ + 885 8 RxSwift 0x0000000109fa228a _T07RxSwift14ObservableTypePAAE9subscribeAA10Disposable_py1EQzcSg6onNext_ys5Error_pcSg0gI0yycSg0G9CompletedAM0G8DisposedtFyAA5EventOyAGGcfU_TA + 282 9 RxSwift 0x0000000109ed7998 _T07RxSwift17AnonymousObserverC6onCoreyAA5EventOyxGF + 408 10 RxSwift 0x0000000109fa9026 _T07RxSwift12ObserverBaseC2onyAA5EventOyxGF + 742 11 RxSwift 0x0000000109fa95be _T07RxSwift12ObserverBaseCyxGAA0C4TypeAAlAaEP2onyAA5EventOy1EQzGFTW + 62 12 RxSwift 0x0000000109ed8c93 _T0TA + 115 13 RxSwift 0x0000000109ee33a7 _T07RxSwift5EventOyxGIxi_ADytIxir_1EQyd__RszAA12ObserverTypeRd__r__lTR + 23 14 RxSwift 0x0000000109ff5bc6 _T07RxSwift5EventOyxGIxi_ADytIxir_1EQyd__RszAA12ObserverTypeRd__r__lTRTA.47 + 118 15 RxSwift 0x0000000109ee3770 _T07RxSwift5EventOyxGytIxir_ADIxi_lTR + 16 16 RxSwift 0x0000000109ee5332 _T07RxSwift5EventOyxGytIxir_ADIxi_lTRTA.18 + 82 17 RxSwift 0x0000000109ee4564 _T07RxSwift8dispatchyAA3BagVyyAA5EventOyxGcG_AGtlF + 900 18 RxSwift 0x0000000109fef92e _T07RxSwift36ShareReplay1WhileConnectedConnection33_E9FE621655D67A613BF2FC2D9B3041FCLLC2onyAA5EventOyxGF + 1230 19 RxSwift 0x0000000109ff1aeb _T07RxSwift36ShareReplay1WhileConnectedConnection33_E9FE621655D67A613BF2FC2D9B3041FCLLCyxGAA12ObserverTypeAAlAaFP2onyAA5EventOy1EQzGFTW + 43 20 RxSwift 0x0000000109ffdbcc _T07RxSwift4SinkC9forwardOnyAA5EventOy1EQzGF + 780 21 RxSwift 0x0000000109ef5ff7 _T07RxSwift9CatchSink33_7E15DB08AB19A7B882D5C92A393C6F6DLLC2onyAA5EventOy1EQzGF + 823 22 RxSwift 0x0000000109ef6a5b _T07RxSwift9CatchSink33_7E15DB08AB19A7B882D5C92A393C6F6DLLCyxGAA12ObserverTypeA2aFRzlAaFP2onyAA5EventOy1EQzGFTW + 43 23 RxSwift 0x0000000109fa6f11 _T07RxSwift32ObserveOnSerialDispatchQueueSink33_277A93ABA8477198C125F3F26B2D4B62LLCADyxGAA0efG9SchedulerC9scheduler_x8observerAA10Cancelable_p6canceltcfcAA10Disposable_pAE4sink_AA5EventOy1EQzG5eventtcfU_ + 833 24 RxSwift 0x0000000109fa8579 _T07RxSwift32ObserveOnSerialDispatchQueueSink33_277A93ABA8477198C125F3F26B2D4B62LLCADyxGAA0efG9SchedulerC9scheduler_x8observerAA10Cancelable_p6canceltcfcAA10Disposable_pAE4sink_AA5EventOy1EQzG5eventtcfU_TA + 9 25 RxSwift 0x0000000109fa77d9 _T07RxSwift32ObserveOnSerialDispatchQueueSink33_277A93ABA8477198C125F3F26B2D4B62LLCyxGAA5EventOy1EQzGAA10Disposable_pIxxir_AE_AJtAaK_pIxir_AA12ObserverTypeRzlTR + 137 26 RxSwift 0x0000000109fa8786 _T07RxSwift32ObserveOnSerialDispatchQueueSink33_277A93ABA8477198C125F3F26B2D4B62LLCyxGAA5EventOy1EQzGAA10Disposable_pIxxir_AE_AJtAaK_pIxir_AA12ObserverTypeRzlTRTA + 102 27 RxSwift 0x0000000109f80564 _T07RxSwift13MainSchedulerC16scheduleInternalAA10Disposable_px_AaE_pxc6actiontlF + 484 28 RxSwift 0x0000000109feca4d _T07RxSwift28SerialDispatchQueueSchedulerC8scheduleAA10Disposable_px_AaE_pxc6actiontlF + 173 29 RxSwift 0x0000000109fa76cc _T07RxSwift32ObserveOnSerialDispatchQueueSink33_277A93ABA8477198C125F3F26B2D4B62LLC6onCoreyAA5EventOy1EQzGF + 1148 30 RxSwift 0x0000000109fa9026 _T07RxSwift12ObserverBaseC2onyAA5EventOyxGF + 742 31 RxSwift 0x0000000109fa95be _T07RxSwift12ObserverBaseCyxGAA0C4TypeAAlAaEP2onyAA5EventOy1EQzGFTW + 62 32 RxSwift 0x0000000109ffdbcc _T07RxSwift4SinkC9forwardOnyAA5EventOy1EQzGF + 780 33 RxSwift 0x000000010a0080e0 _T07RxSwift15SubscribeOnSink33_B44C3DD7F62EF81799E6347E59A266A2LLC2onyAA5EventOy1EQzGF + 400 34 RxSwift 0x000000010a008e0b _T07RxSwift15SubscribeOnSink33_B44C3DD7F62EF81799E6347E59A266A2LLCyxq_GAA12ObserverTypeA2A010ObservableP0RzAaFR_1EQy_AHRtzr0_lAaFP2onyAA5EventOyAHQzGFTW + 43 35 RxSwift 0x0000000109ffdbcc _T07RxSwift4SinkC9forwardOnyAA5EventOy1EQzGF + 780 36 RxSwift 0x0000000109f81695 _T07RxSwift7MapSink33_5428EFA9A9B0C0340021B871D2E5AC01LLC2onyAA5EventOyxGF + 1093 37 RxSwift 0x0000000109f81beb _T07RxSwift7MapSink33_5428EFA9A9B0C0340021B871D2E5AC01LLCyxq_GAA12ObserverTypeA2aFR_r0_lAaFP2onyAA5EventOy1EQzGFTW + 43 38 RxSwift 0x0000000109ffdbcc _T07RxSwift4SinkC9forwardOnyAA5EventOy1EQzGF + 780 39 RxSwift 0x000000010a0080e0 _T07RxSwift15SubscribeOnSink33_B44C3DD7F62EF81799E6347E59A266A2LLC2onyAA5EventOy1EQzGF + 400 40 RxSwift 0x000000010a008e0b _T07RxSwift15SubscribeOnSink33_B44C3DD7F62EF81799E6347E59A266A2LLCyxq_GAA12ObserverTypeA2A010ObservableP0RzAaFR_1EQy_AHRtzr0_lAaFP2onyAA5EventOyAHQzGFTW + 43 41 RxSwift 0x0000000109ed8c93 _T0TA + 115 42 RxSwift 0x0000000109ee33a7 _T07RxSwift5EventOyxGIxi_ADytIxir_1EQyd__RszAA12ObserverTypeRd__r__lTR + 23 43 RxSwift 0x0000000109ff5a36 _T07RxSwift5EventOyxGIxi_ADytIxir_1EQyd__RszAA12ObserverTypeRd__r__lTRTA + 118 44 RxSwift 0x0000000109ee3770 _T07RxSwift5EventOyxGytIxir_ADIxi_lTR + 16 45 RxSwift 0x0000000109ee5332 _T07RxSwift5EventOyxGytIxir_ADIxi_lTRTA.18 + 82 46 RxSwift 0x0000000109ee4564 _T07RxSwift8dispatchyAA3BagVyyAA5EventOyxGcG_AGtlF + 900 47 RxSwift 0x0000000109ff2eee _T07RxSwift29ShareWhileConnectedConnection33_E9FE621655D67A613BF2FC2D9B3041FCLLC2onyAA5EventOyxGF + 1230 48 RxSwift 0x0000000109ff4abb _T07RxSwift29ShareWhileConnectedConnection33_E9FE621655D67A613BF2FC2D9B3041FCLLCyxGAA12ObserverTypeAAlAaFP2onyAA5EventOy1EQzGFTW + 43 49 RxSwift 0x0000000109ffdbcc _T07RxSwift4SinkC9forwardOnyAA5EventOy1EQzGF + 780 50 RxSwift 0x0000000109f66dfb _T07RxSwift6DoSink33_51F9E615740E91B2E920965FFBB1EED3LLC2onyAA5EventOy1EQzGF + 843 51 RxSwift 0x0000000109f674eb _T07RxSwift6DoSink33_51F9E615740E91B2E920965FFBB1EED3LLCyxGAA12ObserverTypeA2aFRzlAaFP2onyAA5EventOy1EQzGFTW + 43 52 RxSwift 0x0000000109ed8c93 _T0TA + 115 53 RxSwift 0x0000000109ee33a7 _T07RxSwift5EventOyxGIxi_ADytIxir_1EQyd__RszAA12ObserverTypeRd__r__lTR + 23 54 RxSwift 0x0000000109fbd396 _T07RxSwift5EventOyxGIxi_ADytIxir_1EQyd__RszAA12ObserverTypeRd__r__lTRTA + 118 55 RxSwift 0x0000000109ee3770 _T07RxSwift5EventOyxGytIxir_ADIxi_lTR + 16 56 RxSwift 0x0000000109ee5332 _T07RxSwift5EventOyxGytIxir_ADIxi_lTRTA.18 + 82 57 RxSwift 0x0000000109ee4564 _T07RxSwift8dispatchyAA3BagVyyAA5EventOyxGcG_AGtlF + 900 58 RxSwift 0x0000000109fbb1ca _T07RxSwift14PublishSubjectC2onyAA5EventOyxGF + 1018 59 RxCocoa 0x0000000109c6cd91 _T07RxSwift14PublishSubjectC2onyAA5EventOyxGFTA + 17 60 RxCocoa 0x0000000109c6c46d _T07RxSwift5EventOySayypGGIxi_AEIxx_TR + 29 61 RxCocoa 0x0000000109c6cd6e _T07RxSwift5EventOySayypGGIxi_AEIxx_TRTA + 78 62 RxCocoa 0x0000000109c6a5eb _T07RxCocoa13DelegateProxyC14_methodInvokedy10ObjectiveC8SelectorV_SayypG13withArgumentstF + 283 63 RxCocoa 0x0000000109c6a664 _T07RxCocoa13DelegateProxyC14_methodInvokedy10ObjectiveC8SelectorV_SayypG13withArgumentstFTo + 84 64 RxCocoa 0x0000000109c3b588 -[_RXDelegateProxy forwardInvocation:] + 536 65 CoreFoundation 0x000000010dee1cd8 ___forwarding___ + 760 66 CoreFoundation 0x000000010dee1958 _CF_forwarding_prep_0 + 120 67 UIKit 0x000000010b309839 -[UITableView _selectRowAtIndexPath:animated:scrollPosition:notifyDelegate:] + 1810 68 UIKit 0x000000010b309a54 -[UITableView _userSelectRowAtPendingSelectionIndexPath:] + 344 69 UIKit 0x000000010b1d2d59 _runAfterCACommitDeferredBlocks + 318 70 UIKit 0x000000010b1c1bb1 _cleanUpAfterCAFlushAndRunDeferredBlocks + 280 71 UIKit 0x000000010b1f10e0 _afterCACommitHandler + 137 72 CoreFoundation 0x000000010df01c07 __CFRUNLOOP_IS_CALLING_OUT_TO_AN_OBSERVER_CALLBACK_FUNCTION__ + 23 73 CoreFoundation 0x000000010df01b5e __CFRunLoopDoObservers + 430 74 CoreFoundation 0x000000010dee6124 __CFRunLoopRun + 1572 75 CoreFoundation 0x000000010dee5889 CFRunLoopRunSpecific + 409 76 GraphicsServices 0x00000001136149c6 GSEventRunModal + 62 77 UIKit 0x000000010b1c75d6 UIApplicationMain + 159 78 RxSwiftExample 0x0000000109858c07 main + 55 79 libdyld.dylib 0x000000010f7bcd81 start + 1 80 ??? 0x0000000000000001 0x0 + 1 2017-12-27 12:56:10.991: merge -> isDisposed switchLatest å½“ä½ çš„äº‹ä»¶åºåˆ—æ˜¯ä¸€ä¸ªäº‹ä»¶åºåˆ—çš„åºåˆ— (Observable>) çš„æ—¶å€™ï¼Œï¼ˆå¯ä»¥ç†è§£æˆäºŒç»´åºåˆ—ï¼‰ å¯ä»¥ä½¿ç”¨ switch å°†åºåˆ—çš„åºåˆ—å¹³é“ºæˆä¸€ç»´ï¼Œå¹¶ä¸”åœ¨å‡ºç°æ–°çš„åºåˆ—çš„æ—¶å€™ï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ°æœ€æ–°çš„é‚£ä¸ªåºåˆ—ä¸Šã€‚ å’Œ merge ç›¸ä¼¼çš„æ˜¯ï¼Œå®ƒä¹Ÿæ˜¯èµ·åˆ°äº†å°†å¤šä¸ªåºåˆ—æ‹å¹³æˆä¸€æ¡åºåˆ—çš„ä½œç”¨ã€‚ âš ï¸æ³¨æ„ï¼šå½“æº Observable å‘å‡ºä¸€ä¸ªæ–°çš„ Observable æ—¶ï¼Œè€Œä¸æ˜¯å½“æ–°çš„ Observable å‘å‡ºä¸€ä¸ªé¡¹ç›®æ—¶ï¼Œå®ƒå°†ä»ä¹‹å‰å‘å‡ºçš„Observableä¸­å–æ¶ˆè®¢é˜…ã€‚ è¿™æ„å‘³ç€åœ¨åé¢çš„ Observable è¢«å‘å°„çš„æ—¶é—´å’Œéšåçš„ Observable æœ¬èº«å¼€å§‹å‘å°„çš„æ—¶é—´ä¹‹é—´ï¼Œå‰ä¸€ä¸ª Observable å‘å°„çš„ç‰©ä½“å°†è¢«ä¸¢å¼ƒã€‚ eg: func switchLatest() { // ç¬¬ä¸€ä¸ªï¼š å‘é€3ä¸ªå…ƒç´  let innerObservable_1 = Observable.of(\"innerObservable_1: 1\", \"innerObservable_1: 2\", \"innerObservable_1: 3\") // æŒç»­1ç§’å‘å‡ºä¸€ä¸ªå…ƒç´ ï¼Œé€’å¢ let innerObservable_2 = Observable.interval(1, scheduler: MainScheduler.instance).map { (value) -> String in print(\"innerObservable_2 => Send \\(value)\") return \"innerObservable_2: \\(value)\" } // æŒç»­1ç§’å‘å‡ºä¸€ä¸ªå…ƒç´ ï¼Œé€’å¢ let innerObservable_3 = Observable.interval(1, scheduler: MainScheduler.instance).map { (value) -> String in print(\"innerObservable_3 => Send \\(value)\") return \"innerObservable_3: \\(value)\" } let externalObservable = Observable>.create({ (observer) -> Disposable in observer.onNext(innerObservable_1) delayTime(2, block: { observer.onNext(innerObservable_2) }) delayTime(6, block: { observer.onNext(innerObservable_3) }) delayTime(12, block: { // ä¸åŠ  observer.onNext(Observable.never()) çš„è¯ï¼ŒinnerObservable_3ä¼šæŒç»­ä¸æ–­çš„å‘é€ print(\"observer.onNext(Observable.never())\") print(\"observer.onCompleted()\") observer.onNext(Observable.never()) observer.onCompleted() }) return Disposables.create() }) externalObservable .switchLatest() .debug(\"switchLatest\") .subscribe() .disposed(by: disposeBag) } è¾“å‡ºå¦‚ä¸‹ï¼š 2017-12-27 12:59:48.877: switchLatest -> subscribed 2017-12-27 12:59:48.878: switchLatest -> Event next(innerObservable_1: 1) 2017-12-27 12:59:48.878: switchLatest -> Event next(innerObservable_1: 2) 2017-12-27 12:59:48.878: switchLatest -> Event next(innerObservable_1: 3) innerObservable_2 => Send 0 2017-12-27 12:59:51.880: switchLatest -> Event next(innerObservable_2: 0) innerObservable_2 => Send 1 2017-12-27 12:59:52.881: switchLatest -> Event next(innerObservable_2: 1) innerObservable_2 => Send 2 2017-12-27 12:59:53.881: switchLatest -> Event next(innerObservable_2: 2) innerObservable_3 => Send 0 2017-12-27 12:59:55.879: switchLatest -> Event next(innerObservable_3: 0) innerObservable_3 => Send 1 2017-12-27 12:59:56.879: switchLatest -> Event next(innerObservable_3: 1) innerObservable_3 => Send 2 2017-12-27 12:59:57.878: switchLatest -> Event next(innerObservable_3: 2) innerObservable_3 => Send 3 2017-12-27 12:59:58.879: switchLatest -> Event next(innerObservable_3: 3) innerObservable_3 => Send 4 2017-12-27 12:59:59.878: switchLatest -> Event next(innerObservable_3: 4) observer.onNext(Observable.never()) observer.onCompleted() "},"RxSwiftStudy/Operator/ErrorHandling.html":{"url":"RxSwiftStudy/Operator/ErrorHandling.html","title":"7.06 é”™è¯¯å¤„ç†æ“ä½œç¬¦","keywords":"","body":"é”™è¯¯å¤„ç†æ“ä½œç¬¦ - ErrorHandling Operator catchError catchError æ“ä½œç¬¦å°†ä¼šæ‹¦æˆªä¸€ä¸ª error äº‹ä»¶ï¼Œå°†å®ƒæ›¿æ¢æˆå…¶ä»–çš„å…ƒç´ æˆ–è€…ä¸€ç»„å…ƒç´ ï¼Œç„¶åä¼ é€’ç»™è§‚å¯Ÿè€…ã€‚è¿™æ ·å¯ä»¥ä½¿å¾— Observable æ­£å¸¸ç»“æŸï¼Œæˆ–è€…æ ¹æœ¬éƒ½ä¸éœ€è¦ç»“æŸã€‚ eg: func catchError() { let recoverObservable = Observable.just(\"Recover Error\") getErrorObservable() .catchError({ (error) -> Observable in print(\"\\n>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>\") error.printLog() print(\" è¾“å‡ºå¦‚ä¸‹ï¼š 2017-12-27 13:50:58.068: catchError -> subscribed 2017-12-27 13:50:59.070: catchError -> Event next(1ï¸âƒ£) 2017-12-27 13:51:00.070: catchError -> Event next(2ï¸âƒ£) >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 10 Test Event next(Recover Error) 2017-12-27 13:51:01.070: catchError -> Event completed 2017-12-27 13:51:01.070: catchError -> isDisposed catchErrorJustReturn catchErrorJustReturn æ“ä½œç¬¦ä¼šå°† error äº‹ä»¶æ›¿æ¢æˆå…¶ä»–çš„ä¸€ä¸ªå…ƒç´ ï¼Œç„¶åç»“æŸè¯¥åºåˆ—ã€‚ eg: func catchErrorJustReturn() { getErrorObservable() .catchErrorJustReturn(\"Recover Error\") .debug(\"catchErrorJustReturn\") .subscribe() .disposed(by: disposeBag) } è¾“å‡ºå¦‚ä¸‹ï¼š 2017-12-27 13:53:16.850: catchErrorJustReturn -> subscribed 2017-12-27 13:53:17.854: catchErrorJustReturn -> Event next(1ï¸âƒ£) 2017-12-27 13:53:18.852: catchErrorJustReturn -> Event next(2ï¸âƒ£) 2017-12-27 13:53:19.854: catchErrorJustReturn -> Event next(Recover Error) 2017-12-27 13:53:19.854: catchErrorJustReturn -> Event completed 2017-12-27 13:53:19.854: catchErrorJustReturn -> isDisposed retry å¦‚æœæº Observable äº§ç”Ÿä¸€ä¸ªé”™è¯¯äº‹ä»¶ï¼Œé‡æ–°å¯¹å®ƒè¿›è¡Œè®¢é˜…ï¼Œå¸Œæœ›å®ƒä¸ä¼šå†æ¬¡äº§ç”Ÿé”™è¯¯ retry æ“ä½œç¬¦å°†ä¸ä¼šå°† error äº‹ä»¶ï¼Œä¼ é€’ç»™è§‚å¯Ÿè€…ã€‚ ç„¶è€Œï¼Œå®ƒä¼šä»æ–°è®¢é˜…æº Observableï¼Œç»™è¿™ä¸ª Observable ä¸€ä¸ªé‡è¯•çš„æœºä¼šï¼Œè®©å®ƒæœ‰æœºä¼šä¸äº§ç”Ÿ error äº‹ä»¶ã€‚ retry æ€»æ˜¯å¯¹è§‚å¯Ÿè€…å‘å‡º next äº‹ä»¶ï¼Œå³ä¾¿æºåºåˆ—äº§ç”Ÿäº†ä¸€ä¸ª error äº‹ä»¶ï¼Œæ‰€ä»¥è¿™æ ·å¯èƒ½ä¼šäº§ç”Ÿé‡å¤çš„å…ƒç´ ã€‚ func retry() { let observable = Observable.create { (observer) -> Disposable in if arc4random() % 10 == 0 { observer.onNext(1) } else { let error = TError.init(errorCode: 10, errorString: \"Random Error\", errorData: nil) observer.onError(error) } return Disposables.create() } observable .debug(\"Befor Retry\") .retry() .debug(\"After Retry\") .subscribe() .disposed(by: disposeBag) } è¾“å‡ºå¦‚ä¸‹ï¼š 2017-12-27 13:56:42.068: After Retry -> subscribed 2017-12-27 13:56:42.068: Befor Retry -> subscribed 2017-12-27 13:56:42.068: Befor Retry -> Event error(TError(errorCode: 10, errorString: \"Random Error\", errorData: nil)) 2017-12-27 13:56:42.068: Befor Retry -> isDisposed 2017-12-27 13:56:42.068: Befor Retry -> subscribed 2017-12-27 13:56:42.068: Befor Retry -> Event error(TError(errorCode: 10, errorString: \"Random Error\", errorData: nil)) 2017-12-27 13:56:42.069: Befor Retry -> isDisposed 2017-12-27 13:56:42.069: Befor Retry -> subscribed 2017-12-27 13:56:42.069: Befor Retry -> Event error(TError(errorCode: 10, errorString: \"Random Error\", errorData: nil)) 2017-12-27 13:56:42.069: Befor Retry -> isDisposed 2017-12-27 13:56:42.069: Befor Retry -> subscribed 2017-12-27 13:56:42.069: Befor Retry -> Event error(TError(errorCode: 10, errorString: \"Random Error\", errorData: nil)) 2017-12-27 13:56:42.069: Befor Retry -> isDisposed 2017-12-27 13:56:42.069: Befor Retry -> subscribed 2017-12-27 13:56:42.069: Befor Retry -> Event error(TError(errorCode: 10, errorString: \"Random Error\", errorData: nil)) 2017-12-27 13:56:42.069: Befor Retry -> isDisposed 2017-12-27 13:56:42.069: Befor Retry -> subscribed 2017-12-27 13:56:42.069: Befor Retry -> Event error(TError(errorCode: 10, errorString: \"Random Error\", errorData: nil)) 2017-12-27 13:56:42.069: Befor Retry -> isDisposed 2017-12-27 13:56:42.069: Befor Retry -> subscribed 2017-12-27 13:56:42.070: Befor Retry -> Event next(1) 2017-12-27 13:56:42.070: After Retry -> Event next(1) retryWhen è¿™ä¸ªæ“ä½œç¬¦ä¸»è¦æè¿°åº”è¯¥åœ¨ä½•æ—¶é‡è¯•ï¼Œå¹¶ä¸”é€šè¿‡é—­åŒ…é‡Œé¢è¿”å›çš„ Observable æ¥æ§åˆ¶é‡è¯•çš„æ—¶æœºï¼š é—­åŒ…é‡Œé¢çš„å‚æ•°æ˜¯ Observable ä¹Ÿå°±æ˜¯æ‰€äº§ç”Ÿé”™è¯¯çš„åºåˆ—ï¼Œç„¶åè¿”å›å€¼æ˜¯ä¸€ä¸ª Observableã€‚ å½“è¿™ä¸ªè¿”å›çš„ Observable å‘å‡ºä¸€ä¸ªå…ƒç´ æ—¶ï¼Œå°±è¿›è¡Œé‡è¯•æ“ä½œã€‚ å½“å®ƒå‘å‡ºä¸€ä¸ª error æˆ–è€… completed äº‹ä»¶æ—¶ï¼Œå°±ä¸ä¼šé‡è¯•ï¼Œå¹¶ä¸”å°†è¿™ä¸ªäº‹ä»¶ä¼ é€’ç»™åˆ°åé¢çš„è§‚å¯Ÿè€…ã€‚ func retryWhen() { let observable = Observable.create { (observer) -> Disposable in if arc4random() % 10 == 0 { observer.onNext(1) } else { let error = TError.init(errorCode: 10, errorString: \"Random Error\", errorData: nil) observer.onError(error) } return Disposables.create() } let retryDelay: RxTimeInterval = 1.0 let maxRetryCount: Int = 4 observable .debug(\"Befor RetryWhen\") .retryWhen({ (rxError) -> Observable in return rxError.enumerated().flatMap({ (index, element) -> Observable in if index >= maxRetryCount { let err = TError.init(errorCode: 0, errorString: \"Retry Too Many Times\", errorData: nil) return Observable.error(err) } return Observable.timer(retryDelay, scheduler: MainScheduler.instance) }) }) .debug(\"After RetryWhen\") .subscribe() .disposed(by: disposeBag) } è¾“å‡ºå¦‚ä¸‹ï¼š 2017-12-27 13:59:37.270: After RetryWhen -> subscribed 2017-12-27 13:59:37.270: Befor RetryWhen -> subscribed 2017-12-27 13:59:37.270: Befor RetryWhen -> Event error(TError(errorCode: 10, errorString: \"Random Error\", errorData: nil)) 2017-12-27 13:59:37.271: Befor RetryWhen -> isDisposed 2017-12-27 13:59:38.271: Befor RetryWhen -> subscribed 2017-12-27 13:59:38.272: Befor RetryWhen -> Event error(TError(errorCode: 10, errorString: \"Random Error\", errorData: nil)) 2017-12-27 13:59:38.272: Befor RetryWhen -> isDisposed 2017-12-27 13:59:39.273: Befor RetryWhen -> subscribed 2017-12-27 13:59:39.273: Befor RetryWhen -> Event next(1) 2017-12-27 13:59:39.273: After RetryWhen -> Event next(1) "},"RxSwiftStudy/Operator/Conditional_and_Boolean.html":{"url":"RxSwiftStudy/Operator/Conditional_and_Boolean.html","title":"7.07 æ¡ä»¶å’Œ Bool æ“ä½œç¬¦","keywords":"","body":"æ¡ä»¶å’Œ Bool æ“ä½œç¬¦ - Conditional and Boolean Operator amb å½“ä½ ä¼ å…¥å¤šä¸ª Observables åˆ° amb æ“ä½œç¬¦æ—¶ å®ƒå°†å–å…¶ä¸­ä¸€ä¸ª Observableï¼šç¬¬ä¸€ä¸ªäº§ç”Ÿäº‹ä»¶çš„é‚£ä¸ª Observableï¼Œå¯ä»¥æ˜¯ä¸€ä¸ª nextï¼Œerror æˆ–è€… completed äº‹ä»¶ã€‚amb å°†å¿½ç•¥æ‰å…¶ä»–çš„ Observablesã€‚ eg: func amb() { let first = getFirstObservable() let second = getSecondObservable() let third = getThirdObservable() first .amb(second) .amb(third) .debug() .subscribe() .disposed(by: disposeBag) } è¾“å‡ºå¦‚ä¸‹ï¼š 2017-12-27 14:25:27.276: amb -> subscribed 2017-12-27 14:25:27.388: amb -> Event next(Second -> 1) 2017-12-27 14:25:31.390: amb -> Event next(Second -> 2) 2017-12-27 14:25:35.388: amb -> Event next(Second -> 3) 2017-12-27 14:25:35.388: amb -> Event completed 2017-12-27 14:25:35.388: amb -> isDisposed skipWhile è·³è¿‡ Observable ä¸­å¤´å‡ ä¸ªå…ƒç´ ï¼Œç›´åˆ°å…ƒç´ çš„åˆ¤å®šä¸ºå¦ï¼Œé—­åŒ…è¿”å› true åˆ™è·³è¿‡(skip)ï¼ŒskipWhile æ“ä½œç¬¦å¯ä»¥è®©ä½ å¿½ç•¥æº Observable ä¸­ å¤´å‡ ä¸ª å…ƒç´ ï¼Œç›´åˆ°å…ƒç´ çš„åˆ¤å®šä¸º false åï¼Œå®ƒæ‰é•œåƒæº Observableï¼Œä¸€æ—¦æœ‰ false äº§ç”Ÿï¼Œåé¢çš„å…ƒç´ ä¸ä¼šå†è¿›è¡Œåˆ¤æ–­ã€‚ eg: func skipWhile() { Observable .of(0, 0, 0, 0, 1, 2, 3, 4, 5, -1, 0, 0, 10) .skipWhile({ (value) -> Bool in return value == 0 }) .debug(\"skipWhile\") .subscribe() .disposed(by: disposeBag) } è¾“å‡ºå¦‚ä¸‹ï¼š 2017-12-27 11:35:43.512: skipWhile -> subscribed 2017-12-27 11:35:43.512: skipWhile -> Event next(1) 2017-12-27 11:35:43.512: skipWhile -> Event next(2) 2017-12-27 11:35:43.513: skipWhile -> Event next(3) 2017-12-27 11:35:43.513: skipWhile -> Event next(4) 2017-12-27 11:35:43.513: skipWhile -> Event next(5) 2017-12-27 11:35:43.513: skipWhile -> Event next(-1) 2017-12-27 11:35:43.513: skipWhile -> Event next(0) 2017-12-27 11:35:43.513: skipWhile -> Event next(0) 2017-12-27 11:35:43.513: skipWhile -> Event next(10) 2017-12-27 11:35:43.513: skipWhile -> Event completed 2017-12-27 11:35:43.513: skipWhile -> isDisposed skipUntil è·³è¿‡ Observable ä¸­å¤´å‡ ä¸ªå…ƒç´ ï¼Œç›´åˆ°å¦ä¸€ä¸ª Observable å‘å‡ºä¸€ä¸ªå…ƒç´ ï¼ŒskipUntil æ“ä½œç¬¦å¯ä»¥è®©ä½ å¿½ç•¥æº Observable ä¸­å¤´å‡ ä¸ªå…ƒç´ ï¼Œç›´åˆ°å¦ä¸€ä¸ª Observable å‘å‡ºä¸€ä¸ªå…ƒç´ åï¼Œå®ƒæ‰é•œåƒæº Observableã€‚ eg: func skipUntil() { let skipUntilObservable = Observable.create { (observer) -> Disposable in delayTime(3, block: { print(\"skipUntilObservable => onNext(0)\") observer.onNext(0) }) return Disposables.create() } getFirstObservable() .skipUntil(skipUntilObservable) .debug(\"skipUntil\") .subscribe() .disposed(by: disposeBag) } è¾“å‡ºå¦‚ä¸‹ï¼š 2017-12-27 12:25:42.199: skipUntil -> subscribed skipUntilObservable => onNext(0) 2017-12-27 12:25:47.199: skipUntil -> Event next(First -> 2|A) 2017-12-27 12:25:47.200: skipUntil -> Event next(First -> 2|B) 2017-12-27 12:25:47.200: skipUntil -> Event next(First -> 2|C) 2017-12-27 12:25:51.201: skipUntil -> Event next(First -> 3|A) 2017-12-27 12:25:51.201: skipUntil -> Event next(First -> 3|B) 2017-12-27 12:25:51.201: skipUntil -> Event next(First -> 3|C) 2017-12-27 12:25:51.201: skipUntil -> Event completed 2017-12-27 12:25:51.201: skipUntil -> isDisposed takeWhile é•œåƒä¸€ä¸ª Observable ç›´åˆ°æŸä¸ªå…ƒç´ çš„åˆ¤å®šä¸º false é—­åŒ…è¿”å› true åˆ™æ”¾è¡Œï¼Œè¿”å› false åˆ™ç»“æŸ takeWhile æ“ä½œç¬¦å°†é•œåƒæº Observable ç›´åˆ°æŸä¸ªå…ƒç´ çš„åˆ¤å®šä¸º falseã€‚æ­¤æ—¶ï¼Œè¿™ä¸ªé•œåƒçš„ Observable å°†ç«‹å³ç»ˆæ­¢ã€‚ eg: func takeWhile() { Observable .of(0, 0, 0, 0, 1, 2, 3, 4, 5, -1, 0, 0, 10) .takeWhile({ (value) -> Bool in return value >= 0 }) .debug(\"takeWhile\") .subscribe() .disposed(by: disposeBag) } è¾“å‡ºå¦‚ä¸‹ï¼š 2017-12-27 12:32:42.491: takeWhile -> subscribed 2017-12-27 12:32:42.492: takeWhile -> Event next(0) 2017-12-27 12:32:42.492: takeWhile -> Event next(0) 2017-12-27 12:32:42.492: takeWhile -> Event next(0) 2017-12-27 12:32:42.492: takeWhile -> Event next(0) 2017-12-27 12:32:42.492: takeWhile -> Event next(1) 2017-12-27 12:32:42.492: takeWhile -> Event next(2) 2017-12-27 12:32:42.492: takeWhile -> Event next(3) 2017-12-27 12:32:42.492: takeWhile -> Event next(4) 2017-12-27 12:32:42.492: takeWhile -> Event next(5) 2017-12-27 12:32:42.492: takeWhile -> Event completed 2017-12-27 12:32:42.492: takeWhile -> isDisposed takeUntil å¿½ç•¥ä¸€éƒ¨åˆ†å…ƒç´ ï¼Œè¿™äº›å…ƒç´ æ˜¯åœ¨ç¬¬äºŒä¸ª Observable äº§ç”Ÿäº‹ä»¶åå‘å‡ºçš„(åˆ™è¢«å¿½ç•¥)ã€‚ takeUntil æ“ä½œç¬¦å°†é•œåƒæº Observableï¼Œå®ƒåŒæ—¶è§‚æµ‹ç¬¬äºŒä¸ª Observableã€‚ä¸€æ—¦ç¬¬äºŒä¸ª Observable å‘å‡ºä¸€ä¸ªå…ƒç´ æˆ–è€…äº§ç”Ÿä¸€ä¸ªç»ˆæ­¢äº‹ä»¶ï¼Œé‚£ä¸ªé•œåƒçš„ Observable å°†ç«‹å³ç»ˆæ­¢ã€‚ eg: func takeUntil() { let takeUntilObservable = Observable.create { (observer) -> Disposable in delayTime(3, block: { print(\"takeUntilObservable => onNext(0)\") observer.onNext(0) }) return Disposables.create() } getFirstObservable() .takeUntil(takeUntilObservable) .debug(\"takeUntil\") .subscribe() .disposed(by: disposeBag) } è¾“å‡ºå¦‚ä¸‹ï¼š 2017-12-27 12:36:41.994: takeUntil -> subscribed 2017-12-27 12:36:42.996: takeUntil -> Event next(First -> 1|A) 2017-12-27 12:36:42.996: takeUntil -> Event next(First -> 1|B) 2017-12-27 12:36:42.996: takeUntil -> Event next(First -> 1|C) takeUntilObservable => onNext(0) 2017-12-27 12:36:44.995: takeUntil -> Event completed 2017-12-27 12:36:44.995: takeUntil -> isDisposed "},"RxSwiftStudy/Operator/Mathematical_and_Aggregate.html":{"url":"RxSwiftStudy/Operator/Mathematical_and_Aggregate.html","title":"7.08 æ•°å­¦å’Œèšåˆæ“ä½œç¬¦","keywords":"","body":"æ•°å­¦å’Œèšåˆæ“ä½œç¬¦ - Mathematical and Aggregate Operator concat concat æ“ä½œç¬¦å°†å¤šä¸ª Observables æŒ‰é¡ºåºä¸²è”èµ·æ¥ï¼Œå½“å‰ä¸€ä¸ª Observable å…ƒç´ å‘é€å®Œæ¯•åï¼Œåä¸€ä¸ª Observable æ‰å¯ä»¥å¼€å§‹å‘å‡ºå…ƒç´ ã€‚ concat å°†ç­‰å¾…å‰ä¸€ä¸ª Observable äº§ç”Ÿå®Œæˆäº‹ä»¶åï¼Œæ‰å¯¹åä¸€ä¸ª Observable è¿›è¡Œè®¢é˜…ã€‚ å¦‚æœåä¸€ä¸ªæ˜¯çƒ­ Observable ï¼Œåœ¨å®ƒå‰ä¸€ä¸ª Observable äº§ç”Ÿå®Œæˆäº‹ä»¶å‰ï¼Œæ‰€äº§ç”Ÿçš„å…ƒç´ å°†ä¸ä¼šè¢«å‘é€å‡ºæ¥ã€‚ å…³äº çƒ­Observable å’Œ å†·Observable å¯ä»¥å‚è€ƒä¸‹é¢çš„æ–‡æ¡£ å®˜æ–¹æ–‡æ¡£ Hot Observableå’ŒCold Observable eg: func concat() { getFirstObservable() .concat(getSecondObservable()) .concat(getThirdObservable()) .debug(\"concat\") .subscribe() .disposed(by: disposeBag) } è¾“å‡ºå¦‚ä¸‹ï¼š 2017-12-27 14:56:25.556: concat -> subscribed 2017-12-27 14:56:26.558: concat -> Event next(First -> 1|A) 2017-12-27 14:56:26.558: concat -> Event next(First -> 1|B) 2017-12-27 14:56:26.558: concat -> Event next(First -> 1|C) 2017-12-27 14:56:30.558: concat -> Event next(First -> 2|A) 2017-12-27 14:56:30.558: concat -> Event next(First -> 2|B) 2017-12-27 14:56:30.558: concat -> Event next(First -> 2|C) 2017-12-27 14:56:34.558: concat -> Event next(First -> 3|A) 2017-12-27 14:56:34.558: concat -> Event next(First -> 3|B) 2017-12-27 14:56:34.558: concat -> Event next(First -> 3|C) 2017-12-27 14:56:34.659: concat -> Event next(Second -> 1) 2017-12-27 14:56:38.660: concat -> Event next(Second -> 2) 2017-12-27 14:56:42.659: concat -> Event next(Second -> 3) 2017-12-27 14:56:42.764: concat -> Event next(Third -> 1) 2017-12-27 14:56:42.764: concat -> Event next(Third -> 2) 2017-12-27 14:56:42.764: concat -> Event next(Third -> 3) 2017-12-27 14:56:42.764: concat -> Event completed 2017-12-27 14:56:42.764: concat -> isDisposed reduce æŒç»­çš„å°† Observable çš„æ¯ä¸€ä¸ªå…ƒç´ åº”ç”¨ä¸€ä¸ªå‡½æ•°ï¼Œç„¶åå‘å‡ºæœ€ç»ˆç»“æœã€‚ reduce æ“ä½œç¬¦å°†å¯¹ç¬¬ä¸€ä¸ªå…ƒç´ åº”ç”¨ä¸€ä¸ªå‡½æ•°ã€‚ç„¶åï¼Œå°†ç»“æœä½œä¸ºå‚æ•°å¡«å…¥åˆ°ç¬¬äºŒä¸ªå…ƒç´ çš„åº”ç”¨å‡½æ•°ä¸­ã€‚ä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ°éå†å®Œå…¨éƒ¨çš„å…ƒç´ åå‘å‡ºæœ€ç»ˆç»“æœã€‚ è¿™ç§æ“ä½œç¬¦åœ¨å…¶ä»–åœ°æ–¹æœ‰æ—¶å€™è¢«ç§°ä½œæ˜¯ accumulatorï¼Œaggregateï¼Œcompressï¼Œfold æˆ–è€… injectã€‚ ä¸ scan ç±»ä¼¼ï¼Œreduce å‘é€æœ€ç»ˆç»“æœï¼Œscan å‘é€æ¯ä¸ªæ­¥éª¤ eg: func reduce() { let observable = Observable.of(1, 2, 3, 4, 5, 6) // reduce(_ seed:accumulator:) // seed: åŸºæ•°ï¼Œaccumulator: è¿ç®—æ–¹æ³• // // reduce(_ seed:accumulator:mapResult:) // seed: åŸºæ•°ï¼Œaccumulator: è¿ç®—æ–¹æ³•ï¼ŒmapResult: è½¬æ¢è¿”å›å€¼ observable .reduce(10, accumulator: {(a, b) -> Int in return a*b }, mapResult: { (value) -> String in return \"In the end, value is \\(value)\" }) .subscribe({ (e) in print(e) }) .disposed(by: disposeBag) } è¾“å‡ºå¦‚ä¸‹ï¼š next(In the end, value is 7200) completed "},"RxSwiftStudy/Operator/Connectable.html":{"url":"RxSwiftStudy/Operator/Connectable.html","title":"7.09 è¿æ¥ Observable æ“ä½œç¬¦","keywords":"","body":"è¿æ¥ Observable æ“ä½œç¬¦ - Connectable Operator multicast multicast()éœ€è¦ä¼ å…¥ä¸€ä¸ª subjectï¼Œé€šè¿‡ subject æ¥ç®¡ç†å‘è®¢é˜…è€…å‘é€æ¶ˆæ¯ eg: func multicast() { let subject = PublishSubject() subject .subscribe(onNext: { print(\"Subject: \\($0)\") }) .disposed(by: disposeBag) let intSequence = Observable .interval(1, scheduler: MainScheduler.instance) .multicast(subject) // ä¸ä¸‹é¢ç›¸åŒï¼š // .multicast(makeSubject: { () -> PublishSubject in // return subject // }) intSequence .subscribe(onNext: { print(\"\\t Subscription 1:, Event: \\($0)\") }) .disposed(by: disposeBag) delayTime(2, block: { intSequence.connect().disposed(by: self.disposeBag) }) delayTime(4, block: { intSequence .subscribe(onNext: { print(\"\\t Subscription 2:, Event: \\($0)\") }) .disposed(by: self.disposeBag) }) delayTime(6, block: { intSequence .subscribe(onNext: { print(\"\\t Subscription 3:, Event: \\($0)\") }) .disposed(by: self.disposeBag) }) } è¾“å‡ºå¦‚ä¸‹ï¼š Subject: 0 Subscription 1:, Event: 0 Subject: 1 Subscription 1:, Event: 1 Subscription 2:, Event: 1 Subject: 2 Subscription 1:, Event: 2 Subscription 2:, Event: 2 Subject: 3 Subscription 1:, Event: 3 Subscription 2:, Event: 3 Subscription 3:, Event: 3 Subject: 4 Subscription 1:, Event: 4 Subscription 2:, Event: 4 Subscription 3:, Event: 4 Subject: 5 Subscription 1:, Event: 5 Subscription 2:, Event: 5 Subscription 3:, Event: 5 Subject: 6 Subscription 1:, Event: 6 Subscription 2:, Event: 6 Subscription 3:, Event: 6 Subject: 7 Subscription 1:, Event: 7 Subscription 2:, Event: 7 Subscription 3:, Event: 7 ........... ........... publish å°† Observable è½¬æ¢ä¸ºå¯è¢«è¿æ¥çš„ Observableï¼Œpublish ä¼šå°† Observable è½¬æ¢ä¸ºå¯è¢«è¿æ¥çš„ Observableã€‚ å¯è¢«è¿æ¥çš„ Observable å’Œæ™®é€šçš„ Observable ååˆ†ç›¸ä¼¼ï¼Œä¸è¿‡åœ¨è¢«è®¢é˜…åä¸ä¼šå‘å‡ºå…ƒç´ ï¼Œç›´åˆ° connect æ“ä½œç¬¦è¢«åº”ç”¨ä¸ºæ­¢ã€‚è¿™æ ·ä¸€æ¥ä½ å¯ä»¥æ§åˆ¶ Observable åœ¨ä»€ä¹ˆæ—¶å€™å¼€å§‹å‘å‡ºå…ƒç´ ã€‚ eg: func publish() { let connectObservable = Observable.of(1, 2, 3, 4, 5, 6).publish() print(\"> connectObservable subscribe now\") connectObservable .subscribe({ e in print(\"connectObservable => \\(e.debugDescription)\") }) .disposed(by: disposeBag) delayTime(3) { print(\"> connectObservable connect now\") connectObservable .connect() .disposed(by: self.disposeBag) } } è¾“å‡ºå¦‚ä¸‹ï¼š > connectObservable subscribe now > connectObservable connect now connectObservable => next(1) connectObservable => next(2) connectObservable => next(3) connectObservable => next(4) connectObservable => next(5) connectObservable => next(6) connectObservable => completed connect é€šçŸ¥å¯è¢«è¿æ¥çš„ Observable å¯ä»¥å¼€å§‹å‘å‡ºå…ƒç´ äº†ï¼Œå¯è¢«è¿æ¥çš„ Observable å’Œæ™®é€šçš„ Observable ååˆ†ç›¸ä¼¼ï¼Œä¸è¿‡åœ¨è¢«è®¢é˜…åä¸ä¼šå‘å‡ºå…ƒç´ ï¼Œç›´åˆ° connect æ“ä½œç¬¦è¢«åº”ç”¨ä¸ºæ­¢ã€‚ è¿™æ ·ä¸€æ¥ä½ å¯ä»¥ç­‰æ‰€æœ‰è§‚å¯Ÿè€…å…¨éƒ¨è®¢é˜…å®Œæˆåï¼Œæ‰å‘å‡ºå…ƒç´ ã€‚ eg: func connect() { let connectableObservable = ConnectableObservable .create({ (observer) -> Disposable in observer.onNext(\"ConnectableObservable -> 1\") observer.onNext(\"ConnectableObservable -> 2\") observer.onNext(\"ConnectableObservable -> 3\") delayTime(2, block: { observer.onNext(\"ConnectableObservable -> delay -> 1\") }) delayTime(4, block: { observer.onNext(\"ConnectableObservable -> delay -> 2\") observer.onCompleted() }) return Disposables.create() }) .publish() connectableObservable .subscribe({ (e) in print(\"First Subscribe : \\(e.debugDescription)\") }) .disposed(by: disposeBag) connectableObservable .connect() .disposed(by: disposeBag) connectableObservable .subscribe({ (e) in print(\"Second Subscribe : \\(e.debugDescription)\") }) .disposed(by: disposeBag) } è¾“å‡ºå¦‚ä¸‹ï¼š First Subscribe : next(ConnectableObservable -> 1) First Subscribe : next(ConnectableObservable -> 2) First Subscribe : next(ConnectableObservable -> 3) First Subscribe : next(ConnectableObservable -> delay -> 1) Second Subscribe : next(ConnectableObservable -> delay -> 1) First Subscribe : next(ConnectableObservable -> delay -> 2) Second Subscribe : next(ConnectableObservable -> delay -> 2) First Subscribe : completed Second Subscribe : completed refCount å°†å¯è¢«è¿æ¥çš„ Observable è½¬æ¢ä¸ºæ™®é€š Observableï¼ŒrefCount æ“ä½œç¬¦å°†è‡ªåŠ¨è¿æ¥å’Œæ–­å¼€å¯è¢«è¿æ¥çš„ Observableã€‚ å½“ç¬¬ä¸€ä¸ªè§‚å¯Ÿè€…å¯¹å®ƒè®¢é˜…æ—¶ï¼Œé‚£ä¹ˆåº•å±‚çš„ Observable å°†è¢«è¿æ¥ã€‚ å½“æœ€åä¸€ä¸ªè§‚å¯Ÿè€…ç¦»å¼€æ—¶ï¼Œé‚£ä¹ˆåº•å±‚çš„ Observable å°†è¢«æ–­å¼€è¿æ¥ã€‚ eg: func refCount() { let connectObservable = getFirstObservable().publish() let observable = connectObservable.refCount() observable .debug(\"refCount\") .subscribe() .disposed(by: disposeBag) } è¾“å‡ºå¦‚ä¸‹ï¼š 2017-12-27 15:11:42.966: refCount -> subscribed 2017-12-27 15:11:43.968: refCount -> Event next(First -> 1|A) 2017-12-27 15:11:43.968: refCount -> Event next(First -> 1|B) 2017-12-27 15:11:43.968: refCount -> Event next(First -> 1|C) 2017-12-27 15:11:47.968: refCount -> Event next(First -> 2|A) 2017-12-27 15:11:47.968: refCount -> Event next(First -> 2|B) 2017-12-27 15:11:47.968: refCount -> Event next(First -> 2|C) 2017-12-27 15:11:51.968: refCount -> Event next(First -> 3|A) 2017-12-27 15:11:51.968: refCount -> Event next(First -> 3|B) 2017-12-27 15:11:51.968: refCount -> Event next(First -> 3|C) 2017-12-27 15:11:51.970: refCount -> Event completed 2017-12-27 15:11:51.970: refCount -> isDisposed replay ç¡®ä¿è§‚å¯Ÿè€…æ¥æ”¶åˆ°åŒæ ·çš„åºåˆ—ï¼Œå³ä½¿æ˜¯åœ¨ Observable å‘å‡ºå…ƒç´ åæ‰è®¢é˜…ï¼Œreplay æ“ä½œç¬¦å°† Observable è½¬æ¢ä¸ºå¯è¢«è¿æ¥çš„ Observableï¼Œå¹¶ä¸”è¿™ä¸ªå¯è¢«è¿æ¥çš„ Observable å°†ç¼“å­˜æœ€æ–°çš„ n ä¸ªå…ƒç´ ã€‚å½“æœ‰æ–°çš„è§‚å¯Ÿè€…å¯¹å®ƒè¿›è¡Œè®¢é˜…æ—¶ï¼Œå®ƒå°±æŠŠè¿™äº›è¢«ç¼“å­˜çš„å…ƒç´ å‘é€ç»™è§‚å¯Ÿè€…ã€‚ RxSwiftå­¦ä¹ ä¹‹æ—… - share vs replay vs shareReplay eg: func replay() { let observable = getFirstObservable().replayAll() // let observable = getFirstObservable().replay(4) observable .debug(\"First\") .subscribe() .disposed(by: disposeBag) observable .connect() .disposed(by: disposeBag) delayTime(6) { observable .debug(\"replay\") .subscribe() .disposed(by: self.disposeBag) } } è¾“å‡ºå¦‚ä¸‹ï¼š 2017-12-27 15:15:14.401: First -> subscribed 2017-12-27 15:15:15.403: First -> Event next(First -> 1|A) 2017-12-27 15:15:15.403: First -> Event next(First -> 1|B) 2017-12-27 15:15:15.403: First -> Event next(First -> 1|C) 2017-12-27 15:15:19.892: First -> Event next(First -> 2|A) 2017-12-27 15:15:19.892: First -> Event next(First -> 2|B) 2017-12-27 15:15:19.892: First -> Event next(First -> 2|C) 2017-12-27 15:15:20.999: Replay -> subscribed 2017-12-27 15:15:21.000: Replay -> Event next(First -> 1|A) 2017-12-27 15:15:21.000: Replay -> Event next(First -> 1|B) 2017-12-27 15:15:21.000: Replay -> Event next(First -> 1|C) 2017-12-27 15:15:21.000: Replay -> Event next(First -> 2|A) 2017-12-27 15:15:21.000: Replay -> Event next(First -> 2|B) 2017-12-27 15:15:21.000: Replay -> Event next(First -> 2|C) 2017-12-27 15:15:23.402: First -> Event next(First -> 3|A) 2017-12-27 15:15:23.403: Replay -> Event next(First -> 3|A) 2017-12-27 15:15:23.403: First -> Event next(First -> 3|B) 2017-12-27 15:15:23.403: Replay -> Event next(First -> 3|B) 2017-12-27 15:15:23.403: First -> Event next(First -> 3|C) 2017-12-27 15:15:23.403: Replay -> Event next(First -> 3|C) 2017-12-27 15:15:23.403: First -> Event completed 2017-12-27 15:15:23.403: First -> isDisposed 2017-12-27 15:15:23.403: Replay -> Event completed 2017-12-27 15:15:23.403: Replay -> isDisposed share ä½¿è§‚å¯Ÿè€…å…±äº« Observableï¼Œä¸ä¼šå¯¹æ–°å¢çš„è§‚å¯Ÿè€…å‘é€ä¹‹å‰å·²ç»å‘é€äº†çš„å…ƒç´ ã€‚ âš ï¸æ³¨æ„ï¼šå½“è®¢é˜…è€…ä»å¤šä¸ªå˜æˆ 0 çš„æ—¶å€™é‡ç½®åºåˆ—ï¼Œå¦åˆ™ä¸é‡ç½®åºåˆ—ã€‚ RxSwiftå­¦ä¹ ä¹‹æ—… - share vs replay vs shareReplay eg: func share() { let observable = getFirstObservable().share() observable .debug(\"First Subscribe\") .subscribe() .disposed(by: disposeBag) delayTime(7) { observable .debug(\"Second Subscribe\") .subscribe() .disposed(by: self.disposeBag) } delayTime(12) { print(\"====================è®¢é˜…è€…æ€»æ•°å˜ä¸ºäº†0====================\") observable .debug(\"Third Subscribe\") .subscribe() .disposed(by: self.disposeBag) } } è¾“å‡ºå¦‚ä¸‹ï¼š 2017-12-27 16:14:10.869: First Subscribe -> subscribed 2017-12-27 16:14:11.871: First Subscribe -> Event next(First -> 1|A) 2017-12-27 16:14:11.871: First Subscribe -> Event next(First -> 1|B) 2017-12-27 16:14:11.871: First Subscribe -> Event next(First -> 1|C) 2017-12-27 16:14:15.871: First Subscribe -> Event next(First -> 2|A) 2017-12-27 16:14:15.871: First Subscribe -> Event next(First -> 2|B) 2017-12-27 16:14:15.871: First Subscribe -> Event next(First -> 2|C) 2017-12-27 16:14:17.871: Second Subscribe -> subscribed 2017-12-27 16:14:20.763: First Subscribe -> Event next(First -> 3|A) 2017-12-27 16:14:20.763: Second Subscribe -> Event next(First -> 3|A) 2017-12-27 16:14:20.764: First Subscribe -> Event next(First -> 3|B) 2017-12-27 16:14:20.764: Second Subscribe -> Event next(First -> 3|B) 2017-12-27 16:14:20.764: First Subscribe -> Event next(First -> 3|C) 2017-12-27 16:14:20.764: Second Subscribe -> Event next(First -> 3|C) 2017-12-27 16:14:20.764: First Subscribe -> Event completed 2017-12-27 16:14:20.764: First Subscribe -> isDisposed 2017-12-27 16:14:20.764: Second Subscribe -> Event completed 2017-12-27 16:14:20.764: Second Subscribe -> isDisposed ====================è®¢é˜…è€…æ€»æ•°å˜ä¸ºäº†0==================== 2017-12-27 16:14:24.066: Third Subscribe -> subscribed 2017-12-27 16:14:25.163: Third Subscribe -> Event next(First -> 1|A) 2017-12-27 16:14:25.163: Third Subscribe -> Event next(First -> 1|B) 2017-12-27 16:14:25.163: Third Subscribe -> Event next(First -> 1|C) 2017-12-27 16:14:29.066: Third Subscribe -> Event next(First -> 2|A) 2017-12-27 16:14:29.066: Third Subscribe -> Event next(First -> 2|B) 2017-12-27 16:14:29.066: Third Subscribe -> Event next(First -> 2|C) 2017-12-27 16:14:33.066: Third Subscribe -> Event next(First -> 3|A) 2017-12-27 16:14:33.066: Third Subscribe -> Event next(First -> 3|B) 2017-12-27 16:14:33.066: Third Subscribe -> Event next(First -> 3|C) 2017-12-27 16:14:33.066: Third Subscribe -> Event completed 2017-12-27 16:14:33.066: Third Subscribe -> isDisposed shareReplay @available(*, deprecated, message: \"Suggested replacement is share(replay: 1). In case old 3.x behavior of shareReplay is required please use share(replay: 1, scope: .forever) instead.\", renamed: \"share(replay:)\") ä½¿è§‚å¯Ÿè€…å…±äº« Observableï¼Œè§‚å¯Ÿè€…ä¼šç«‹å³æ”¶åˆ°æœ€æ–°çš„å…ƒç´ ï¼Œå³ä½¿è¿™äº›å…ƒç´ æ˜¯åœ¨è®¢é˜…å‰äº§ç”Ÿçš„ shareReplay æ“ä½œç¬¦å°†ä½¿å¾—è§‚å¯Ÿè€…å…±äº«æº Observableï¼Œå¹¶ä¸”ç¼“å­˜æœ€æ–°çš„ n ä¸ªå…ƒç´ ï¼Œå°†è¿™äº›å…ƒç´ ç›´æ¥å‘é€ç»™æ–°çš„è§‚å¯Ÿè€…ã€‚ âš ï¸æ³¨æ„ï¼šå½“è®¢é˜…è€…ä»å¤šä¸ªå˜æˆ 0 çš„æ—¶å€™ä¸ä¼šæ¸…ç©ºç¼“å­˜ä¸ä¼šé‡ç½®åºåˆ—ï¼Œå†æ¬¡è®¢é˜…ç›´æ¥è¿”å› replay çš„æ•°ç›®çš„å…ƒç´ ã€‚ RxSwiftå­¦ä¹ ä¹‹æ—… - share vs replay vs shareReplay func shareReplay() { let observable = getFirstObservable().share(replay: 2, scope: SubjectLifetimeScope.forever) observable .debug(\"Origin\") .subscribe() .disposed(by: disposeBag) delayTime(3) { observable .debug(\"shareReply\") .subscribe() .disposed(by: self.disposeBag) } } è¾“å‡ºå¦‚ä¸‹ï¼š 2017-12-27 16:19:53.859: First Subscribe -> subscribed 2017-12-27 16:19:54.862: First Subscribe -> Event next(First -> 1|A) 2017-12-27 16:19:54.862: First Subscribe -> Event next(First -> 1|B) 2017-12-27 16:19:54.862: First Subscribe -> Event next(First -> 1|C) 2017-12-27 16:19:58.861: First Subscribe -> Event next(First -> 2|A) 2017-12-27 16:19:58.861: First Subscribe -> Event next(First -> 2|B) 2017-12-27 16:19:58.861: First Subscribe -> Event next(First -> 2|C) 2017-12-27 16:20:00.862: Second Subscribe -> subscribed 2017-12-27 16:20:00.863: Second Subscribe -> Event next(First -> 2|B) 2017-12-27 16:20:00.863: Second Subscribe -> Event next(First -> 2|C) 2017-12-27 16:20:02.861: First Subscribe -> Event next(First -> 3|A) 2017-12-27 16:20:02.861: Second Subscribe -> Event next(First -> 3|A) 2017-12-27 16:20:02.861: First Subscribe -> Event next(First -> 3|B) 2017-12-27 16:20:02.861: Second Subscribe -> Event next(First -> 3|B) 2017-12-27 16:20:02.861: First Subscribe -> Event next(First -> 3|C) 2017-12-27 16:20:02.861: Second Subscribe -> Event next(First -> 3|C) 2017-12-27 16:20:02.863: First Subscribe -> Event completed 2017-12-27 16:20:02.863: First Subscribe -> isDisposed 2017-12-27 16:20:02.864: Second Subscribe -> Event completed 2017-12-27 16:20:02.864: Second Subscribe -> isDisposed ====================è®¢é˜…è€…æ€»æ•°å˜ä¸ºäº†0==================== 2017-12-27 16:20:05.862: Third Subscribe -> subscribed 2017-12-27 16:20:05.862: Third Subscribe -> Event next(First -> 3|B) 2017-12-27 16:20:05.862: Third Subscribe -> Event next(First -> 3|C) 2017-12-27 16:20:05.862: Third Subscribe -> Event completed 2017-12-27 16:20:05.862: Third Subscribe -> isDisposed shareReplayLatestWhileConnected @available(*, deprecated, message: \"use share(replay: 1) instead\", renamed: \"share(replay:)\") ä½¿è§‚å¯Ÿè€…å…±äº« Observableï¼Œè§‚å¯Ÿè€…ä¼šç«‹å³æ”¶åˆ°æœ€æ–°çš„å…ƒç´ ï¼Œå³ä½¿è¿™äº›å…ƒç´ æ˜¯åœ¨è®¢é˜…å‰äº§ç”Ÿçš„ shareReplayLatestWhileConnected æ“ä½œç¬¦å°†ä½¿å¾—è§‚å¯Ÿè€…å…±äº«æº Observableï¼Œå¹¶ä¸”ç¼“å­˜æœ€æ–°çš„ n ä¸ªå…ƒç´ ï¼Œå°†è¿™äº›å…ƒç´ ç›´æ¥å‘é€ç»™æ–°çš„è§‚å¯Ÿè€…ã€‚ âš ï¸æ³¨æ„ï¼šå½“è®¢é˜…è€…ä»å¤šä¸ªå˜æˆ 0 çš„æ—¶å€™æ¸…ç©ºç¼“å­˜å¹¶ä¸”é‡ç½®åºåˆ—ï¼Œå¦åˆ™ä¸é‡ç½®åºåˆ— RxSwiftå­¦ä¹ ä¹‹æ—… - share vs replay vs shareReplay eg: func shareReplayLatestWhileConnected() { // @available(*, deprecated, message: \"use share(replay: 1) instead\", renamed: \"share(replay:)\") let observable = getFirstObservable().share(replay: 2, scope: SubjectLifetimeScope.whileConnected) observable .debug(\"First Subscribe\") .subscribe() .disposed(by: disposeBag) delayTime(7) { observable .debug(\"Second Subscribe\") .subscribe() .disposed(by: self.disposeBag) } delayTime(12) { print(\"====================è®¢é˜…è€…æ€»æ•°å˜ä¸ºäº†0====================\") observable .debug(\"Third Subscribe\") .subscribe() .disposed(by: self.disposeBag) } } è¾“å‡ºå¦‚ä¸‹ï¼š 2017-12-27 16:26:11.460: First Subscribe -> subscribed 2017-12-27 16:26:12.466: First Subscribe -> Event next(First -> 1|A) 2017-12-27 16:26:12.466: First Subscribe -> Event next(First -> 1|B) 2017-12-27 16:26:12.466: First Subscribe -> Event next(First -> 1|C) 2017-12-27 16:26:16.463: First Subscribe -> Event next(First -> 2|A) 2017-12-27 16:26:16.464: First Subscribe -> Event next(First -> 2|B) 2017-12-27 16:26:16.464: First Subscribe -> Event next(First -> 2|C) 2017-12-27 16:26:18.870: Second Subscribe -> subscribed 2017-12-27 16:26:18.871: Second Subscribe -> Event next(First -> 2|B) 2017-12-27 16:26:18.871: Second Subscribe -> Event next(First -> 2|C) 2017-12-27 16:26:20.463: First Subscribe -> Event next(First -> 3|A) 2017-12-27 16:26:20.463: Second Subscribe -> Event next(First -> 3|A) 2017-12-27 16:26:20.464: First Subscribe -> Event next(First -> 3|B) 2017-12-27 16:26:20.464: Second Subscribe -> Event next(First -> 3|B) 2017-12-27 16:26:20.464: First Subscribe -> Event next(First -> 3|C) 2017-12-27 16:26:20.464: Second Subscribe -> Event next(First -> 3|C) 2017-12-27 16:26:20.464: First Subscribe -> Event completed 2017-12-27 16:26:20.464: First Subscribe -> isDisposed 2017-12-27 16:26:20.464: Second Subscribe -> Event completed 2017-12-27 16:26:20.464: Second Subscribe -> isDisposed ====================è®¢é˜…è€…æ€»æ•°å˜ä¸ºäº†0==================== 2017-12-27 16:26:23.464: Third Subscribe -> subscribed 2017-12-27 16:26:24.552: Third Subscribe -> Event next(First -> 1|A) 2017-12-27 16:26:24.552: Third Subscribe -> Event next(First -> 1|B) 2017-12-27 16:26:24.552: Third Subscribe -> Event next(First -> 1|C) 2017-12-27 16:26:28.952: Third Subscribe -> Event next(First -> 2|A) 2017-12-27 16:26:28.952: Third Subscribe -> Event next(First -> 2|B) 2017-12-27 16:26:28.952: Third Subscribe -> Event next(First -> 2|C) 2017-12-27 16:26:32.464: Third Subscribe -> Event next(First -> 3|A) 2017-12-27 16:26:32.464: Third Subscribe -> Event next(First -> 3|B) 2017-12-27 16:26:32.464: Third Subscribe -> Event next(First -> 3|C) 2017-12-27 16:26:32.464: Third Subscribe -> Event completed 2017-12-27 16:26:32.464: Third Subscribe -> isDisposed "},"RxSwiftStudy/Operator/Time.html":{"url":"RxSwiftStudy/Operator/Time.html","title":"7.10 Time Operator","keywords":"","body":"Time Operator delay delay æ“ä½œç¬¦å°†ä¿®æ”¹ä¸€ä¸ª Observableï¼Œå®ƒä¼šå°† Observable çš„æ‰€æœ‰å…ƒç´ éƒ½æ‹–å»¶ä¸€æ®µè®¾å®šå¥½çš„æ—¶é—´ï¼Œ ç„¶åæ‰å°†å®ƒä»¬å‘é€å‡ºæ¥ã€‚ âš ï¸æ³¨æ„ï¼šæ˜¯å»¶è¿Ÿå…ƒç´ çš„å‘å‡ºæ—¶é—´è€Œä¸æ˜¯å»¶è¿Ÿè®¢é˜…æˆ–è€…åˆ›å»º Observable çš„æ—¶é—´ eg: func delay() { getFourthObservable() .delay(5, scheduler: MainScheduler.instance) .debug(\"delay\") .subscribe() .disposed(by: disposeBag) } è¾“å‡ºå¦‚ä¸‹ï¼š 2017-12-27 16:38:12.431: delay -> subscribed > Send onNext(\"0ï¸âƒ£\") > Send onNext(\"1ï¸âƒ£\") > Send onNext(\"2ï¸âƒ£\") 2017-12-27 16:38:17.435: delay -> Event next(0ï¸âƒ£) 2017-12-27 16:38:18.433: delay -> Event next(1ï¸âƒ£) 2017-12-27 16:38:19.433: delay -> Event next(2ï¸âƒ£) delaySubscription delaySubscription æ“ä½œç¬¦å°†åœ¨ç»è¿‡æ‰€è®¾å®šçš„æ—¶é—´åï¼Œæ‰çœŸæ­£çš„å¯¹ Observable è¿›è¡Œè®¢é˜…æ“ä½œã€‚ âš ï¸æ³¨æ„ï¼šæ˜¯å»¶è¿Ÿå»¶è¿Ÿè®¢é˜…æ—¶é—´ï¼Œè€Œä¸æ˜¯å…ƒç´ çš„å‘å‡ºæ—¶é—´æˆ–è€…åˆ›å»º Observable çš„æ—¶é—´ func delaySubscription() { print(\"Create Observable Now\") getFourthObservable() .delaySubscription(5, scheduler: MainScheduler.instance) .debug(\"delaySubscription\") .subscribe() .disposed(by: disposeBag) } è¾“å‡ºå¦‚ä¸‹ï¼š Create Observable Now 2017-12-27 16:42:49.984: delaySubscription -> subscribed > Send onNext(\"0ï¸âƒ£\") 2017-12-27 16:42:54.989: delaySubscription -> Event next(0ï¸âƒ£) > Send onNext(\"1ï¸âƒ£\") 2017-12-27 16:42:56.086: delaySubscription -> Event next(1ï¸âƒ£) > Send onNext(\"2ï¸âƒ£\") 2017-12-27 16:42:57.179: delaySubscription -> Event next(2ï¸âƒ£) defer ç›´åˆ°è®¢é˜…å‘ç”Ÿï¼Œæ‰åˆ›å»º Observableï¼Œå¹¶ä¸”ä¸ºæ¯ä½è®¢é˜…è€…åˆ›å»ºå…¨æ–°çš„ Observable âš ï¸æ³¨æ„ï¼šæ˜¯å»¶è¿Ÿåˆ›å»º Observable ï¼Œè€Œä¸æ˜¯å»¶è¿Ÿè®¢é˜…æˆ–è€…å»¶è¿Ÿå…ƒç´ çš„å‘å‡ºæ—¶é—´ defer æ“ä½œç¬¦å°†ç­‰å¾…è§‚å¯Ÿè€…è®¢é˜…å®ƒï¼Œæ‰åˆ›å»ºä¸€ä¸ª Observableï¼Œå®ƒä¼šé€šè¿‡ä¸€ä¸ªæ„å»ºå‡½æ•°ä¸ºæ¯ä¸€ä½è®¢é˜…è€…åˆ›å»ºæ–°çš„ Observableã€‚ âš ï¸æ³¨æ„ï¼šçœ‹ä¸Šå»æ¯ä½è®¢é˜…è€…éƒ½æ˜¯å¯¹åŒä¸€ä¸ª Observable äº§ç”Ÿè®¢é˜…ï¼Œå®é™…ä¸Šå®ƒä»¬éƒ½è·å¾—äº†ç‹¬ç«‹çš„åºåˆ—ã€‚å…¶å®å¹¶ä¸æ˜¯åƒä»¥å‰ä¸€æ ·è®¢é˜…åŒä¸€ä¸ª Observableï¼Œå®é™…ä¸ºæ¯ä¸ªè®¢é˜…è€…éƒ½åˆ›å»ºäº†ä¸€ä¸ª Observable ï¼Œåœ¨ä¸€äº›æƒ…å†µä¸‹ï¼Œç›´åˆ°è®¢é˜…æ—¶æ‰åˆ›å»º Observable æ˜¯å¯ä»¥ä¿è¯æ‹¿åˆ°çš„æ•°æ®éƒ½æ˜¯æœ€æ–°çš„ã€‚ eg: func `defer`() { let observable = Observable.deferred { [unowned self] () -> Observable in print(\"Observable is Create Now\") return self.getSecondObservable() } delayTime(2) { print(\"First Subscribe Now\") observable .debug(\"Test Defer: First Subscribe\") .subscribe() .disposed(by: self.disposeBag) } // æµ‹è¯•æ˜¯å¦ä¸ºæ¯ä½è®¢é˜…è€…éƒ½åˆ›å»ºäº† Observable delayTime(5) { print(\"Second Subscribe Now\") observable .debug(\"Test Defer: Second Subscribe\") .subscribe() .disposed(by: self.disposeBag) } } è¾“å‡ºå¦‚ä¸‹ï¼š First Subscribe Now 2017-12-27 09:44:31.176: Test Defer: First Subscribe -> subscribed Observable is Create Now 2017-12-27 09:44:31.280: Test Defer: First Subscribe -> Event next(Second -> 1) Second Subscribe Now 2017-12-27 09:44:34.171: Test Defer: Second Subscribe -> subscribed Observable is Create Now 2017-12-27 09:44:34.279: Test Defer: Second Subscribe -> Event next(Second -> 1) 2017-12-27 09:44:35.280: Test Defer: First Subscribe -> Event next(Second -> 2) 2017-12-27 09:44:38.279: Test Defer: Second Subscribe -> Event next(Second -> 2) 2017-12-27 09:44:39.280: Test Defer: First Subscribe -> Event next(Second -> 3) 2017-12-27 09:44:39.280: Test Defer: First Subscribe -> Event completed 2017-12-27 09:44:39.280: Test Defer: First Subscribe -> isDisposed 2017-12-27 09:44:42.279: Test Defer: Second Subscribe -> Event next(Second -> 3) 2017-12-27 09:44:42.279: Test Defer: Second Subscribe -> Event completed 2017-12-27 09:44:42.280: Test Defer: Second Subscribe -> isDisposed interval åˆ›å»ºä¸€ä¸ª Observable æ¯éš”ä¸€æ®µæ—¶é—´ï¼Œå‘å‡ºä¸€ä¸ªç´¢å¼•æ•° interval æ“ä½œç¬¦å°†åˆ›å»ºä¸€ä¸ª Observableï¼Œå®ƒæ¯éš”ä¸€æ®µè®¾å®šçš„æ—¶é—´ï¼Œå‘å‡ºä¸€ä¸ªç´¢å¼•æ•°çš„å…ƒç´ ã€‚å®ƒå°†å‘å‡ºæ— æ•°ä¸ªå…ƒç´ ã€‚ eg: func interval() { let intervalQueue = DispatchQueue.init(label: \"ink.tbd.test.interval\") Observable .interval(1, scheduler: ConcurrentDispatchQueueScheduler.init(queue: intervalQueue)) .subscribe({ (e) in print(\"interval => \\(e.debugDescription)\") }) .disposed(by: disposeBag) } è¾“å‡ºå¦‚ä¸‹ï¼š interval => next(0) interval => next(1) interval => next(2) interval => next(3) interval => next(4) interval => next(5) interval => next(6) interval => next(7) ........... ........... timer åˆ›å»ºä¸€ä¸ª Observable åœ¨ä¸€æ®µå»¶æ—¶åï¼Œäº§ç”Ÿå”¯ä¸€çš„ä¸€ä¸ªå…ƒç´  timer æ“ä½œç¬¦å°†åˆ›å»ºä¸€ä¸ª Observableï¼Œå®ƒåœ¨ç»è¿‡è®¾å®šçš„ä¸€æ®µæ—¶é—´åï¼Œäº§ç”Ÿå”¯ä¸€çš„ä¸€ä¸ªå…ƒç´ ã€‚ âš ï¸æ³¨æ„ï¼štimer(_:period:scheduler:) ä¸ interval(_:scheduler:) çš„åŒºåˆ« timer(_:period:scheduler:) çš„å®ç°ï¼š public static func timer(_ dueTime: RxTimeInterval, period: RxTimeInterval? = nil, scheduler: SchedulerType) -> Observable { return Timer( dueTime: dueTime, period: period, scheduler: scheduler ) } interval(_:scheduler:) çš„å®ç°ï¼š public static func interval(_ period: RxTimeInterval, scheduler: SchedulerType) -> Observable { return Timer(dueTime: period, period: period, scheduler: scheduler ) } eg: func timer() { // dueTime: åˆå§‹å»¶æ—¶, period: æ—¶é—´é—´éš”, scheduler: é˜Ÿåˆ— let timerObservable = Observable.timer(5.0, period: 1, scheduler: MainScheduler.instance) timerObservable .debug(\"timer\") .subscribe() .disposed(by: disposeBag) } è¾“å‡ºå¦‚ä¸‹ï¼š 2017-12-27 09:57:16.075: timer -> subscribed 2017-12-27 09:57:21.077: timer -> Event next(0) 2017-12-27 09:57:22.076: timer -> Event next(1) 2017-12-27 09:57:23.077: timer -> Event next(2) 2017-12-27 09:57:24.077: timer -> Event next(3) 2017-12-27 09:57:25.077: timer -> Event next(4) 2017-12-27 09:57:26.077: timer -> Event next(5) 2017-12-27 09:57:27.077: timer -> Event next(6) 2017-12-27 09:57:28.076: timer -> Event next(7) 2017-12-27 09:57:29.076: timer -> Event next(8) 2017-12-27 09:57:30.076: timer -> Event next(9) 2017-12-27 09:57:31.075: timer -> Event next(10) ............ ............ timeout å¦‚æœæº Observable åœ¨è§„å®šæ—¶é—´å†…æ²¡æœ‰å‘ä»»ä½•å‡ºå…ƒç´ ï¼Œå°±äº§ç”Ÿä¸€ä¸ªè¶…æ—¶çš„ error äº‹ä»¶ timer æ“ä½œç¬¦å°†ä½¿å¾—åºåˆ—å‘å‡ºä¸€ä¸ª error äº‹ä»¶ï¼Œåªè¦ Observable åœ¨ä¸€æ®µæ—¶é—´å†…æ²¡æœ‰äº§ç”Ÿå…ƒç´ ã€‚ eg: func timeout() { let observable = Observable.never() observable .timeout(3, scheduler: MainScheduler.instance) .debug(\"timeout\") .subscribe() .disposed(by: disposeBag) } è¾“å‡ºå¦‚ä¸‹ï¼š 2017-12-27 16:44:32.898: timeout -> subscribed 2017-12-27 16:44:35.899: timeout -> Event error(Sequence timeout.) Unhandled error happened: Sequence timeout. subscription called from: 0 RxSwift 0x000000010b9db58c _T07RxSwift14ObservableTypePAAE9subscribeAA10Disposable_py1EQzcSg6onNext_ys5Error_pcSg0gI0yycSg0G9CompletedAM0G8DisposedtF + 780 1 RxSwiftExample 0x000000010b277bae _T011RxSwiftExample8OperatorC7timeoutyyF + 1150 2 RxSwiftExample 0x000000010b277e04 _T011RxSwiftExample8OperatorC7timeoutyyFTo + 36 3 RxSwiftExample 0x000000010b2ac771 _T011RxSwiftExample27OperatorTableViewControllerC11viewDidLoadyyFy10Foundation9IndexPathVcfU1_ + 897 4 RxSwiftExample 0x000000010b2ac8a7 _T011RxSwiftExample27OperatorTableViewControllerC11viewDidLoadyyFy10Foundation9IndexPathVcfU1_TA + 103 5 RxSwiftExample 0x000000010b26cdc0 _T010Foundation9IndexPathVIxx_ACIxi_TR + 48 6 RxSwiftExample 0x000000010b2ac932 _T010Foundation9IndexPathVIxx_ACIxi_TRTA + 66 7 RxSwift 0x000000010b9dbd35 _T07RxSwift14ObservableTypePAAE9subscribeAA10Disposable_py1EQzcSg6onNext_ys5Error_pcSg0gI0yycSg0G9CompletedAM0G8DisposedtFyAA5EventOyAGGcfU_ + 885 8 RxSwift 0x000000010b9dc28a _T07RxSwift14ObservableTypePAAE9subscribeAA10Disposable_py1EQzcSg6onNext_ys5Error_pcSg0gI0yycSg0G9CompletedAM0G8DisposedtFyAA5EventOyAGGcfU_TA + 282 9 RxSwift 0x000000010b911998 _T07RxSwift17AnonymousObserverC6onCoreyAA5EventOyxGF + 408 10 RxSwift 0x000000010b9e3026 _T07RxSwift12ObserverBaseC2onyAA5EventOyxGF + 742 11 RxSwift 0x000000010b9e35be _T07RxSwift12ObserverBaseCyxGAA0C4TypeAAlAaEP2onyAA5EventOy1EQzGFTW + 62 12 RxSwift 0x000000010b912c93 _T0TA + 115 13 RxSwift 0x000000010b91d3a7 _T07RxSwift5EventOyxGIxi_ADytIxir_1EQyd__RszAA12ObserverTypeRd__r__lTR + 23 14 RxSwift 0x000000010ba2fbc6 _T07RxSwift5EventOyxGIxi_ADytIxir_1EQyd__RszAA12ObserverTypeRd__r__lTRTA.47 + 118 15 RxSwift 0x000000010b91d770 _T07RxSwift5EventOyxGytIxir_ADIxi_lTR + 16 16 RxSwift 0x000000010b91f332 _T07RxSwift5EventOyxGytIxir_ADIxi_lTRTA.18 + 82 17 RxSwift 0x000000010b91e564 _T07RxSwift8dispatchyAA3BagVyyAA5EventOyxGcG_AGtlF + 900 18 RxSwift 0x000000010ba2992e _T07RxSwift36ShareReplay1WhileConnectedConnection33_E9FE621655D67A613BF2FC2D9B3041FCLLC2onyAA5EventOyxGF + 1230 19 RxSwift 0x000000010ba2baeb _T07RxSwift36ShareReplay1WhileConnectedConnection33_E9FE621655D67A613BF2FC2D9B3041FCLLCyxGAA12ObserverTypeAAlAaFP2onyAA5EventOy1EQzGFTW + 43 20 RxSwift 0x000000010ba37bcc _T07RxSwift4SinkC9forwardOnyAA5EventOy1EQzGF + 780 21 RxSwift 0x000000010b92fff7 _T07RxSwift9CatchSink33_7E15DB08AB19A7B882D5C92A393C6F6DLLC2onyAA5EventOy1EQzGF + 823 22 RxSwift 0x000000010b930a5b _T07RxSwift9CatchSink33_7E15DB08AB19A7B882D5C92A393C6F6DLLCyxGAA12ObserverTypeA2aFRzlAaFP2onyAA5EventOy1EQzGFTW + 43 23 RxSwift 0x000000010b9e0f11 _T07RxSwift32ObserveOnSerialDispatchQueueSink33_277A93ABA8477198C125F3F26B2D4B62LLCADyxGAA0efG9SchedulerC9scheduler_x8observerAA10Cancelable_p6canceltcfcAA10Disposable_pAE4sink_AA5EventOy1EQzG5eventtcfU_ + 833 24 RxSwift 0x000000010b9e2579 _T07RxSwift32ObserveOnSerialDispatchQueueSink33_277A93ABA8477198C125F3F26B2D4B62LLCADyxGAA0efG9SchedulerC9scheduler_x8observerAA10Cancelable_p6canceltcfcAA10Disposable_pAE4sink_AA5EventOy1EQzG5eventtcfU_TA + 9 25 RxSwift 0x000000010b9e17d9 _T07RxSwift32ObserveOnSerialDispatchQueueSink33_277A93ABA8477198C125F3F26B2D4B62LLCyxGAA5EventOy1EQzGAA10Disposable_pIxxir_AE_AJtAaK_pIxir_AA12ObserverTypeRzlTR + 137 26 RxSwift 0x000000010b9e2786 _T07RxSwift32ObserveOnSerialDispatchQueueSink33_277A93ABA8477198C125F3F26B2D4B62LLCyxGAA5EventOy1EQzGAA10Disposable_pIxxir_AE_AJtAaK_pIxir_AA12ObserverTypeRzlTRTA + 102 27 RxSwift 0x000000010b9ba564 _T07RxSwift13MainSchedulerC16scheduleInternalAA10Disposable_px_AaE_pxc6actiontlF + 484 28 RxSwift 0x000000010ba26a4d _T07RxSwift28SerialDispatchQueueSchedulerC8scheduleAA10Disposable_px_AaE_pxc6actiontlF + 173 29 RxSwift 0x000000010b9e16cc _T07RxSwift32ObserveOnSerialDispatchQueueSink33_277A93ABA8477198C125F3F26B2D4B62LLC6onCoreyAA5EventOy1EQzGF + 1148 30 RxSwift 0x000000010b9e3026 _T07RxSwift12ObserverBaseC2onyAA5EventOyxGF + 742 31 RxSwift 0x000000010b9e35be _T07RxSwift12ObserverBaseCyxGAA0C4TypeAAlAaEP2onyAA5EventOy1EQzGFTW + 62 32 RxSwift 0x000000010ba37bcc _T07RxSwift4SinkC9forwardOnyAA5EventOy1EQzGF + 780 33 RxSwift 0x000000010ba420e0 _T07RxSwift15SubscribeOnSink33_B44C3DD7F62EF81799E6347E59A266A2LLC2onyAA5EventOy1EQzGF + 400 34 RxSwift 0x000000010ba42e0b _T07RxSwift15SubscribeOnSink33_B44C3DD7F62EF81799E6347E59A266A2LLCyxq_GAA12ObserverTypeA2A010ObservableP0RzAaFR_1EQy_AHRtzr0_lAaFP2onyAA5EventOyAHQzGFTW + 43 35 RxSwift 0x000000010ba37bcc _T07RxSwift4SinkC9forwardOnyAA5EventOy1EQzGF + 780 36 RxSwift 0x000000010b9bb695 _T07RxSwift7MapSink33_5428EFA9A9B0C0340021B871D2E5AC01LLC2onyAA5EventOyxGF + 1093 37 RxSwift 0x000000010b9bbbeb _T07RxSwift7MapSink33_5428EFA9A9B0C0340021B871D2E5AC01LLCyxq_GAA12ObserverTypeA2aFR_r0_lAaFP2onyAA5EventOy1EQzGFTW + 43 38 RxSwift 0x000000010ba37bcc _T07RxSwift4SinkC9forwardOnyAA5EventOy1EQzGF + 780 39 RxSwift 0x000000010ba420e0 _T07RxSwift15SubscribeOnSink33_B44C3DD7F62EF81799E6347E59A266A2LLC2onyAA5EventOy1EQzGF + 400 40 RxSwift 0x000000010ba42e0b _T07RxSwift15SubscribeOnSink33_B44C3DD7F62EF81799E6347E59A266A2LLCyxq_GAA12ObserverTypeA2A010ObservableP0RzAaFR_1EQy_AHRtzr0_lAaFP2onyAA5EventOyAHQzGFTW + 43 41 RxSwift 0x000000010b912c93 _T0TA + 115 42 RxSwift 0x000000010b91d3a7 _T07RxSwift5EventOyxGIxi_ADytIxir_1EQyd__RszAA12ObserverTypeRd__r__lTR + 23 43 RxSwift 0x000000010ba2fa36 _T07RxSwift5EventOyxGIxi_ADytIxir_1EQyd__RszAA12ObserverTypeRd__r__lTRTA + 118 44 RxSwift 0x000000010b91d770 _T07RxSwift5EventOyxGytIxir_ADIxi_lTR + 16 45 RxSwift 0x000000010b91f332 _T07RxSwift5EventOyxGytIxir_ADIxi_lTRTA.18 + 82 46 RxSwift 0x000000010b91e564 _T07RxSwift8dispatchyAA3BagVyyAA5EventOyxGcG_AGtlF + 900 47 RxSwift 0x000000010ba2ceee _T07RxSwift29ShareWhileConnectedConnection33_E9FE621655D67A613BF2FC2D9B3041FCLLC2onyAA5EventOyxGF + 1230 48 RxSwift 0x000000010ba2eabb _T07RxSwift29ShareWhileConnectedConnection33_E9FE621655D67A613BF2FC2D9B3041FCLLCyxGAA12ObserverTypeAAlAaFP2onyAA5EventOy1EQzGFTW + 43 49 RxSwift 0x000000010ba37bcc _T07RxSwift4SinkC9forwardOnyAA5EventOy1EQzGF + 780 50 RxSwift 0x000000010b9a0dfb _T07RxSwift6DoSink33_51F9E615740E91B2E920965FFBB1EED3LLC2onyAA5EventOy1EQzGF + 843 51 RxSwift 0x000000010b9a14eb _T07RxSwift6DoSink33_51F9E615740E91B2E920965FFBB1EED3LLCyxGAA12ObserverTypeA2aFRzlAaFP2onyAA5EventOy1EQzGFTW + 43 52 RxSwift 0x000000010b912c93 _T0TA + 115 53 RxSwift 0x000000010b91d3a7 _T07RxSwift5EventOyxGIxi_ADytIxir_1EQyd__RszAA12ObserverTypeRd__r__lTR + 23 54 RxSwift 0x000000010b9f7396 _T07RxSwift5EventOyxGIxi_ADytIxir_1EQyd__RszAA12ObserverTypeRd__r__lTRTA + 118 55 RxSwift 0x000000010b91d770 _T07RxSwift5EventOyxGytIxir_ADIxi_lTR + 16 56 RxSwift 0x000000010b91f332 _T07RxSwift5EventOyxGytIxir_ADIxi_lTRTA.18 + 82 57 RxSwift 0x000000010b91e564 _T07RxSwift8dispatchyAA3BagVyyAA5EventOyxGcG_AGtlF + 900 58 RxSwift 0x000000010b9f51ca _T07RxSwift14PublishSubjectC2onyAA5EventOyxGF + 1018 59 RxCocoa 0x000000010b6a6d91 _T07RxSwift14PublishSubjectC2onyAA5EventOyxGFTA + 17 60 RxCocoa 0x000000010b6a646d _T07RxSwift5EventOySayypGGIxi_AEIxx_TR + 29 61 RxCocoa 0x000000010b6a6d6e _T07RxSwift5EventOySayypGGIxi_AEIxx_TRTA + 78 62 RxCocoa 0x000000010b6a45eb _T07RxCocoa13DelegateProxyC14_methodInvokedy10ObjectiveC8SelectorV_SayypG13withArgumentstF + 283 63 RxCocoa 0x000000010b6a4664 _T07RxCocoa13DelegateProxyC14_methodInvokedy10ObjectiveC8SelectorV_SayypG13withArgumentstFTo + 84 64 RxCocoa 0x000000010b675588 -[_RXDelegateProxy forwardInvocation:] + 536 65 CoreFoundation 0x000000010f91bcd8 ___forwarding___ + 760 66 CoreFoundation 0x000000010f91b958 _CF_forwarding_prep_0 + 120 67 UIKit 0x000000010cd43839 -[UITableView _selectRowAtIndexPath:animated:scrollPosition:notifyDelegate:] + 1810 68 UIKit 0x000000010cd43a54 -[UITableView _userSelectRowAtPendingSelectionIndexPath:] + 344 69 UIKit 0x000000010cc0cd59 _runAfterCACommitDeferredBlocks + 318 70 UIKit 0x000000010cbfbbb1 _cleanUpAfterCAFlushAndRunDeferredBlocks + 280 71 UIKit 0x000000010cc2b0e0 _afterCACommitHandler + 137 72 CoreFoundation 0x000000010f93bc07 __CFRUNLOOP_IS_CALLING_OUT_TO_AN_OBSERVER_CALLBACK_FUNCTION__ + 23 73 CoreFoundation 0x000000010f93bb5e __CFRunLoopDoObservers + 430 74 CoreFoundation 0x000000010f920124 __CFRunLoopRun + 1572 75 CoreFoundation 0x000000010f91f889 CFRunLoopRunSpecific + 409 76 GraphicsServices 0x000000011504a9c6 GSEventRunModal + 62 77 UIKit 0x000000010cc015d6 UIApplicationMain + 159 78 RxSwiftExample 0x000000010b28d597 main + 55 79 libdyld.dylib 0x00000001111f6d81 start + 1 80 ??? 0x0000000000000001 0x0 + 1 2017-12-27 16:44:35.902: timeout -> isDisposed "},"RxSwiftStudy/Operator/Scheduler.html":{"url":"RxSwiftStudy/Operator/Scheduler.html","title":"7.11 Scheduler Operator","keywords":"","body":"Scheduler Operator observeOn https://beeth0ven.github.io/RxSwift-Chinese-Documentation/content/decision_tree/observeOn.html æŒ‡å®š Observable åœ¨å“ªä¸ª Scheduler å‘å‡ºé€šçŸ¥ ReactiveX ä½¿ç”¨ Scheduler æ¥è®© Observable æ”¯æŒå¤šçº¿ç¨‹ã€‚ä½ å¯ä»¥ä½¿ç”¨ observeOn æ“ä½œç¬¦ï¼Œæ¥æŒ‡ç¤º Observable åœ¨å“ªä¸ª Scheduler å‘å‡ºé€šçŸ¥ã€‚ âš ï¸æ³¨æ„ï¼šä¸€æ—¦äº§ç”Ÿäº† onError äº‹ä»¶ï¼Œ observeOn æ“ä½œç¬¦å°†ç«‹å³è½¬å‘ã€‚ä»–ä¸ä¼šç­‰å¾… onError ä¹‹å‰çš„äº‹ä»¶å…¨éƒ¨è¢«æ”¶åˆ°ã€‚è¿™æ„å‘³ç€ onError äº‹ä»¶å¯èƒ½ä¼šè·³è¿‡ä¸€äº›å…ƒç´ æå‰å‘é€å‡ºå»ã€‚ subscribeOn æ“ä½œç¬¦éå¸¸ç›¸ä¼¼ã€‚å®ƒæŒ‡ç¤º Observable åœ¨å“ªä¸ª Scheduler å‘å‡ºæ‰§è¡Œã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒObservable åˆ›å»ºï¼Œåº”ç”¨æ“ä½œç¬¦ä»¥åŠå‘å‡ºé€šçŸ¥éƒ½ä¼šåœ¨ Subscribe æ–¹æ³•è°ƒç”¨çš„ Scheduler æ‰§è¡Œã€‚subscribeOn æ“ä½œç¬¦å°†æ”¹å˜è¿™ç§è¡Œä¸ºï¼Œå®ƒä¼šæŒ‡å®šä¸€ä¸ªä¸åŒçš„ Scheduler æ¥è®© Observable æ‰§è¡Œï¼ŒobserveOn æ“ä½œç¬¦å°†æŒ‡å®šä¸€ä¸ªä¸åŒçš„ Scheduler æ¥è®© Observable é€šçŸ¥è§‚å¯Ÿè€…ã€‚ subscribeOn æ“ä½œç¬¦æŒ‡å®š Observable åœ¨å“ªä¸ª Scheduler å¼€å§‹æ‰§è¡Œï¼Œæ— è®ºå®ƒå¤„äºé“¾çš„é‚£ä¸ªä½ç½®ã€‚ å¦ä¸€æ–¹é¢ observeOn å°†å†³å®šåé¢çš„æ–¹æ³•åœ¨å“ªä¸ª Scheduler è¿è¡Œã€‚å› æ­¤ï¼Œä½ å¯èƒ½ä¼šå¤šæ¬¡è°ƒç”¨ observeOn æ¥å†³å®šæŸäº›æ“ä½œç¬¦åœ¨å“ªä¸ªçº¿ç¨‹è¿è¡Œã€‚ eg: func observeOn() { let observable = Observable.of(1, 2, 3, 4, 5) let observeQueue = DispatchQueue.init(label: \"ink.tbd.test.observeQueue\") observable .observeOn(ConcurrentDispatchQueueScheduler.init(queue: observeQueue)) .subscribe({ (e) in print(\"observeOn: \\(getCurrentQueueName()); ==> \\(e.debugDescription)\") }) .disposed(by: disposeBag) } è¾“å‡ºå¦‚ä¸‹ï¼š observeOn: ink.tbd.test.observeQueue; ==> next(1) observeOn: ink.tbd.test.observeQueue; ==> next(2) observeOn: ink.tbd.test.observeQueue; ==> next(3) observeOn: ink.tbd.test.observeQueue; ==> next(4) observeOn: ink.tbd.test.observeQueue; ==> next(5) observeOn: ink.tbd.test.observeQueue; ==> completed subscribeOn https://beeth0ven.github.io/RxSwift-Chinese-Documentation/content/decision_tree/subscribeOn.html æŒ‡å®š Observable åœ¨å“ªä¸ª Scheduler æ‰§è¡Œ ReactiveX ä½¿ç”¨ Scheduler æ¥è®© Observable æ”¯æŒå¤šçº¿ç¨‹ã€‚ä½ å¯ä»¥ä½¿ç”¨ subscribeOn æ“ä½œç¬¦ï¼Œæ¥æŒ‡ç¤º Observable åœ¨å“ªä¸ª Scheduler æ‰§è¡Œã€‚ observeOn æ“ä½œç¬¦éå¸¸ç›¸ä¼¼ã€‚å®ƒæŒ‡ç¤º Observable åœ¨å“ªä¸ª Scheduler å‘å‡ºé€šçŸ¥ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒObservable åˆ›å»ºï¼Œåº”ç”¨æ“ä½œç¬¦ä»¥åŠå‘å‡ºé€šçŸ¥éƒ½ä¼šåœ¨ Subscribe æ–¹æ³•è°ƒç”¨çš„ Scheduler æ‰§è¡Œã€‚subscribeOn æ“ä½œç¬¦å°†æ”¹å˜è¿™ç§è¡Œä¸ºï¼Œå®ƒä¼šæŒ‡å®šä¸€ä¸ªä¸åŒçš„ Scheduler æ¥è®© Observable æ‰§è¡Œï¼ŒobserveOn æ“ä½œç¬¦å°†æŒ‡å®šä¸€ä¸ªä¸åŒçš„ Scheduler æ¥è®© Observable é€šçŸ¥è§‚å¯Ÿè€…ã€‚ subscribeOn æ“ä½œç¬¦æŒ‡å®š Observable åœ¨é‚£ä¸ª Scheduler å¼€å§‹æ‰§è¡Œï¼Œæ— è®ºå®ƒå¤„äºé“¾çš„é‚£ä¸ªä½ç½®ã€‚ å¦ä¸€æ–¹é¢ observeOn å°†å†³å®šåé¢çš„æ–¹æ³•åœ¨å“ªä¸ª Scheduler è¿è¡Œã€‚å› æ­¤ï¼Œä½ å¯èƒ½ä¼šå¤šæ¬¡è°ƒç”¨ observeOn æ¥å†³å®šæŸäº›æ“ä½œç¬¦åœ¨å“ªä¸ªçº¿ç¨‹è¿è¡Œã€‚ eg: func subscribeOn() { let observable = Observable.of(1, 2, 3, 4, 5) let subscribeQueue = DispatchQueue.init(label: \"ink.tbd.test.subscribeQueue\") observable .subscribeOn(ConcurrentDispatchQueueScheduler.init(queue: subscribeQueue)) .subscribe({ (e) in print(\"subscribeOn: \\(getCurrentQueueName()); ==> \\(e.debugDescription)\") }) .disposed(by: disposeBag) } è¾“å‡ºå¦‚ä¸‹ï¼š subscribeOn: ink.tbd.test.subscribeQueue; ==> next(1) subscribeOn: ink.tbd.test.subscribeQueue; ==> next(2) subscribeOn: ink.tbd.test.subscribeQueue; ==> next(3) subscribeOn: ink.tbd.test.subscribeQueue; ==> next(4) subscribeOn: ink.tbd.test.subscribeQueue; ==> next(5) subscribeOn: ink.tbd.test.subscribeQueue; ==> completed "},"RxSwiftStudy/Operator/Materialize.html":{"url":"RxSwiftStudy/Operator/Materialize.html","title":"7.12 Materialize Operator","keywords":"","body":"Materialize Operator materialize é€šå¸¸ï¼Œä¸€ä¸ªæœ‰é™çš„ Observable å°†äº§ç”Ÿé›¶ä¸ªæˆ–è€…å¤šä¸ª onNext äº‹ä»¶ï¼Œç„¶åäº§ç”Ÿä¸€ä¸ª onCompleted æˆ–è€… onError äº‹ä»¶ã€‚ materialize æ“ä½œç¬¦å°† Observable äº§ç”Ÿçš„è¿™äº›äº‹ä»¶å…¨éƒ¨è½¬æ¢æˆå…ƒç´ ï¼Œç„¶åå‘é€å‡ºæ¥ã€‚ eg: func materialize() { getErrorObservable() .materialize() .subscribe({ (e) in print(e) }) .disposed(by: disposeBag) } è¾“å‡ºå¦‚ä¸‹ï¼š next(next(1ï¸âƒ£)) next(next(2ï¸âƒ£)) next(error(TError(errorCode: 10, errorString: \"Test\", errorData: nil))) completed dematerialize dematerialize æ“ä½œç¬¦å°† materialize è½¬æ¢åçš„å…ƒç´ è¿˜åŸ eg: func dematerialize() { let materializeObservable = getErrorObservable().materialize() materializeObservable .dematerialize() .subscribe({ (e) in print(e) }) .disposed(by: disposeBag) } è¾“å‡ºå¦‚ä¸‹ï¼š next(1ï¸âƒ£) next(2ï¸âƒ£) error(TError(errorCode: 10, errorString: \"Test\", errorData: nil)) "},"RxSwiftStudy/Operator/Using.html":{"url":"RxSwiftStudy/Operator/Using.html","title":"7.13 Using Operator","keywords":"","body":"Using Operator Using åˆ›å»ºä¸€ä¸ªå¯è¢«æ¸…é™¤çš„èµ„æº(å³éµå®ˆDisposableåè®®)ï¼Œå®ƒå’Œ Observable å…·æœ‰ç›¸åŒçš„å¯¿å‘½ é€šè¿‡ä½¿ç”¨ using æ“ä½œç¬¦åˆ›å»º Observable æ—¶ï¼ŒåŒæ—¶åˆ›å»ºä¸€ä¸ªå¯è¢«æ¸…é™¤çš„èµ„æºï¼Œä¸€æ—¦ Observable ç»ˆæ­¢äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªèµ„æºå°±ä¼šè¢«æ¸…é™¤æ‰äº†(å³è°ƒç”¨äº†è¯¥èµ„æºçš„dispose()æ–¹æ³•)ã€‚ eg: func using() { class DisposableResource: Disposable { var values: [Int] = [] var isDisposed: Bool = false func dispose() { self.values = [] self.isDisposed = true print(\"!!!DisposableResource is Disposed!!!\") } init(with values: [Int]) { self.values = values } } let observable = Observable.using({ () -> DisposableResource in return DisposableResource.init(with: [1, 2, 3, 4]) }, observableFactory: { (resource) -> Observable in if resource.isDisposed { return Observable.from([]) } else { return Observable.from(resource.values) } }) observable .debug() .subscribe() .disposed(by: disposeBag) } è¾“å‡ºå¦‚ä¸‹ï¼š 2017-12-27 17:06:35.757: Operator+Using.swift:43 (using()) -> subscribed 2017-12-27 17:06:35.759: Operator+Using.swift:43 (using()) -> Event next(1) 2017-12-27 17:06:35.759: Operator+Using.swift:43 (using()) -> Event next(2) 2017-12-27 17:06:35.759: Operator+Using.swift:43 (using()) -> Event next(3) 2017-12-27 17:06:35.759: Operator+Using.swift:43 (using()) -> Event next(4) 2017-12-27 17:06:35.759: Operator+Using.swift:43 (using()) -> Event completed 2017-12-27 17:06:35.759: Operator+Using.swift:43 (using()) -> isDisposed !!!DisposableResource is Disposed!!! "},"RxSwiftStudy/8.å…¶ä»–ç›¸å…³èµ„æ–™.html":{"url":"RxSwiftStudy/8.å…¶ä»–ç›¸å…³èµ„æ–™.html","title":"8. å…¶ä»–ç›¸å…³èµ„æ–™","keywords":"","body":"å…¶ä»–ç›¸å…³èµ„æ–™ RxSwift å¸¸ç”¨æ¶æ„ MVVM RxFeedback ReactorKit RxSwift ç”Ÿæ€ç³»ç»Ÿ RxSwiftCommunity Github RxCocoa: Cocoaåº“æ‰©å±• RxDataSources: UITableView å’Œ UICollectionView æ•°æ®æº RxAlamofire: ç½‘ç»œè¯·æ±‚ RxRealm: Realm æ•°æ®åº“ RxCoreData: CoreData æ•°æ®åº“ RxGesture: é¡µé¢æ‰‹åŠ¿ RxMKMapView: åœ°å›¾ RxCoreMotion: é™€èºä»ª RxMediaPicker: å›¾ç‰‡é€‰æ‹©å™¨ Action: è¡Œä¸º RxWebKit: WebView RxEventHub: å…¨å±€é€šçŸ¥ RxSwiftExt: æ·»åŠ ä¸€äº›æœ‰ç”¨çš„æ“ä½œç¬¦ "}}