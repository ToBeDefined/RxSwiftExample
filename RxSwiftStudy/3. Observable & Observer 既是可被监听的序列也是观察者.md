## Observable & Observer æ—¢æ˜¯å¯è¢«ç›‘å¬çš„åºåˆ—ä¹Ÿæ˜¯è§‚å¯Ÿè€…

[https://beeth0ven.github.io/RxSwift-Chinese-Documentation/content/rxswift_core/observable_and_observer.html](https://beeth0ven.github.io/RxSwift-Chinese-Documentation/content/rxswift_core/observable_and_observer.html)


åœ¨æˆ‘ä»¬æ‰€é‡åˆ°çš„äº‹ç‰©ä¸­ï¼Œæœ‰ä¸€éƒ¨åˆ†éå¸¸ç‰¹åˆ«ã€‚å®ƒä»¬æ—¢æ˜¯**å¯è¢«ç›‘å¬çš„åºåˆ—**ä¹Ÿæ˜¯**è§‚å¯Ÿè€…**ã€‚

ä¾‹å¦‚ï¼š`textField`çš„å½“å‰æ–‡æœ¬ã€‚å®ƒå¯ä»¥çœ‹æˆæ˜¯ç”±ç”¨æˆ·è¾“å…¥ï¼Œè€Œäº§ç”Ÿçš„ä¸€ä¸ª**æ–‡æœ¬åºåˆ—**ã€‚ä¹Ÿå¯ä»¥æ˜¯ç”±å¤–éƒ¨æ–‡æœ¬åºåˆ—ï¼Œæ¥æ§åˆ¶å½“å‰æ˜¾ç¤ºå†…å®¹çš„**è§‚å¯Ÿè€…**ï¼š

```swift
// ä½œä¸ºå¯è¢«ç›‘å¬çš„åºåˆ—
let observable = textField.rx.text
observable.subscribe(onNext: { text in show(text: text) })
```

```swift
// ä½œä¸ºè§‚å¯Ÿè€…
let observer = textField.rx.text
let text: Observable<String?> = ...
text.bind(to: observer)
```

çœ‹ä¸‹ `textField`çš„ `rx.text` çš„å®šä¹‰

```swift
public var text: ControlProperty<String?> {
    return value
}
    
/// Reactive wrapper for `text` property.
public var value: ControlProperty<String?> {
    return base.rx.controlPropertyWithDefaultEvents(
        getter: { textField in
            textField.text
        },
        setter: { textField, value in
            // This check is important because setting text value always clears control state
            // including marked text selection which is imporant for proper input 
            // when IME input method is used.
            if textField.text != value {
                textField.text = value
            }
        }
    )
}
```

çœ‹ä¸‹ `ControlProperty<Element>` æ˜¯å•¥

```swift

public protocol ControlPropertyType : ObservableType, ObserverType {
    ...
}

public struct ControlProperty<PropertyType> : ControlPropertyType {
    ...
    ...
}
```


æœ‰è®¸å¤š UI æ§ä»¶éƒ½å­˜åœ¨è¿™ç§ç‰¹æ€§ï¼Œä¾‹å¦‚ï¼š`switch`çš„å¼€å…³çŠ¶æ€ï¼Œ`segmentedControl`çš„é€‰ä¸­ç´¢å¼•å·ï¼Œ`datePicker`çš„é€‰ä¸­æ—¥æœŸç­‰ç­‰ã€‚

å¦å¤–ï¼Œæ¡†æ¶é‡Œé¢å®šä¹‰äº†ä¸€äº›è¾…åŠ©ç±»å‹ï¼Œå®ƒä»¬æ—¢æ˜¯**å¯è¢«ç›‘å¬çš„åºåˆ—**ä¹Ÿæ˜¯**è§‚å¯Ÿè€…**ã€‚å¦‚æœä½ èƒ½åˆé€‚çš„åº”ç”¨è¿™äº›è¾…åŠ©ç±»å‹ï¼Œå®ƒä»¬å°±å¯ä»¥å¸®åŠ©ä½ æ›´å‡†ç¡®çš„æè¿°äº‹ç‰©çš„ç‰¹å¾ã€‚


## AsyncSubject

[https://beeth0ven.github.io/RxSwift-Chinese-Documentation/content/rxswift_core/observable_and_observer/async_subject.html](https://beeth0ven.github.io/RxSwift-Chinese-Documentation/content/rxswift_core/observable_and_observer/async_subject.html)

```swift
public final class AsyncSubject<Element>
    : Observable<Element>
    , SubjectType
    , ObserverType
    , SynchronizedUnsubscribeType {
    ...
    ...
}
```

- å¦‚æœæº `Observable`åœ¨å‘å‡ºå¤šä¸ªå…ƒç´ å¹¶äº§ç”Ÿå®Œæˆäº‹ä»¶åï¼Œ **AsyncSubject** å‘å‡ºæœ€åä¸€ä¸ªå…ƒç´ ï¼ˆä»…ä»…åªæœ‰æœ€åä¸€ä¸ªå…ƒç´ ï¼‰ï¼›
- å¦‚æœæº `Observable` æ²¡æœ‰å‘å‡ºä»»ä½•å…ƒç´ ï¼Œåªæœ‰ä¸€ä¸ªå®Œæˆäº‹ä»¶ï¼Œ **AsyncSubject** ä¹Ÿåªæœ‰ä¸€ä¸ªå®Œæˆäº‹ä»¶ã€‚
- å¦‚æœæº `Observable` å› ä¸ºäº§ç”Ÿäº†ä¸€ä¸ª `error` äº‹ä»¶è€Œä¸­æ­¢ï¼Œ **AsyncSubject** å°±ä¸ä¼šå‘å‡ºä»»ä½•å…ƒç´ ï¼Œè€Œæ˜¯å°†è¿™ä¸ª `error` äº‹ä»¶å‘é€å‡ºæ¥ã€‚

eg:

```swift
private let disposeBag = DisposeBag()
func testAsyncSubject() {
    let subject = AsyncSubject<String>()
    
    subject.subscribe({ (e) in
        print("Subscription: 1 Event:", e)
    }).disposed(by: disposeBag)
    
    // 1
    subject.onNext("ğŸ¶")
    subject.onNext("ğŸ±")
    // åªå‘é€ onCompletedå‰é¢æœ€åä¸€ä¸ª
    subject.onNext("ğŸ¹")
    subject.onCompleted()
}
```

è¾“å‡ºå¦‚ä¸‹ï¼š

```swift
Subscription: 1 Event: next(ğŸ¹)
Subscription: 1 Event: completed
```


## PublishSubject

[https://beeth0ven.github.io/RxSwift-Chinese-Documentation/content/rxswift_core/observable_and_observer/publish_subject.html](https://beeth0ven.github.io/RxSwift-Chinese-Documentation/content/rxswift_core/observable_and_observer/publish_subject.html)

```swift
public final class PublishSubject<Element>
    : Observable<Element>
    , SubjectType
    , Cancelable
    , ObserverType
    , SynchronizedUnsubscribeType {
    ...
    ...
}
```

**PublishSubject** å°†å¯¹è§‚å¯Ÿè€…å‘é€è®¢é˜…åäº§ç”Ÿçš„å…ƒç´ ï¼Œè€Œåœ¨è®¢é˜…å‰å‘å‡ºçš„å…ƒç´ å°†ä¸ä¼šå‘é€ç»™è§‚å¯Ÿè€…ã€‚

å¦‚æœä½ å¸Œæœ›è§‚å¯Ÿè€…æ¥æ”¶åˆ°æ‰€æœ‰çš„å…ƒç´ ï¼Œä½ å¯ä»¥é€šè¿‡ä½¿ç”¨ `Observable` çš„ `create` æ–¹æ³•æ¥åˆ›å»º `Observable`ï¼Œæˆ–è€…ä½¿ç”¨ **ReplaySubject**ã€‚


- å¦‚æœæº `Observable`åœ¨å‘å‡ºå¤šä¸ªå…ƒç´ å¹¶äº§ç”Ÿå®Œæˆäº‹ä»¶åï¼Œ **PublishSubject** å‘å‡ºæœ€åä¸€ä¸ªå…ƒç´ ï¼ˆä»…ä»…åªæœ‰æœ€åä¸€ä¸ªå…ƒç´ ï¼‰ï¼›
- å¦‚æœæº `Observable` æ²¡æœ‰å‘å‡ºä»»ä½•å…ƒç´ ï¼Œåªæœ‰ä¸€ä¸ªå®Œæˆäº‹ä»¶ï¼Œ **PublishSubject** ä¹Ÿåªæœ‰ä¸€ä¸ªå®Œæˆäº‹ä»¶ã€‚
- å¦‚æœæº `Observable` å› ä¸ºäº§ç”Ÿäº†ä¸€ä¸ª `error` äº‹ä»¶è€Œä¸­æ­¢ï¼Œ **PublishSubject** å°±ä¸ä¼šå‘å‡ºä»»ä½•å…ƒç´ ï¼Œè€Œæ˜¯å°†è¿™ä¸ª `error` äº‹ä»¶å‘é€å‡ºæ¥ã€‚


```swift
func testPublishSubject() {
    let disposeBag = DisposeBag()
    let subject = PublishSubject<String>()
    
    subject.subscribe({ (e) in
        print("Subscription: 1 Event:", e)
    }).disposed(by: disposeBag)
    
    subject.onNext("ğŸ¶")
    subject.onNext("ğŸ±")
    
    subject.subscribe({ (e) in
        print("Subscription: 2 Event:", e)
    }).disposed(by: disposeBag)
    
    subject.onNext("ğŸ…°ï¸")
    subject.onNext("ğŸ…±ï¸")
    subject.onCompleted()
}
```

è¾“å‡ºå¦‚ä¸‹ï¼š

```swift
Subscription: 1 Event: next(ğŸ¶)
Subscription: 1 Event: next(ğŸ±)
Subscription: 1 Event: next(ğŸ…°ï¸)
Subscription: 2 Event: next(ğŸ…°ï¸)
Subscription: 1 Event: next(ğŸ…±ï¸)
Subscription: 2 Event: next(ğŸ…±ï¸)
Subscription: 1 Event: completed
Subscription: 2 Event: completed
```




